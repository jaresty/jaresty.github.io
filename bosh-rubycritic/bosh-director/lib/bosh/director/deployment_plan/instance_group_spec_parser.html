<!DOCTYPE html>
<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ruby Critic - Home</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- StyleSheets -->
    <link href="../../../../../assets/stylesheets/bootstrap.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../../../assets/stylesheets/font-awesome.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../../../assets/stylesheets/prettify.custom_theme.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../../../assets/stylesheets/application.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  </head>

  <body>
    <header class="navbar navbar-default navbar-fixed-top">
      <a href="#menu-toggle" class="btn btn-default hidden-lg visible-sm-* hidden-md visible-xs-* pull-left" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a>
      <a href="../../../../../overview.html"><img src="../../../../../assets/images/logo.png" title="Ruby Critic Logo" width="55"><span class="logo">RUBYCRITIC</span></a>
    </header>
    <div id="wrapper">
      <!-- Sidebar -->
      <aside id="sidebar-wrapper">
        <ul class="sidebar-nav">
          <li class="sidebar-item">
            <a href="../../../../../overview.html" class="project-nav-item overview-nav"><i class="fa fa-dashboard"></i>Overview</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../../../code_index.html" class="project-nav-item code-index-nav"><i class="fa fa-code"></i>Code</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../../../smells_index.html" class="project-nav-item smells-index-nav"><i class="fa fa-warning"></i>Smells</a>
          </li>
        </ul>
      </aside>
      <!-- /#sidebar-wrapper -->
      <div id="page-content-wrapper">
        <div class="container-fluid">
          <div class="row">
  <!--Page Title -->
  <div class="Page_Title">
    <div class="file-time">
      <span class="committed-at">
        
          Updated <time class='js-timeago' datetime='2018-05-28 16:13:51 -0400'>2018-05-28 16:13:51 -0400</time>
        
      </span>
    </div>
    <div>
      <h3><small>bosh-director/lib/bosh/director/deployment_plan /</small> instance_group_spec_parser.rb</h3>
    </div>
  </div>
  <!--End Page Title -->
  <div class="Content_Wrapper">
    <!-- code detail -->
    <div class="code-top-detail clearfix row">
      <div class="col-md-8">
        <div class="row">
          <div class="col-md-1">
            <div class="rating f big">
              F
            </div>
          </div>
          <div class="code-statistics col-md-11">
            <div class="col-md-3">
              <div><span class="metric">500</span><small> lines of codes</small></div>
              <div><span class="metric">17</span><small> methods</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">27.5</span><small> complexity/method</small></div>
              <div><span class="metric">118</span><small> churn</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">468.01</span><small> complexity</small></div>
              <div><span class="metric">0</span><small> duplications</small></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="code-tabs">
          <ul class="nav nav-pills right-to-left">
            <li><a href="#" id="toggle-code" class="toggle-button button">code</a></li>
            <li class="active">
              <a href="#" id="toggle-smells" class="toggle-button button">
                59
                smells
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <code class="prettyprint linenums lang-ruby file-code js-file-code">require &#39;bosh/template/property_helper&#39;

module Bosh::Director
  module DeploymentPlan
    class InstanceGroupSpecParser<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Instance-Variable-Assumption.md" target="_blank"><b>InstanceVariableAssumption</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser assumes too much for instance variable '@instance_group'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Instance-Variable-Assumption.md" target="_blank"><b>InstanceVariableAssumption</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser assumes too much for instance variable '@instance_group_spec'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Irresponsible-Module.md" target="_blank"><b>IrresponsibleModule</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser has no descriptive comment</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Instance-Variables.md" target="_blank"><b>TooManyInstanceVariables</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser has at least 6 instance variables</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Methods.md" target="_blank"><b>TooManyMethods</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser has at least 17 methods</span>          </div>  </li></ol>
      include ValidationHelper
      include Bosh::Template::PropertyHelper
      include IpUtil

      MANUAL_LINK_KEYS = [&#39;instances&#39;, &#39;properties&#39;, &#39;address&#39;]

      # @param [Bosh::Director::DeploymentPlan] deployment Deployment plan
      def initialize(deployment, event_log, logger)
        @deployment = deployment
        @event_log = event_log
        @logger = logger
        @links_parser = Bosh::Director::Links::LinksParser.new
      end

      # @param [Hash] instance_group_spec Raw instance_group spec from the deployment manifest
      # @return [DeploymentPlan::InstanceGroup] Instance groups as built from instance_group_spec
      def parse(instance_group_spec, options = {})<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse has a flog score of 36</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse has approx 27 statements</span>          </div>  </li></ol>
        @instance_group_spec = instance_group_spec
        @instance_group = InstanceGroup.new(@logger)

        parse_name
        parse_lifecycle

        parse_release
        validate_jobs

        merged_global_and_instance_group_properties = extract_global_and_instance_group_properties

        parse_legacy_template(merged_global_and_instance_group_properties)
        parse_jobs(merged_global_and_instance_group_properties, options[&#39;is_deploy_action&#39;])

        check_job_uniqueness
        parse_disks

        parse_resource_pool
        check_remove_dev_tools

        parse_options = {}
        parse_options[&#39;canaries&#39;] = options[&#39;canaries&#39;] if options[&#39;canaries&#39;]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse calls 'options['canaries']' 2 times</span>          </div>  </li></ol>
        parse_options[&#39;max_in_flight&#39;] = options[&#39;max_in_flight&#39;] if options[&#39;max_in_flight&#39;]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse calls 'options['max_in_flight']' 2 times</span>          </div>  </li></ol>
        parse_update_config(parse_options)

        networks = InstanceGroupNetworksParser.new(Network::REQUIRED_DEFAULTS, Network::OPTIONAL_DEFAULTS).parse(@instance_group_spec, @instance_group.name, @deployment.networks)
        @instance_group.networks = networks
        assign_default_networks(networks)

        availability_zones = InstanceGroupAvailabilityZoneParser.new.parse(@instance_group_spec, @instance_group, @deployment, networks)
        @instance_group.availability_zones = availability_zones

        parse_migrated_from

        desired_instances = parse_desired_instances(availability_zones, networks)
        @instance_group.desired_instances = desired_instances

        @instance_group.deployment_name = @deployment.name

        @instance_group
      end

      private

      def parse_name
        @instance_group.name = safe_property(@instance_group_spec, &quot;name&quot;, :class =&gt; String)
        @instance_group.canonical_name = Canonicalizer.canonicalize(@instance_group.name)
      end

      def parse_lifecycle
        lifecycle = safe_property(@instance_group_spec, &quot;lifecycle&quot;,
          :class =&gt; String,
          :optional =&gt; true,
          :default =&gt; InstanceGroup::DEFAULT_LIFECYCLE_PROFILE,
        )

        unless InstanceGroup::VALID_LIFECYCLE_PROFILES.include?(lifecycle)
          raise JobInvalidLifecycle,
            &quot;Invalid lifecycle &#39;#{lifecycle}&#39; for &#39;#{@instance_group.name}&#39;, &quot; +
            &quot;valid lifecycle profiles are: #{InstanceGroup::VALID_LIFECYCLE_PROFILES.join(&#39;, &#39;)}&quot;
        end

        @instance_group.lifecycle = lifecycle
      end

      def parse_release
        release_name = safe_property(@instance_group_spec, &quot;release&quot;, :class =&gt; String, :optional =&gt; true)

        if release_name.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_release performs a nil-check</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L91" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L98" class="js-smell-location">1</a>                  </div>  </li></ol>
          if @deployment.releases.size == 1<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_release calls '@deployment.releases' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L92" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L93" class="js-smell-location">1</a>                  </div>  </li></ol>
            @instance_group.release = @deployment.releases.first<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_release calls '@deployment.releases' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L92" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L93" class="js-smell-location">1</a>                  </div>  </li></ol>
          end
        else
          @instance_group.release = @deployment.release(release_name)

          if @instance_group.release.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_release performs a nil-check</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L91" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L98" class="js-smell-location">1</a>                  </div>  </li></ol>
            raise InstanceGroupUnknownRelease,
                  &quot;Instance group &#39;#{@instance_group.name}&#39; references an unknown release &#39;#{release_name}&#39;&quot;
          end
        end
      end

      # legacy template parsing
      def parse_legacy_template(merged_global_and_instance_group_properties)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_legacy_template has a flog score of 27</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_legacy_template has approx 8 statements</span>          </div>  </li></ol>
        job_names = safe_property(@instance_group_spec, &#39;template&#39;, optional: true)
        if job_names
          if job_names.is_a?(Array)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_legacy_template calls 'job_names.is_a?(Array)' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L109" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L116" class="js-smell-location">1</a>                  </div>  </li></ol>
            @event_log.warn_deprecated(
              &quot;Please use &#39;templates&#39; when specifying multiple templates for a job. &quot; +
              &quot;&#39;template&#39; for multiple templates will soon be unsupported.&quot;
            )
          end

          unless job_names.is_a?(Array) || job_names.is_a?(String)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_legacy_template calls 'job_names.is_a?(Array)' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L109" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L116" class="js-smell-location">1</a>                  </div>  </li></ol>
            invalid_type(&quot;template&quot;, &quot;String or Array&quot;, job_names)
          end

          unless @instance_group.release<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_legacy_template calls '@instance_group.release' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L120" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L125" class="js-smell-location">1</a>                  </div>  </li></ol>
            raise InstanceGroupMissingRelease, &quot;Cannot tell what release job &#39;#{@instance_group.name}&#39; is supposed to use, please explicitly specify one&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_legacy_template calls '@instance_group.name' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L121" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L128" class="js-smell-location">1</a>                  </div>  </li></ol>
          end

          Array(job_names).each do |job_name|
            current_job = @instance_group.release.get_or_create_template(job_name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_legacy_template calls '@instance_group.release' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L120" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L125" class="js-smell-location">1</a>                  </div>  </li></ol>
            current_job.add_properties(
              merged_global_and_instance_group_properties,
              @instance_group.name<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_legacy_template calls '@instance_group.name' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L121" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L128" class="js-smell-location">1</a>                  </div>  </li></ol>
            )
            @instance_group.jobs &lt;&lt; current_job
          end
        end
      end

      def parse_jobs(merged_global_and_instance_group_properties, is_deploy_action)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_jobs has a flog score of 87</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_jobs has approx 30 statements</span>          </div>  </li></ol>
        legacy_jobs = safe_property(@instance_group_spec, &#39;templates&#39;, class: Array, optional: true)
        jobs = safe_property(@instance_group_spec, &#39;jobs&#39;, class: Array, optional: true)

        migrated_from = safe_property(@instance_group_spec, &#39;migrated_from&#39;, class: Array, optional: true, :default =&gt; [])

        if jobs.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_jobs performs a nil-check</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L141" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L181" class="js-smell-location">1</a>                  </div>  </li></ol>
          jobs = legacy_jobs
        end

        if jobs
          release_manager = Api::ReleaseManager.new

          # Key: release name.
          # Value: list of templates models of release version.
          release_versions_templates_models_hash = {}

          jobs.each do |job_spec|
            job_name = safe_property(job_spec, &#39;name&#39;, class: String)
            release_name = safe_property(job_spec, &#39;release&#39;, class: String, optional: true)

            if release_name
              release = @deployment.release(release_name)
              unless release
                raise InstanceGroupUnknownRelease,
                      &quot;Job &#39;#{job_name}&#39; (instance group &#39;#{@instance_group.name}&#39;) references an unknown release &#39;#{release_name}&#39;&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_jobs calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L160" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L165" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L193" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L205" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L212" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L221" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L227" class="js-smell-location">6</a>                  </div>  </li></ol>
              end
            else
              release = @instance_group.release
              unless release
                raise InstanceGroupMissingRelease, &quot;Cannot tell what release template &#39;#{job_name}&#39; (instance group &#39;#{@instance_group.name}&#39;) is supposed to use, please explicitly specify one&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_jobs calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L160" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L165" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L193" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L205" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L212" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L221" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L227" class="js-smell-location">6</a>                  </div>  </li></ol>
              end
              release_name = release.name<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_jobs calls 'release.name' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L167" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L171" class="js-smell-location">1</a>                  </div>  </li></ol>
            end

            unless release_versions_templates_models_hash.has_key?(release_name)
              release_model = release_manager.find_by_name(release.name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_jobs calls 'release.name' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L167" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L171" class="js-smell-location">1</a>                  </div>  </li></ol>
              current_release_version = release_manager.find_version(release_model, release.version)
              release_versions_templates_models_hash[release_name] = current_release_version.templates
            end

            templates_models_list = release_versions_templates_models_hash[release_name]
            current_template_model = templates_models_list.find {|target| target.name == job_name }<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_jobs contains iterators nested 2 deep</span>          </div>  </li></ol>

            job = release.get_or_create_template(job_name)

            if current_template_model == nil<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_jobs performs a nil-check</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L141" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L181" class="js-smell-location">1</a>                  </div>  </li></ol>
              raise &quot;Job &#39;#{job_name}&#39; not found in Template table&quot;
            end

            if job_spec.has_key?(&#39;properties&#39;)
              job_properties = safe_property(job_spec, &#39;properties&#39;, class: Hash, optional: true, default: {})
            else
              job_properties = merged_global_and_instance_group_properties
            end

            job.add_properties(
              job_properties,
              @instance_group.name<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_jobs calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L160" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L165" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L193" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L205" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L212" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L221" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L227" class="js-smell-location">6</a>                  </div>  </li></ol>
            )

            # migrated_from true? or false?
            # get migrated_from_name = migarted_name : @instance_group.name
            if is_deploy_action<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Control-Parameter.md" target="_blank"><b>ControlParameter</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_jobs is controlled by argument 'is_deploy_action'</span>          </div>  </li></ol>
              unless migrated_from.to_a.empty?
                @links_parser.parse_migrated_from_providers_from_job(
                  job_spec,
                  @deployment.model,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_jobs calls '@deployment.model' 4 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L202" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L210" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L218" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L225" class="js-smell-location">3</a>                  </div>  </li></ol>
                  current_template_model,
                  job_properties: job_properties,
                  instance_group_name: @instance_group.name,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_jobs calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L160" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L165" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L193" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L205" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L212" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L221" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L227" class="js-smell-location">6</a>                  </div>  </li></ol>
                  migrated_from: migrated_from,
                )
                @links_parser.parse_migrated_from_consumers_from_job(
                  job_spec,
                  @deployment.model,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_jobs calls '@deployment.model' 4 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L202" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L210" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L218" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L225" class="js-smell-location">3</a>                  </div>  </li></ol>
                  current_template_model,
                  instance_group_name: @instance_group.name,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_jobs calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L160" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L165" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L193" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L205" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L212" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L221" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L227" class="js-smell-location">6</a>                  </div>  </li></ol>
                  migrated_from: migrated_from,
                )
              else
                @links_parser.parse_providers_from_job(
                  job_spec,
                  @deployment.model,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_jobs calls '@deployment.model' 4 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L202" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L210" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L218" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L225" class="js-smell-location">3</a>                  </div>  </li></ol>
                  current_template_model,
                  job_properties: job_properties,
                  instance_group_name: @instance_group.name,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_jobs calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L160" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L165" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L193" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L205" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L212" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L221" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L227" class="js-smell-location">6</a>                  </div>  </li></ol>
                )
                @links_parser.parse_consumers_from_job(
                  job_spec,
                  @deployment.model,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_jobs calls '@deployment.model' 4 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L202" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L210" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L218" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L225" class="js-smell-location">3</a>                  </div>  </li></ol>
                  current_template_model,
                  instance_group_name: @instance_group.name,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_jobs calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L160" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L165" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L193" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L205" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L212" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L221" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L227" class="js-smell-location">6</a>                  </div>  </li></ol>
                )
              end
            end
            @instance_group.jobs &lt;&lt; job
          end
        end
      end

      def check_job_uniqueness
        all_names = @instance_group.jobs.map(&amp;:name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#check_job_uniqueness calls '@instance_group.jobs' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L237" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L238" class="js-smell-location">1</a>                  </div>  </li></ol>
        @instance_group.jobs.each do |job|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#check_job_uniqueness calls '@instance_group.jobs' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L237" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L238" class="js-smell-location">1</a>                  </div>  </li></ol>
          if all_names.count(job.name) &gt; 1<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#check_job_uniqueness calls 'job.name' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L239" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L241" class="js-smell-location">1</a>                  </div>  </li></ol>
            raise InstanceGroupInvalidTemplates,
                  &quot;Colocated job &#39;#{job.name}&#39; is already added to the instance group &#39;#{@instance_group.name}&#39;&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#check_job_uniqueness calls 'job.name' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L239" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L241" class="js-smell-location">1</a>                  </div>  </li></ol>
          end
        end
      end

      def parse_disks<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_disks has a flog score of 66</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_disks has approx 27 statements</span>          </div>  </li></ol>
        disk_size = safe_property(@instance_group_spec, &#39;persistent_disk&#39;, :class =&gt; Integer, :optional =&gt; true)
        disk_type_name = safe_property(@instance_group_spec, &#39;persistent_disk_type&#39;, :class =&gt; String, :optional =&gt; true)
        disk_pool_name = safe_property(@instance_group_spec, &#39;persistent_disk_pool&#39;, :class =&gt; String, :optional =&gt; true)
        persistent_disks = safe_property(@instance_group_spec, &#39;persistent_disks&#39;, :class =&gt; Array, :optional =&gt; true)

        if [disk_size, disk_type_name, disk_pool_name, persistent_disks].compact!.size &gt; 1
          raise InstanceGroupInvalidPersistentDisk,
            &quot;Instance group &#39;#{@instance_group.name}&#39; specifies more than one of the following keys:&quot; +<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_disks calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L254" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L271" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L281" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L291" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L299" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L305" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L310" class="js-smell-location">6</a>                  </div>  </li></ol>
              &quot; &#39;persistent_disk&#39;, &#39;persistent_disk_type&#39;, &#39;persistent_disk_pool&#39; and &#39;persistent_disks&#39;. Choose one.&quot;
        end

        if disk_type_name
          disk_name = disk_type_name
          disk_source = &#39;type&#39;
        else
          disk_name = disk_pool_name
          disk_source = &#39;pool&#39;
        end

        persistent_disk_collection = PersistentDiskCollection.new(@logger)

        if disk_size
          if disk_size &lt; 0
            raise InstanceGroupInvalidPersistentDisk,
              &quot;Instance group &#39;#{@instance_group.name}&#39; references an invalid persistent disk size &#39;#{disk_size}&#39;&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_disks calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L254" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L271" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L281" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L291" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L299" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L305" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L310" class="js-smell-location">6</a>                  </div>  </li></ol>
          end

          persistent_disk_collection.add_by_disk_size(disk_size) unless disk_size == 0
        end

        if disk_name
          disk_type = @deployment.disk_type(disk_name)
          if disk_type.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_disks calls 'disk_type.nil?' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L279" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L297" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_disks performs a nil-check</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L279" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L297" class="js-smell-location">1</a>                  </div>  </li></ol>
            raise InstanceGroupUnknownDiskType,
              &quot;Instance group &#39;#{@instance_group.name}&#39; references an unknown disk #{disk_source} &#39;#{disk_name}&#39;&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_disks calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L254" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L271" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L281" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L291" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L299" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L305" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L310" class="js-smell-location">6</a>                  </div>  </li></ol>
          end

          persistent_disk_collection.add_by_disk_type(disk_type)
        end

        if persistent_disks
          unique_names = persistent_disks.map { |persistent_disk| persistent_disk[&#39;name&#39;] }.uniq<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_disks calls 'persistent_disk['name']' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L288" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L302" class="js-smell-location">1</a>                  </div>  </li></ol>
          if unique_names.size != persistent_disks.size
            raise InstanceGroupInvalidPersistentDisk,
              &quot;Instance group &#39;#{@instance_group.name}&#39; persistent_disks&#39;s section contains duplicate names&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_disks calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L254" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L271" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L281" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L291" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L299" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L305" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L310" class="js-smell-location">6</a>                  </div>  </li></ol>
          end

          persistent_disks.each do |persistent_disk|
            disk_type_name = persistent_disk[&#39;type&#39;]
            disk_type = @deployment.disk_type(disk_type_name)
            if disk_type.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_disks calls 'disk_type.nil?' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L279" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L297" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_disks performs a nil-check</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L279" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L297" class="js-smell-location">1</a>                  </div>  </li></ol>
              raise InstanceGroupUnknownDiskType,
                &quot;Instance group &#39;#{@instance_group.name}&#39; persistent_disks&#39;s section references an unknown disk type &#39;#{disk_type_name}&#39;&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_disks calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L254" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L271" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L281" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L291" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L299" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L305" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L310" class="js-smell-location">6</a>                  </div>  </li></ol>
            end

            persistent_disk_name = persistent_disk[&#39;name&#39;]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_disks calls 'persistent_disk['name']' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L288" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L302" class="js-smell-location">1</a>                  </div>  </li></ol>
            if persistent_disk_name.blank?
              raise InstanceGroupInvalidPersistentDisk,
                &quot;Instance group &#39;#{@instance_group.name}&#39; persistent_disks&#39;s section contains a disk with no name&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_disks calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L254" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L271" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L281" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L291" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L299" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L305" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L310" class="js-smell-location">6</a>                  </div>  </li></ol>
            end

            persistent_disk_collection.add_by_disk_name_and_type(persistent_disk_name, disk_type)

            @links_parser.parse_provider_from_disk(persistent_disk, @deployment.model, @instance_group.name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_disks calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L254" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L271" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L281" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L291" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L299" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L305" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L310" class="js-smell-location">6</a>                  </div>  </li></ol>
          end
        end

        @instance_group.persistent_disk_collection = persistent_disk_collection
      end

      def extract_global_and_instance_group_properties<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#extract_global_and_instance_group_properties has approx 8 statements</span>          </div>  </li></ol>
        # Manifest can contain global and per-instance_group properties section
        instance_group_properties = safe_property(@instance_group_spec, &#39;properties&#39;, :class =&gt; Hash, :optional =&gt; true, :default =&gt; {})

        merged_properties = @deployment.properties.recursive_merge(instance_group_properties)

        mappings = safe_property(@instance_group_spec, &#39;property_mappings&#39;, :class =&gt; Hash, :default =&gt; {})

        mappings.each_pair do |to, from|
          resolved = lookup_property(merged_properties, from)

          if resolved.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#extract_global_and_instance_group_properties performs a nil-check</span>          </div>  </li></ol>
            raise InstanceGroupInvalidPropertyMapping,
                  &quot;Cannot satisfy property mapping &#39;#{to}: #{from}&#39;, as &#39;#{from}&#39; is not in deployment properties&quot;
          end

          merged_properties[to] = resolved
        end
        merged_properties
      end

      def parse_resource_pool<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_resource_pool has a flog score of 72</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_resource_pool has approx 31 statements</span>          </div>  </li></ol>
        env_hash = safe_property(@instance_group_spec, &#39;env&#39;, class: Hash, :default =&gt; {})

        resource_pool_name = safe_property(@instance_group_spec, &#39;resource_pool&#39;, class: String, optional: true)
        vm_type_name = safe_property(@instance_group_spec, &#39;vm_type&#39;, class: String, optional: true)
        vm_resources = safe_property(@instance_group_spec, &#39;vm_resources&#39;, class: Hash, optional: true)

        statement_count = [resource_pool_name, vm_type_name, vm_resources].compact.count
        if statement_count == 0
          raise InstanceGroupBadVmConfiguration,
            &quot;Instance group &#39;#{@instance_group.name}&#39; is missing either &#39;vm_type&#39; or &#39;vm_resources&#39; or &#39;resource_pool&#39; section.&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_resource_pool calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L348" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L351" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L358" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L373" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L385" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L388" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L398" class="js-smell-location">6</a>                  </div>  </li></ol>
        elsif statement_count &gt; 1
          raise InstanceGroupBadVmConfiguration,
            &quot;Instance group &#39;#{@instance_group.name}&#39; can only specify one of &#39;resource_pool&#39;, &#39;vm_type&#39; or &#39;vm_resources&#39; keys.&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_resource_pool calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L348" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L351" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L358" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L373" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L385" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L388" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L398" class="js-smell-location">6</a>                  </div>  </li></ol>
        end

        if resource_pool_name
          resource_pool = @deployment.resource_pool(resource_pool_name)
          if resource_pool.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_resource_pool performs a nil-check</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L356" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L396" class="js-smell-location">1</a>                  </div>  </li></ol>
            raise InstanceGroupUnknownResourcePool,
              &quot;Instance group &#39;#{@instance_group.name}&#39; references an unknown resource pool &#39;#{resource_pool_name}&#39;&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_resource_pool calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L348" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L351" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L358" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L373" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L385" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L388" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L398" class="js-smell-location">6</a>                  </div>  </li></ol>
          end

          vm_type = VmType.new({
            &#39;name&#39; =&gt; resource_pool.name,
            &#39;cloud_properties&#39; =&gt; resource_pool.cloud_properties
          })

          vm_resources = nil
          vm_extensions = []

          stemcell = resource_pool.stemcell

          if !env_hash.empty? &amp;&amp; !resource_pool.env.empty?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_resource_pool calls 'env_hash.empty?' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L371" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L376" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_resource_pool calls 'resource_pool.env' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L371" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L377" class="js-smell-location">1</a>                  </div>  </li></ol>
            raise InstanceGroupAmbiguousEnv,
              &quot;Instance group &#39;#{@instance_group.name}&#39; and resource pool: &#39;#{resource_pool_name}&#39; both declare env properties&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_resource_pool calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L348" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L351" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L358" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L373" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L385" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L388" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L398" class="js-smell-location">6</a>                  </div>  </li></ol>
          end

          if env_hash.empty?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_resource_pool calls 'env_hash.empty?' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L371" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L376" class="js-smell-location">1</a>                  </div>  </li></ol>
            env_hash = resource_pool.env<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_resource_pool calls 'resource_pool.env' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L371" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L377" class="js-smell-location">1</a>                  </div>  </li></ol>
          end

        else
          vm_type = nil

          if vm_type_name
            vm_type = @deployment.vm_type(vm_type_name)
            raise InstanceGroupUnknownVmType, &quot;Instance group &#39;#{@instance_group.name}&#39; references an unknown vm type &#39;#{vm_type_name}&#39;&quot; unless vm_type<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_resource_pool calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L348" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L351" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L358" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L373" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L385" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L388" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L398" class="js-smell-location">6</a>                  </div>  </li></ol>
          elsif vm_resources
            vm_resources = VmResources.new(vm_resources)
            @logger.debug(&quot;Using &#39;vm_resources&#39; block for instance group &#39;#{@instance_group.name}&#39;&quot;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_resource_pool calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L348" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L351" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L358" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L373" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L385" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L388" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L398" class="js-smell-location">6</a>                  </div>  </li></ol>
          end

          vm_extension_names = Array(safe_property(@instance_group_spec, &#39;vm_extensions&#39;, class: Array, optional: true))
          vm_extensions = Array(vm_extension_names).map {|vm_extension_name| @deployment.vm_extension(vm_extension_name)}

          stemcell_name = safe_property(@instance_group_spec, &#39;stemcell&#39;, class: String)
          stemcell = @deployment.stemcell(stemcell_name)
          if stemcell.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_resource_pool performs a nil-check</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L356" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L396" class="js-smell-location">1</a>                  </div>  </li></ol>
            raise InstanceGroupUnknownStemcell,
              &quot;Instance group &#39;#{@instance_group.name}&#39; references an unknown stemcell &#39;#{stemcell_name}&#39;&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_resource_pool calls '@instance_group.name' 7 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L348" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L351" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L358" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L373" class="js-smell-location">3</a>                  <a href="instance_group_spec_parser.html#L385" class="js-smell-location">4</a>                  <a href="instance_group_spec_parser.html#L388" class="js-smell-location">5</a>                  <a href="instance_group_spec_parser.html#L398" class="js-smell-location">6</a>                  </div>  </li></ol>
          end
        end

        @instance_group.vm_resources = vm_resources
        @instance_group.vm_type = vm_type
        @instance_group.vm_extensions = vm_extensions
        @instance_group.stemcell = stemcell
        @instance_group.env = Env.new(env_hash)
      end

      def parse_update_config(parse_options)
        update_spec = safe_property(@instance_group_spec, &quot;update&quot;, class: Hash, optional: true)
        @instance_group.update = UpdateConfig.new((update_spec || {}).merge(parse_options), @deployment.update)
      end

      def parse_desired_instances(availability_zones, networks)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_desired_instances has a flog score of 39</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_desired_instances has approx 12 statements</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Unused-Parameters.md" target="_blank"><b>UnusedParameters</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_desired_instances has unused parameter 'availability_zones'</span>          </div>  </li></ol>
        @instance_group.state = safe_property(@instance_group_spec, &quot;state&quot;, class: String, optional: true)
        instances = safe_property(@instance_group_spec, &quot;instances&quot;, class: Integer)
        instance_states = safe_property(@instance_group_spec, &quot;instance_states&quot;, class: Hash, default: {})

        networks.each do |network|
          static_ips = network.static_ips
          if static_ips &amp;&amp; static_ips.size != instances<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_desired_instances calls 'static_ips.size' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L421" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L423" class="js-smell-location">1</a>                  </div>  </li></ol>
            raise InstanceGroupNetworkInstanceIpMismatch,
              &quot;Instance group &#39;#{@instance_group.name}&#39; has #{instances} instances but was allocated #{static_ips.size} static IPs in network &#39;#{network.name}&#39;&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_desired_instances calls '@instance_group.name' 3 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L423" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L430" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L438" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_desired_instances calls 'static_ips.size' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L421" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L423" class="js-smell-location">1</a>                  </div>  </li></ol>
          end
        end

        instance_states.each_pair do |index_or_id, state|
          unless InstanceGroup::VALID_STATES.include?(state)
            raise InstanceGroupInvalidInstanceState,
              &quot;Invalid state &#39;#{state}&#39; for &#39;#{@instance_group.name}/#{index_or_id}&#39;, valid states are: #{InstanceGroup::VALID_STATES.join(&quot;, &quot;)}&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_desired_instances calls '@instance_group.name' 3 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L423" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L430" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L438" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_desired_instances calls 'InstanceGroup::VALID_STATES.join(", ")' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L430" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L438" class="js-smell-location">1</a>                  </div>  </li></ol>
          end

          @instance_group.instance_states[index_or_id] = state
        end

        if @instance_group.state &amp;&amp; !InstanceGroup::VALID_STATES.include?(@instance_group.state)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_desired_instances calls '@instance_group.state' 3 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L436" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L438" class="js-smell-location">1</a>                  </div>  </li></ol>
          raise InstanceGroupInvalidState,
            &quot;Invalid state &#39;#{@instance_group.state}&#39; for &#39;#{@instance_group.name}&#39;, valid states are: #{InstanceGroup::VALID_STATES.join(&quot;, &quot;)}&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_desired_instances calls '@instance_group.name' 3 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L423" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L430" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L438" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_desired_instances calls '@instance_group.state' 3 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L436" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L438" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_desired_instances calls 'InstanceGroup::VALID_STATES.join(", ")' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L430" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L438" class="js-smell-location">1</a>                  </div>  </li></ol>
        end

        instances.times.map { DesiredInstance.new(@instance_group, @deployment) }
      end

      def parse_migrated_from<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_migrated_from has a flog score of 28</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_migrated_from has approx 6 statements</span>          </div>  </li></ol>
        migrated_from = safe_property(@instance_group_spec, &#39;migrated_from&#39;, class: Array, optional: true, :default =&gt; [])
        migrated_from.each do |migrated_from_job_spec|
          name = safe_property(migrated_from_job_spec, &#39;name&#39;, class: String)
          az = safe_property(migrated_from_job_spec, &#39;az&#39;, class: String, optional: true)
          unless az.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_migrated_from performs a nil-check</span>          </div>  </li></ol>
            unless @instance_group.availability_zones.to_a.map(&amp;:name).include?(az)
              raise DeploymentInvalidMigratedFromJob,
              &quot;Instance group &#39;#{name}&#39; specified for migration to instance group &#39;#{@instance_group.name}&#39; refers to availability zone &#39;#{az}&#39;. &quot; +<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_migrated_from calls '@instance_group.name' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L452" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L453" class="js-smell-location">1</a>                  </div>  </li></ol>
                &quot;Az &#39;#{az}&#39; is not in the list of availability zones of instance group &#39;#{@instance_group.name}&#39;.&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#parse_migrated_from calls '@instance_group.name' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L452" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L453" class="js-smell-location">1</a>                  </div>  </li></ol>
            end
          end
          @instance_group.migrated_from &lt;&lt; MigratedFromJob.new(name, az)
        end
      end

      def validate_jobs<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#validate_jobs has approx 7 statements</span>          </div>  </li></ol>
        template_property = safe_property(@instance_group_spec, &#39;template&#39;, optional: true)
        templates_property = safe_property(@instance_group_spec, &#39;templates&#39;, optional: true)
        jobs_property = safe_property(@instance_group_spec, &#39;jobs&#39;, optional: true)

        if template_property &amp;&amp; templates_property
          raise InstanceGroupInvalidTemplates, &quot;Instance group &#39;#{@instance_group.name}&#39; specifies both template and templates keys, only one is allowed&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#validate_jobs calls '@instance_group.name' 4 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L466" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L470" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L474" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L479" class="js-smell-location">3</a>                  </div>  </li></ol>
        end

        if templates_property &amp;&amp; jobs_property
          raise InstanceGroupInvalidTemplates, &quot;Instance group &#39;#{@instance_group.name}&#39; specifies both templates and jobs keys, only one is allowed&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#validate_jobs calls '@instance_group.name' 4 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L466" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L470" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L474" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L479" class="js-smell-location">3</a>                  </div>  </li></ol>
        end

        if template_property &amp;&amp; jobs_property
          raise InstanceGroupInvalidTemplates, &quot;Instance group &#39;#{@instance_group.name}&#39; specifies both template and jobs keys, only one is allowed&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#validate_jobs calls '@instance_group.name' 4 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L466" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L470" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L474" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L479" class="js-smell-location">3</a>                  </div>  </li></ol>
        end

        if [template_property, templates_property, jobs_property].compact.empty?
          raise ValidationMissingField,
                &quot;Instance group &#39;#{@instance_group.name}&#39; does not specify jobs key&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#validate_jobs calls '@instance_group.name' 4 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L466" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L470" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L474" class="js-smell-location">2</a>                  <a href="instance_group_spec_parser.html#L479" class="js-smell-location">3</a>                  </div>  </li></ol>
        end
      end

      def assign_default_networks(networks)
        Network.valid_defaults.each do |property|
          network = networks.find { |network| network.default_for?(property) }<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#assign_default_networks refers to 'network' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L485" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L486" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#assign_default_networks contains iterators nested 2 deep</span>          </div>  </li></ol>
          @instance_group.default_network[property] = network.name if network<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#assign_default_networks refers to 'network' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L485" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L486" class="js-smell-location">1</a>                  </div>  </li></ol>
        end
      end

      def check_remove_dev_tools
        if Config.remove_dev_tools<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#check_remove_dev_tools calls 'Config.remove_dev_tools' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L491" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L494" class="js-smell-location">1</a>                  </div>  </li></ol>
          @instance_group.env.spec[&#39;bosh&#39;] ||= {}<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#check_remove_dev_tools calls '@instance_group.env' 3 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L492" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L493" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L494" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#check_remove_dev_tools calls '@instance_group.env.spec' 3 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L492" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L493" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L494" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#check_remove_dev_tools calls '@instance_group.env.spec['bosh']' 3 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L492" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L493" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L494" class="js-smell-location">2</a>                  </div>  </li></ol>
          unless @instance_group.env.spec[&#39;bosh&#39;].has_key?(&#39;remove_dev_tools&#39;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#check_remove_dev_tools calls '@instance_group.env' 3 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L492" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L493" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L494" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#check_remove_dev_tools calls '@instance_group.env.spec' 3 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L492" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L493" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L494" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#check_remove_dev_tools calls '@instance_group.env.spec['bosh']' 3 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L492" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L493" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L494" class="js-smell-location">2</a>                  </div>  </li></ol>
            @instance_group.env.spec[&#39;bosh&#39;][&#39;remove_dev_tools&#39;] = Config.remove_dev_tools<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#check_remove_dev_tools calls '@instance_group.env' 3 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L492" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L493" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L494" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#check_remove_dev_tools calls '@instance_group.env.spec' 3 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L492" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L493" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L494" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#check_remove_dev_tools calls '@instance_group.env.spec['bosh']' 3 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L492" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L493" class="js-smell-location">1</a>                  <a href="instance_group_spec_parser.html#L494" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstanceGroupSpecParser#check_remove_dev_tools calls 'Config.remove_dev_tools' 2 times</span>              <span>Locations:</span>                  <a href="instance_group_spec_parser.html#L491" class="js-smell-location">0</a>                  <a href="instance_group_spec_parser.html#L494" class="js-smell-location">1</a>                  </div>  </li></ol>
          end
        end
      end
    end
  end
end
</code>
  </div>
</div>

        </div>
      </div>
    </div>

    <!-- Javascripts -->
    <script src='../../../../../assets/javascripts/jquery.min.js'></script>
    <script src='../../../../../assets/javascripts/jquery.tablesorter.min.js'></script>
    <script src='../../../../../assets/javascripts/jquery.scrollTo.min.js'></script>
    <script src='../../../../../assets/javascripts/jquery.timeago.js'></script>
    <script src='../../../../../assets/javascripts/highcharts.src-4.0.1.js'></script>
    <script src='../../../../../assets/javascripts/prettify.js'></script>
    <script src='../../../../../assets/javascripts/bootstrap.min.js'></script>
    <script src='../../../../../assets/javascripts/application.js'></script>
    <script src='../../../../../assets/javascripts/jquery.filtertable.min.js'></script>
  </body>
</html>
