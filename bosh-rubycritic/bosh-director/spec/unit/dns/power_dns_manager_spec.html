<!DOCTYPE html>
<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ruby Critic - Home</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- StyleSheets -->
    <link href="../../../../assets/stylesheets/bootstrap.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../../assets/stylesheets/font-awesome.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../../assets/stylesheets/prettify.custom_theme.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../../assets/stylesheets/application.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  </head>

  <body>
    <header class="navbar navbar-default navbar-fixed-top">
      <a href="#menu-toggle" class="btn btn-default hidden-lg visible-sm-* hidden-md visible-xs-* pull-left" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a>
      <a href="../../../../overview.html"><img src="../../../../assets/images/logo.png" title="Ruby Critic Logo" width="55"><span class="logo">RUBYCRITIC</span></a>
    </header>
    <div id="wrapper">
      <!-- Sidebar -->
      <aside id="sidebar-wrapper">
        <ul class="sidebar-nav">
          <li class="sidebar-item">
            <a href="../../../../overview.html" class="project-nav-item overview-nav"><i class="fa fa-dashboard"></i>Overview</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../../code_index.html" class="project-nav-item code-index-nav"><i class="fa fa-code"></i>Code</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../../smells_index.html" class="project-nav-item smells-index-nav"><i class="fa fa-warning"></i>Smells</a>
          </li>
        </ul>
      </aside>
      <!-- /#sidebar-wrapper -->
      <div id="page-content-wrapper">
        <div class="container-fluid">
          <div class="row">
  <!--Page Title -->
  <div class="Page_Title">
    <div class="file-time">
      <span class="committed-at">
        
          Updated <time class='js-timeago' datetime='2018-05-31 10:14:31 -0700'>2018-05-31 10:14:31 -0700</time>
        
      </span>
    </div>
    <div>
      <h3><small>bosh-director/spec/unit/dns /</small> power_dns_manager_spec.rb</h3>
    </div>
  </div>
  <!--End Page Title -->
  <div class="Content_Wrapper">
    <!-- code detail -->
    <div class="code-top-detail clearfix row">
      <div class="col-md-8">
        <div class="row">
          <div class="col-md-1">
            <div class="rating f big">
              F
            </div>
          </div>
          <div class="code-statistics col-md-11">
            <div class="col-md-3">
              <div><span class="metric">277</span><small> lines of codes</small></div>
              <div><span class="metric">0</span><small> methods</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">N/A</span><small> complexity/method</small></div>
              <div><span class="metric">62</span><small> churn</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">692.24</span><small> complexity</small></div>
              <div><span class="metric">225</span><small> duplications</small></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="code-tabs">
          <ul class="nav nav-pills right-to-left">
            <li><a href="#" id="toggle-code" class="toggle-button button">code</a></li>
            <li class="active">
              <a href="#" id="toggle-smells" class="toggle-button button">
                14
                smells
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <code class="prettyprint linenums lang-ruby file-code js-file-code">require &#39;spec_helper&#39;

module Bosh::Director<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Irresponsible-Module.md" target="_blank"><b>IrresponsibleModule</b></a>        </span>      </div>      <span>Bosh::Director has no descriptive comment</span>          </div>  </li></ol>
  describe PowerDnsManager do
    subject(:powerdns_manager) { described_class.new(domain.name, dns_config, dns_provider, logger) }

    let(:instance_model) do
      Models::Instance.make(
          uuid: &#39;fake-uuid&#39;,
          index: 0,
          job: &#39;job-a&#39;,
          deployment: deployment_model,
          spec_json: spec_json
      )
    end
    let(:spec_json) { &#39;{}&#39; }
    let(:deployment_model) { Models::Deployment.make(name: &#39;bosh.1&#39;) }
    let(:domain) { Models::Dns::Domain.make(name: &#39;bosh&#39;, type: &#39;NATIVE&#39;) }
    let(:dns_config) do
      {}
    end
    let(:dns_provider) { nil }
    let(:blobstore) { instance_double(Bosh::Blobstore::S3cliBlobstoreClient) }
    let(:root_domain) { &#39;bosh1.tld&#39; }

    describe &#39;#flush_dns_cache&#39; do
      let(:dns_config) do
        { &#39;domain_name&#39; =&gt; domain.name, &#39;flush_command&#39; =&gt; flush_command }
      end
      let(:flush_command) { nil }

      context &#39;when flush command is present&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="power_dns_manager_spec.html#L32" class="js-smell-location">0</a>                  <a href="power_dns_manager_spec.html#L41" class="js-smell-location">1</a>                  </div>  </li></ol>
        let(:flush_command) { &quot;echo \&quot;7\&quot; &amp;&amp; exit 0&quot; }

        it &#39;logs success&#39; do
          expect(logger).to receive(:debug).with(&quot;Flushed 7 records from DNS cache&quot;)
          powerdns_manager.flush_dns_cache
        end
      end

      context &#39;when running flush command fails&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="power_dns_manager_spec.html#L32" class="js-smell-location">0</a>                  <a href="power_dns_manager_spec.html#L41" class="js-smell-location">1</a>                  </div>  </li></ol>
        let(:flush_command) { &quot;echo fake failure &gt;&amp;2 &amp;&amp; exit 1&quot; }

        it &#39;logs an error&#39; do
          expect(logger).to receive(:warn).with(&quot;Failed to flush DNS cache: fake failure&quot;)
          powerdns_manager.flush_dns_cache
        end
      end

      context &#39;when flush command is not present&#39; do
        it &#39;does not do anything&#39; do
          expect(Open3).to_not receive(:capture3)
          expect {
            powerdns_manager.flush_dns_cache
          }.to_not raise_error
        end
      end

      context &#39;when dns_publisher is disabled&#39; do
        it &#39;calls nothing on the dns_publisher&#39; do
          powerdns_manager.flush_dns_cache
        end
      end
    end

    describe &#39;#find_dns_record_names_by_instance&#39; do
      context &#39;instance model is not set&#39; do
        let(:instance_model) { nil }

        it &#39;returns an empty list&#39; do
          expect(powerdns_manager.find_dns_record_names_by_instance(instance_model)).to eq([])
        end
      end

      context &#39;instance model is set&#39; do
        let(:instance_model) { Models::Instance.make(uuid: &#39;fake-uuid&#39;, index: 0, job: &#39;job-a&#39;, deployment: deployment_model, dns_records: &#39;[&quot;test1.example.com&quot;,&quot;test2.example.com&quot;]&#39;) }

        it &#39;returns an empty list&#39; do
          expect(powerdns_manager.find_dns_record_names_by_instance(instance_model)).to eq([&#39;test1.example.com&#39;, &#39;test2.example.com&#39;])
        end
      end
    end

    context &#39;when PowerDNS is enabled&#39; do
      let(:dns_provider) { PowerDns.new(domain.name, logger) }

      describe &#39;#dns_enabled?&#39; do
        it &#39;should be true&#39; do
          expect(powerdns_manager.dns_enabled?).to eq(true)
        end
      end

      describe &#39;#delete_dns_for_instance&#39; do
        before do
          powerdns_manager.update_dns_record_for_instance(instance_model, {&#39;fake-dns-name-1&#39; =&gt; &#39;1.2.3.4&#39;, &#39;fake-dns-name-2&#39; =&gt; &#39;5.6.7.8&#39;})
        end

        it &#39;deletes dns records from dns provider&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::context(when PowerDNS is enabled)::describe(#delete_dns_for_instance)::it#deletes dns records from dns provider has a flog score of 44</span>          </div>  </li></ol>
          expect(dns_provider.find_dns_record(&#39;fake-dns-name-1&#39;, &#39;1.2.3.4&#39;)).to_not be_nil
          expect(dns_provider.find_dns_record(&#39;fake-dns-name-2&#39;, &#39;5.6.7.8&#39;)).to_not be_nil
          powerdns_manager.delete_dns_for_instance(instance_model)
          expect(dns_provider.find_dns_record(&#39;fake-dns-name-1&#39;, &#39;1.2.3.4&#39;)).to be_nil
          expect(dns_provider.find_dns_record(&#39;fake-dns-name-2&#39;, &#39;5.6.7.8&#39;)).to be_nil
        end

        it &#39;deletes dns records from instance model&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::context(when PowerDNS is enabled)::describe(#delete_dns_for_instance)::it#deletes dns records from instance model has a flog score of 30</span>          </div>  </li></ol>
          expect(instance_model.dns_record_names.to_a).to eq([&#39;fake-dns-name-1&#39;, &#39;fake-dns-name-2&#39;])
          powerdns_manager.delete_dns_for_instance(instance_model)
          expect(instance_model.dns_record_names.to_a).to eq([])
        end

        context &#39;when instance has records in dns provider but not in instance model&#39; do
          before do
            dns_provider.create_or_update_dns_records(&#39;fake-uuid.job-a.network-a.dep.bosh&#39;, &#39;1.2.3.4&#39;)
          end

          it &#39;removes them from dns provider&#39; do
            powerdns_manager.delete_dns_for_instance(instance_model)
            expect(dns_provider.find_dns_record(&#39;0.job-a.network-a.dep.bosh&#39;, &#39;1.2.3.4&#39;)).to be_nil
          end
        end
      end

      describe &#39;#configure_nameserver&#39; do
        context &#39;dns is enabled&#39; do
          let(:dns_config) do
            { &#39;domain_name&#39; =&gt; domain.name, &#39;address&#39; =&gt; &#39;1.2.3.4&#39; }
          end
          it &#39;creates name server records&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::context(when PowerDNS is enabled)::describe(#configure_nameserver)::context(dns is enabled)::it#creates name server records has a flog score of 39</span>          </div>  </li></ol>
            powerdns_manager.configure_nameserver
            ns_record = Models::Dns::Record.find(name: &#39;bosh&#39;, type: &#39;NS&#39;)
            a_record = Models::Dns::Record.find(type: &#39;A&#39;)
            soa_record = Models::Dns::Record.find(name: &#39;bosh&#39;, type: &#39;SOA&#39;)
            domain = Models::Dns::Domain.find(name: &#39;bosh&#39;, type: &#39;NATIVE&#39;)
            expect(ns_record.content).to eq(&#39;ns.bosh&#39;)
            expect(a_record.content).to eq(&#39;1.2.3.4&#39;)
            expect(soa_record.content).to eq(PowerDns::SOA)
            expect(domain).to_not eq(nil)
          end
        end
      end

      describe &#39;#update_dns_record_for_instance&#39; do
        let(:spec_json) { JSON.dump({&#39;networks&#39; =&gt; {&#39;net-name&#39; =&gt; {&#39;ip&#39; =&gt; &#39;1234&#39;}}}) }
        before do
          instance_model.update(availability_zone: &#39;az1&#39;)
          powerdns_manager.update_dns_record_for_instance(instance_model, {&#39;fake-dns-name-1&#39; =&gt; &#39;1.2.3.4&#39;, &#39;fake-dns-name-2&#39; =&gt; &#39;5.6.7.8&#39;})
        end

        it &#39;updates dns records for instance in database&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::context(when PowerDNS is enabled)::describe(#update_dns_record_for_instance)::it#updates dns records for instance in database has a flog score of 26</span>          </div>  </li></ol>
          expect(instance_model.dns_record_names).to eq([&#39;fake-dns-name-1&#39;, &#39;fake-dns-name-2&#39;])
          powerdns_manager.update_dns_record_for_instance(instance_model, {&#39;fake-dns-name-3&#39; =&gt; &#39;9.8.7.6&#39;})
          expect(instance_model.dns_record_names).to eq([&#39;fake-dns-name-1&#39;, &#39;fake-dns-name-2&#39;, &#39;fake-dns-name-3&#39;])
        end

        it &#39;appends the records to the model&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="power_dns_manager_spec.html#L156" class="js-smell-location">0</a>                  <a href="power_dns_manager_spec.html#L166" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::context(when PowerDNS is enabled)::describe(#update_dns_record_for_instance)::it#appends the records to the model has a flog score of 63</span>          </div>  </li></ol>
          expect(instance_model.dns_record_names).to eq([&#39;fake-dns-name-1&#39;, &#39;fake-dns-name-2&#39;])
          powerdns_manager.update_dns_record_for_instance(instance_model, {&#39;another-dns-name-1&#39; =&gt; &#39;1.2.3.4&#39;, &#39;another-dns-name-2&#39; =&gt; &#39;5.6.7.8&#39;})
          expect(instance_model.dns_record_names).to eq([&#39;fake-dns-name-1&#39;, &#39;fake-dns-name-2&#39;, &#39;another-dns-name-1&#39;, &#39;another-dns-name-2&#39;])
          expect(dns_provider.find_dns_record(&#39;fake-dns-name-1&#39;, &#39;1.2.3.4&#39;)).to_not be_nil
          expect(dns_provider.find_dns_record(&#39;fake-dns-name-2&#39;, &#39;5.6.7.8&#39;)).to_not be_nil
          expect(dns_provider.find_dns_record(&#39;another-dns-name-1&#39;, &#39;1.2.3.4&#39;)).to_not be_nil
          expect(dns_provider.find_dns_record(&#39;another-dns-name-2&#39;, &#39;5.6.7.8&#39;)).to_not be_nil
        end

        it &#39;it keeps old record names pointing at their original ips&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="power_dns_manager_spec.html#L156" class="js-smell-location">0</a>                  <a href="power_dns_manager_spec.html#L166" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::context(when PowerDNS is enabled)::describe(#update_dns_record_for_instance)::it#it keeps old record names pointing at their original ips has a flog score of 63</span>          </div>  </li></ol>
          expect(instance_model.dns_record_names).to eq([&#39;fake-dns-name-1&#39;, &#39;fake-dns-name-2&#39;])
          powerdns_manager.update_dns_record_for_instance(instance_model, {&#39;another-dns-name-1&#39; =&gt; &#39;1.2.3.5&#39;, &#39;another-dns-name-2&#39; =&gt; &#39;5.6.7.9&#39;})
          expect(instance_model.dns_record_names).to eq([&#39;fake-dns-name-1&#39;, &#39;fake-dns-name-2&#39;, &#39;another-dns-name-1&#39;, &#39;another-dns-name-2&#39;])
          expect(dns_provider.find_dns_record(&#39;fake-dns-name-1&#39;, &#39;1.2.3.4&#39;)).to_not be_nil
          expect(dns_provider.find_dns_record(&#39;fake-dns-name-2&#39;, &#39;5.6.7.8&#39;)).to_not be_nil
          expect(dns_provider.find_dns_record(&#39;another-dns-name-1&#39;, &#39;1.2.3.5&#39;)).to_not be_nil
          expect(dns_provider.find_dns_record(&#39;another-dns-name-2&#39;, &#39;5.6.7.9&#39;)).to_not be_nil
        end

        context &#39;when the dns entry already exists&#39; do
          it &#39;updates the DNS record when the IP address has changed&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="power_dns_manager_spec.html#L177" class="js-smell-location">0</a>                  <a href="power_dns_manager_spec.html#L184" class="js-smell-location">1</a>                  </div>  </li></ol>
            powerdns_manager.update_dns_record_for_instance(instance_model, {&#39;fake-dns-name-2&#39; =&gt; &#39;9.8.7.6&#39;})

            dns_record = Models::Dns::Record.find(name: &#39;fake-dns-name-2&#39;)
            expect(dns_record.content).to eq(&#39;9.8.7.6&#39;)
          end

          it &#39;does NOT update the DNS record when the IP address is the same&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="power_dns_manager_spec.html#L177" class="js-smell-location">0</a>                  <a href="power_dns_manager_spec.html#L184" class="js-smell-location">1</a>                  </div>  </li></ol>
            powerdns_manager.update_dns_record_for_instance(instance_model, {&#39;fake-dns-name-2&#39; =&gt; &#39;5.6.7.8&#39;})

            dns_record = Models::Dns::Record.find(name: &#39;fake-dns-name-2&#39;)
            expect(dns_record.content).to eq(&#39;5.6.7.8&#39;)
          end
        end
      end

      describe &#39;#migrate_legacy_records&#39; do
        before do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="power_dns_manager_spec.html#L194" class="js-smell-location">0</a>                  <a href="../../../../spec/gocli/integration/config_server/config_server_cpi_config_spec.html#L19" class="js-smell-location">1</a>                  </div>  </li></ol>
          dns_provider.create_or_update_dns_records(&#39;0.job-a.network-a.bosh1.bosh&#39;, &#39;1.2.3.4&#39;)
          dns_provider.create_or_update_dns_records(&#39;fake-uuid.job-a.network-a.bosh1.bosh&#39;, &#39;1.2.3.4&#39;)
          dns_provider.create_or_update_dns_records(&#39;0.job-a.network-b.bosh1.bosh&#39;, &#39;5.6.7.8&#39;)
          dns_provider.create_or_update_dns_records(&#39;fake-uuid.job-a.network-b.bosh1.bosh&#39;, &#39;5.6.7.8&#39;)
        end

        it &#39;saves instance dns records for all networks in local instance model&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::context(when PowerDNS is enabled)::describe(#migrate_legacy_records)::it#saves instance dns records for all networks in local instance model has a flog score of 26</span>          </div>  </li></ol>
          expect(instance_model.dns_record_names).to be_nil

          powerdns_manager.migrate_legacy_records(instance_model)

          expect(instance_model.dns_record_names).to match_array([
            &#39;0.job-a.network-a.bosh1.bosh&#39;,
            &#39;fake-uuid.job-a.network-a.bosh1.bosh&#39;,
            &#39;0.job-a.network-b.bosh1.bosh&#39;,
            &#39;fake-uuid.job-a.network-b.bosh1.bosh&#39;
          ])
        end

        context &#39;when instance model has dns records&#39; do
          before do
            instance_model.update(dns_record_names: [&#39;anything&#39;])
          end

          it &#39;does not migrate&#39; do
            powerdns_manager.migrate_legacy_records(instance_model)
            expect(instance_model.dns_record_names).to match_array([&#39;anything&#39;])
          end
        end
      end
    end

    context &#39;when PowerDNS is disabled&#39; do
      let(:instance_model) { Models::Instance.make(uuid: &#39;fake-uuid&#39;, index: 0, job: &#39;job-a&#39;, deployment: deployment_model) }

      describe &#39;#dns_enabled?&#39; do
        it &#39;should be false&#39; do
          expect(powerdns_manager.dns_enabled?).to eq(false)
        end
      end

      describe &#39;#delete_dns_for_instance&#39; do
        it &#39;returns with no errors&#39; do
          powerdns_manager.delete_dns_for_instance(instance_model)
        end
      end

      describe &#39;#migrate_legacy_records&#39; do
        it &#39;does not migrate&#39; do
          powerdns_manager.migrate_legacy_records(instance_model)
          expect(instance_model.dns_record_names.to_a).to match_array([])
        end
      end

      describe &#39;#configure_nameserver&#39; do
        it &#39;creates nothing&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::context(when PowerDNS is disabled)::describe(#configure_nameserver)::it#creates nothing has a flog score of 31</span>          </div>  </li></ol>
          powerdns_manager.configure_nameserver
          ns_record = Models::Dns::Record.find(name: domain.name, type: &#39;NS&#39;)
          a_record = Models::Dns::Record.find(type: &#39;A&#39;)
          soa_record = Models::Dns::Record.find(name: domain.name, type: &#39;SOA&#39;)
          expect(ns_record).to eq(nil)
          expect(a_record).to eq(nil)
          expect(soa_record).to eq(nil)
        end
      end

      describe &#39;#update_dns_record_for_instance&#39; do
        before do
          powerdns_manager.update_dns_record_for_instance(instance_model, {&#39;fake-dns-name-1&#39; =&gt; &#39;1.2.3.4&#39;, &#39;fake-dns-name-2&#39; =&gt; &#39;5.6.7.8&#39;})
        end

        context &#39;when IPs/hosts change&#39; do
          it &#39;updates dns records for instance&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::context(when PowerDNS is disabled)::describe(#update_dns_record_for_instance)::context(when IPs/hosts change)::it#updates dns records for instance has a flog score of 35</span>          </div>  </li></ol>
            expect(instance_model.dns_record_names).to eq([&#39;fake-dns-name-1&#39;, &#39;fake-dns-name-2&#39;])
            powerdns_manager.update_dns_record_for_instance(instance_model, {&#39;fake-dns-name-1&#39; =&gt; &#39;11.22.33.44&#39;, &#39;new-fake-dns-name&#39; =&gt; &#39;99.88.77.66&#39;})
            expect(instance_model.dns_record_names).to eq([&#39;fake-dns-name-1&#39;, &#39;fake-dns-name-2&#39;, &#39;new-fake-dns-name&#39;])
            expect(Models::Dns::Record.all.count).to eq(0)
          end
        end
      end
    end
  end
end
</code>
  </div>
</div>

        </div>
      </div>
    </div>

    <!-- Javascripts -->
    <script src='../../../../assets/javascripts/jquery.min.js'></script>
    <script src='../../../../assets/javascripts/jquery.tablesorter.min.js'></script>
    <script src='../../../../assets/javascripts/jquery.scrollTo.min.js'></script>
    <script src='../../../../assets/javascripts/jquery.timeago.js'></script>
    <script src='../../../../assets/javascripts/highcharts.src-4.0.1.js'></script>
    <script src='../../../../assets/javascripts/prettify.js'></script>
    <script src='../../../../assets/javascripts/bootstrap.min.js'></script>
    <script src='../../../../assets/javascripts/application.js'></script>
    <script src='../../../../assets/javascripts/jquery.filtertable.min.js'></script>
  </body>
</html>
