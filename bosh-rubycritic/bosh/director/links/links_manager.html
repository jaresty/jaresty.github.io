<!DOCTYPE html>
<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ruby Critic - Home</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- StyleSheets -->
    <link href="../../../assets/stylesheets/bootstrap.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../assets/stylesheets/font-awesome.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../assets/stylesheets/prettify.custom_theme.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../assets/stylesheets/application.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  </head>

  <body>
    <header class="navbar navbar-default navbar-fixed-top">
      <a href="#menu-toggle" class="btn btn-default hidden-lg visible-sm-* hidden-md visible-xs-* pull-left" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a>
      <a href="../../../overview.html"><img src="../../../assets/images/logo.png" title="Ruby Critic Logo" width="55"><span class="logo">RUBYCRITIC</span></a>
    </header>
    <div id="wrapper">
      <!-- Sidebar -->
      <aside id="sidebar-wrapper">
        <ul class="sidebar-nav">
          <li class="sidebar-item">
            <a href="../../../overview.html" class="project-nav-item overview-nav"><i class="fa fa-dashboard"></i>Overview</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../code_index.html" class="project-nav-item code-index-nav"><i class="fa fa-code"></i>Code</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../smells_index.html" class="project-nav-item smells-index-nav"><i class="fa fa-warning"></i>Smells</a>
          </li>
        </ul>
      </aside>
      <!-- /#sidebar-wrapper -->
      <div id="page-content-wrapper">
        <div class="container-fluid">
          <div class="row">
  <!--Page Title -->
  <div class="Page_Title">
    <div class="file-time">
      <span class="committed-at">
        
          Updated <time class='js-timeago' datetime='2018-06-26 14:44:05 -0700'>2018-06-26 14:44:05 -0700</time>
        
      </span>
    </div>
    <div>
      <h3><small>bosh/director/links /</small> links_manager.rb</h3>
    </div>
  </div>
  <!--End Page Title -->
  <div class="Content_Wrapper">
    <!-- code detail -->
    <div class="code-top-detail clearfix row">
      <div class="col-md-8">
        <div class="row">
          <div class="col-md-1">
            <div class="rating f big">
              F
            </div>
          </div>
          <div class="code-statistics col-md-11">
            <div class="col-md-3">
              <div><span class="metric">571</span><small> lines of codes</small></div>
              <div><span class="metric">25</span><small> methods</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">26.2</span><small> complexity/method</small></div>
              <div><span class="metric">46</span><small> churn</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">654.57</span><small> complexity</small></div>
              <div><span class="metric">214</span><small> duplications</small></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="code-tabs">
          <ul class="nav nav-pills right-to-left">
            <li><a href="#" id="toggle-code" class="toggle-button button">code</a></li>
            <li class="active">
              <a href="#" id="toggle-smells" class="toggle-button button">
                136
                smells
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <code class="prettyprint linenums lang-ruby file-code js-file-code">module Bosh::Director::Links
  class LinksManager<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Irresponsible-Module.md" target="_blank"><b>IrresponsibleModule</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager has no descriptive comment</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Methods.md" target="_blank"><b>TooManyMethods</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager has at least 25 methods</span>          </div>  </li></ol>
    include Bosh::Director::IpUtil

    def initialize(serial_id, logger = Bosh::Director::Config.logger, event_logger = Bosh::Director::Config.event_log)
      @logger = logger
      @event_logger = event_logger
      @serial_id = serial_id
    end

    def find_or_create_provider(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="links_manager.html#L11" class="js-smell-location">0</a>                  <a href="links_manager.html#L70" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_provider has 4 parameters</span>          </div>  </li></ol>
      deployment_model:,
      instance_group_name:,
      name:,
      type:
    )
      Bosh::Director::Models::Links::LinkProvider.find_or_create(
        deployment: deployment_model,
        instance_group: instance_group_name,
        name: name,
        type: type,
      ).tap do |result|
        if result.serial_id != @serial_id<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_provider refers to 'result' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L23" class="js-smell-location">0</a>                  <a href="links_manager.html#L24" class="js-smell-location">1</a>                  <a href="links_manager.html#L25" class="js-smell-location">2</a>                  </div>  </li></ol>
          result.serial_id = @serial_id<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_provider refers to 'result' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L23" class="js-smell-location">0</a>                  <a href="links_manager.html#L24" class="js-smell-location">1</a>                  <a href="links_manager.html#L25" class="js-smell-location">2</a>                  </div>  </li></ol>
          result.save<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_provider refers to 'result' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L23" class="js-smell-location">0</a>                  <a href="links_manager.html#L24" class="js-smell-location">1</a>                  <a href="links_manager.html#L25" class="js-smell-location">2</a>                  </div>  </li></ol>
        end
      end
    end

    def find_provider(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_provider has 4 parameters</span>          </div>  </li></ol>
      deployment_model:,
      instance_group_name:,
      name:,
      type:
    )
      Bosh::Director::Models::Links::LinkProvider.find(
        deployment: deployment_model,
        instance_group: instance_group_name,
        name: name,
        type: type,
        serial_id: @serial_id,
      )
    end

    # Used by provider, not using alias because want to update existing provider intent when alias changes
    def find_or_create_provider_intent(
      link_provider:,
      link_original_name:,
      link_type:
    )
      intent = Bosh::Director::Models::Links::LinkProviderIntent.find(
        link_provider: link_provider,
        original_name: link_original_name,
      )

      if intent.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_provider_intent refers to 'intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L56" class="js-smell-location">0</a>                  <a href="links_manager.html#L63" class="js-smell-location">1</a>                  <a href="links_manager.html#L66" class="js-smell-location">2</a>                  <a href="links_manager.html#L67" class="js-smell-location">3</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_provider_intent performs a nil-check</span>          </div>  </li></ol>
        intent = Bosh::Director::Models::Links::LinkProviderIntent.create(
          link_provider: link_provider,
          original_name: link_original_name,
          type: link_type,
        )
      else
        intent.type = link_type<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_provider_intent refers to 'intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L56" class="js-smell-location">0</a>                  <a href="links_manager.html#L63" class="js-smell-location">1</a>                  <a href="links_manager.html#L66" class="js-smell-location">2</a>                  <a href="links_manager.html#L67" class="js-smell-location">3</a>                  </div>  </li></ol>
      end

      intent.serial_id = @serial_id if intent.serial_id != @serial_id<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_provider_intent refers to 'intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L56" class="js-smell-location">0</a>                  <a href="links_manager.html#L63" class="js-smell-location">1</a>                  <a href="links_manager.html#L66" class="js-smell-location">2</a>                  <a href="links_manager.html#L67" class="js-smell-location">3</a>                  </div>  </li></ol>
      intent.save<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_provider_intent refers to 'intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L56" class="js-smell-location">0</a>                  <a href="links_manager.html#L63" class="js-smell-location">1</a>                  <a href="links_manager.html#L66" class="js-smell-location">2</a>                  <a href="links_manager.html#L67" class="js-smell-location">3</a>                  </div>  </li></ol>
    end

    def find_or_create_consumer(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="links_manager.html#L11" class="js-smell-location">0</a>                  <a href="links_manager.html#L70" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_consumer has 4 parameters</span>          </div>  </li></ol>
      deployment_model:,
      instance_group_name:,
      name:,
      type:
    )
      Bosh::Director::Models::Links::LinkConsumer.find_or_create(
        deployment: deployment_model,
        instance_group: instance_group_name,
        name: name,
        type: type,
      ).tap do |result|
        if result.serial_id != @serial_id<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_consumer refers to 'result' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L82" class="js-smell-location">0</a>                  <a href="links_manager.html#L83" class="js-smell-location">1</a>                  <a href="links_manager.html#L84" class="js-smell-location">2</a>                  </div>  </li></ol>
          result.serial_id = @serial_id<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_consumer refers to 'result' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L82" class="js-smell-location">0</a>                  <a href="links_manager.html#L83" class="js-smell-location">1</a>                  <a href="links_manager.html#L84" class="js-smell-location">2</a>                  </div>  </li></ol>
          result.save<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_consumer refers to 'result' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L82" class="js-smell-location">0</a>                  <a href="links_manager.html#L83" class="js-smell-location">1</a>                  <a href="links_manager.html#L84" class="js-smell-location">2</a>                  </div>  </li></ol>
        end
      end
    end

    def find_consumer(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_consumer has 4 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_consumer doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
      deployment_model:,
      instance_group_name:,
      name:,
      type:
    )
      Bosh::Director::Models::Links::LinkConsumer.find(
        deployment: deployment_model,
        instance_group: instance_group_name,
        name: name,
        type: type,
        serial_id: deployment_model.links_serial_id,
      )
    end

    def find_or_create_consumer_intent(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_consumer_intent has 4 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_consumer_intent has approx 7 statements</span>          </div>  </li></ol>
      link_consumer:,
      link_original_name:,
      link_type:,
      new_intent_metadata:
    )
      intent = Bosh::Director::Models::Links::LinkConsumerIntent.find(
        link_consumer: link_consumer,
        original_name: link_original_name,
      )

      if intent.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_consumer_intent refers to 'intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L115" class="js-smell-location">0</a>                  <a href="links_manager.html#L124" class="js-smell-location">1</a>                  <a href="links_manager.html#L125" class="js-smell-location">2</a>                  <a href="links_manager.html#L127" class="js-smell-location">3</a>                  <a href="links_manager.html#L130" class="js-smell-location">4</a>                  <a href="links_manager.html#L131" class="js-smell-location">5</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_consumer_intent performs a nil-check</span>              <span>Locations:</span>                  <a href="links_manager.html#L115" class="js-smell-location">0</a>                  <a href="links_manager.html#L123" class="js-smell-location">1</a>                  </div>  </li></ol>
        intent = Bosh::Director::Models::Links::LinkConsumerIntent.create(
          link_consumer: link_consumer,
          original_name: link_original_name,
          type: link_type,
          metadata: new_intent_metadata.to_json,
        )
      else
        if !new_intent_metadata.nil? &amp;&amp; !new_intent_metadata.keys.empty?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_consumer_intent performs a nil-check</span>              <span>Locations:</span>                  <a href="links_manager.html#L115" class="js-smell-location">0</a>                  <a href="links_manager.html#L123" class="js-smell-location">1</a>                  </div>  </li></ol>
          existing_metadata = JSON.parse(intent.metadata) || {}<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_consumer_intent refers to 'intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L115" class="js-smell-location">0</a>                  <a href="links_manager.html#L124" class="js-smell-location">1</a>                  <a href="links_manager.html#L125" class="js-smell-location">2</a>                  <a href="links_manager.html#L127" class="js-smell-location">3</a>                  <a href="links_manager.html#L130" class="js-smell-location">4</a>                  <a href="links_manager.html#L131" class="js-smell-location">5</a>                  </div>  </li></ol>
          intent.metadata = existing_metadata.merge(new_intent_metadata).to_json<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_consumer_intent refers to 'intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L115" class="js-smell-location">0</a>                  <a href="links_manager.html#L124" class="js-smell-location">1</a>                  <a href="links_manager.html#L125" class="js-smell-location">2</a>                  <a href="links_manager.html#L127" class="js-smell-location">3</a>                  <a href="links_manager.html#L130" class="js-smell-location">4</a>                  <a href="links_manager.html#L131" class="js-smell-location">5</a>                  </div>  </li></ol>
        end
        intent.type = link_type<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_consumer_intent refers to 'intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L115" class="js-smell-location">0</a>                  <a href="links_manager.html#L124" class="js-smell-location">1</a>                  <a href="links_manager.html#L125" class="js-smell-location">2</a>                  <a href="links_manager.html#L127" class="js-smell-location">3</a>                  <a href="links_manager.html#L130" class="js-smell-location">4</a>                  <a href="links_manager.html#L131" class="js-smell-location">5</a>                  </div>  </li></ol>
      end

      intent.serial_id = @serial_id<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_consumer_intent refers to 'intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L115" class="js-smell-location">0</a>                  <a href="links_manager.html#L124" class="js-smell-location">1</a>                  <a href="links_manager.html#L125" class="js-smell-location">2</a>                  <a href="links_manager.html#L127" class="js-smell-location">3</a>                  <a href="links_manager.html#L130" class="js-smell-location">4</a>                  <a href="links_manager.html#L131" class="js-smell-location">5</a>                  </div>  </li></ol>
      intent.save<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_consumer_intent refers to 'intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L115" class="js-smell-location">0</a>                  <a href="links_manager.html#L124" class="js-smell-location">1</a>                  <a href="links_manager.html#L125" class="js-smell-location">2</a>                  <a href="links_manager.html#L127" class="js-smell-location">3</a>                  <a href="links_manager.html#L130" class="js-smell-location">4</a>                  <a href="links_manager.html#L131" class="js-smell-location">5</a>                  </div>  </li></ol>
    end

    def find_or_create_link(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_link has 4 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_link has approx 9 statements</span>          </div>  </li></ol>
      name:,
      provider_intent:,
      consumer_intent:,
      link_content:
    )
      found_link = nil
      found_links = Bosh::Director::Models::Links::Link.where(
        link_provider_intent_id: provider_intent &amp;&amp; provider_intent[:id],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_link calls 'provider_intent[:id]' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L142" class="js-smell-location">0</a>                  <a href="links_manager.html#L158" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_link refers to 'provider_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L142" class="js-smell-location">0</a>                  <a href="links_manager.html#L158" class="js-smell-location">1</a>                  </div>  </li></ol>
        link_consumer_intent_id: consumer_intent &amp;&amp; consumer_intent[:id],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_link calls 'consumer_intent[:id]' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L143" class="js-smell-location">0</a>                  <a href="links_manager.html#L159" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_link refers to 'consumer_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L143" class="js-smell-location">0</a>                  <a href="links_manager.html#L159" class="js-smell-location">1</a>                  </div>  </li></ol>
      )

      found_links&amp;.each do |link|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_link performs a nil-check</span>          </div>  </li></ol>
        db_content = JSON.parse(link.link_content)
        new_content = JSON.parse(link_content)
        if are_equal(db_content, new_content)
          found_link = link
          break
        end
      end

      unless found_link
        return Bosh::Director::Models::Links::Link.create(
          name: name,
          link_provider_intent_id: provider_intent &amp;&amp; provider_intent[:id],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_link calls 'provider_intent[:id]' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L142" class="js-smell-location">0</a>                  <a href="links_manager.html#L158" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_link refers to 'provider_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L142" class="js-smell-location">0</a>                  <a href="links_manager.html#L158" class="js-smell-location">1</a>                  </div>  </li></ol>
          link_consumer_intent_id: consumer_intent &amp;&amp; consumer_intent[:id],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_link calls 'consumer_intent[:id]' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L143" class="js-smell-location">0</a>                  <a href="links_manager.html#L159" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#find_or_create_link refers to 'consumer_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L143" class="js-smell-location">0</a>                  <a href="links_manager.html#L159" class="js-smell-location">1</a>                  </div>  </li></ol>
          link_content: link_content,
        )
      end

      found_link
    end

    def resolve_deployment_links(deployment_model, options)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_deployment_links has a flog score of 26</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_deployment_links has approx 15 statements</span>          </div>  </li></ol>
      dry_run = options.fetch(:dry_run, false)
      global_use_dns_entry = options.fetch(:global_use_dns_entry)

      links_consumers = deployment_model.link_consumers
      return if links_consumers.empty?

      errors = []

      links_consumers.each do |consumer|
        next if consumer.serial_id != @serial_id
        consumer.intents.each do |consumer_intent|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_deployment_links contains iterators nested 2 deep</span>          </div>  </li></ol>
          next if consumer_intent.serial_id != @serial_id
          begin
            resolve_consumer_intent_and_generate_link(consumer_intent, global_use_dns_entry, dry_run)
          rescue =&gt; e<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Uncommunicative-Variable-Name.md" target="_blank"><b>UncommunicativeVariableName</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_deployment_links has the variable name 'e'</span>          </div>  </li></ol>
            errors.push e.message
          end
        end
      end

      unless errors.empty?
        message = &quot;Failed to resolve links from deployment &#39;#{deployment_model.name}&#39;. See errors below:\n  - &quot;
        message += errors.join(&quot;\n  - &quot;)
        raise message
      end
    end

    def get_links_from_deployment(deployment)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_from_deployment has approx 10 statements</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_from_deployment doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
      consumers = Bosh::Director::Models::Links::LinkConsumer.where(deployment: deployment).all

      links = {}
      consumers.each do |consumer|
        links[consumer.name] = {}<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_from_deployment calls 'consumer.name' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L200" class="js-smell-location">0</a>                  <a href="links_manager.html#L205" class="js-smell-location">1</a>                  </div>  </li></ol>
        consumer.intents.each do |consumer_intent|
          consumer_intent.links.each do |link|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_from_deployment contains iterators nested 3 deep</span>          </div>  </li></ol>
            next if link.link_content.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_from_deployment calls 'link.link_content' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L203" class="js-smell-location">0</a>                  <a href="links_manager.html#L204" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_from_deployment performs a nil-check</span>          </div>  </li></ol>
            content = JSON.parse(link.link_content)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_from_deployment calls 'link.link_content' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L203" class="js-smell-location">0</a>                  <a href="links_manager.html#L204" class="js-smell-location">1</a>                  </div>  </li></ol>
            links[consumer.name][consumer_intent.original_name] = content<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_from_deployment calls 'consumer.name' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L200" class="js-smell-location">0</a>                  <a href="links_manager.html#L205" class="js-smell-location">1</a>                  </div>  </li></ol>
          end
        end
      end

      links
    end

    def get_links_for_instance_group(deployment_model, instance_group_name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance_group has a flog score of 28</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance_group has approx 11 statements</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance_group doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
      links = {}
      consumers = Bosh::Director::Models::Links::LinkConsumer.where(deployment: deployment_model, instance_group: instance_group_name, serial_id: deployment_model.links_serial_id)

      consumers.each do |consumer|
        links[consumer.name] = {}<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance_group calls 'consumer.name' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L218" class="js-smell-location">0</a>                  <a href="links_manager.html#L224" class="js-smell-location">1</a>                  </div>  </li></ol>
        consumer.intents.each do |consumer_intent|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance_group contains iterators nested 2 deep</span>          </div>  </li></ol>
          next if consumer.serial_id != consumer_intent.serial_id
          link = Bosh::Director::Models::Links::Link.where(link_consumer_intent: consumer_intent).order(Sequel.desc(:created_at)).first
          next if link.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance_group performs a nil-check</span>          </div>  </li></ol>
          content = JSON.parse(link.link_content)
          links[consumer.name][link.name] = content<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance_group calls 'consumer.name' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L218" class="js-smell-location">0</a>                  <a href="links_manager.html#L224" class="js-smell-location">1</a>                  </div>  </li></ol>
        end
      end

      links
    end

    def get_links_for_instance(instance)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance has a flog score of 34</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance has approx 13 statements</span>          </div>  </li></ol>
      return get_links_for_instance_group(instance.deployment_model, instance.instance_group_name) if instance.is_deploy_action?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance refers to 'instance' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L232" class="js-smell-location">0</a>                  <a href="links_manager.html#L236" class="js-smell-location">1</a>                  <a href="links_manager.html#L237" class="js-smell-location">2</a>                  </div>  </li></ol>

      links = {}

      newest_instance_link = Bosh::Director::Models::Links::InstancesLink.where(instance_id: instance.model.id).order(Sequel.desc(:serial_id)).first<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance calls 'Bosh::Director::Models::Links::InstancesLink.where(instance_id: instance.model.id)' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L236" class="js-smell-location">0</a>                  <a href="links_manager.html#L237" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance calls 'instance.model' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L236" class="js-smell-location">0</a>                  <a href="links_manager.html#L237" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance calls 'instance.model.id' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L236" class="js-smell-location">0</a>                  <a href="links_manager.html#L237" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance refers to 'instance' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L232" class="js-smell-location">0</a>                  <a href="links_manager.html#L236" class="js-smell-location">1</a>                  <a href="links_manager.html#L237" class="js-smell-location">2</a>                  </div>  </li></ol>
      instance_links = Bosh::Director::Models::Links::InstancesLink.where(instance_id: instance.model.id)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance calls 'Bosh::Director::Models::Links::InstancesLink.where(instance_id: instance.model.id)' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L236" class="js-smell-location">0</a>                  <a href="links_manager.html#L237" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance calls 'instance.model' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L236" class="js-smell-location">0</a>                  <a href="links_manager.html#L237" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance calls 'instance.model.id' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L236" class="js-smell-location">0</a>                  <a href="links_manager.html#L237" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance refers to 'instance' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L232" class="js-smell-location">0</a>                  <a href="links_manager.html#L236" class="js-smell-location">1</a>                  <a href="links_manager.html#L237" class="js-smell-location">2</a>                  </div>  </li></ol>

      instance_links.each do |instance_link|
        next if instance_link.serial_id &lt; newest_instance_link.serial_id

        link = instance_link.link
        consumer_intent = link.link_consumer_intent
        consumer = consumer_intent.link_consumer
        content = JSON.parse(link.link_content)

        links[consumer.name] ||= {}<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance calls 'consumer.name' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L247" class="js-smell-location">0</a>                  <a href="links_manager.html#L248" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance calls 'links[consumer.name]' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L247" class="js-smell-location">0</a>                  <a href="links_manager.html#L248" class="js-smell-location">1</a>                  </div>  </li></ol>
        links[consumer.name][consumer_intent.original_name] = content<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance calls 'consumer.name' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L247" class="js-smell-location">0</a>                  <a href="links_manager.html#L248" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_links_for_instance calls 'links[consumer.name]' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L247" class="js-smell-location">0</a>                  <a href="links_manager.html#L248" class="js-smell-location">1</a>                  </div>  </li></ol>
      end

      links
    end

    def bind_links_to_instance(instance)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance has a flog score of 59</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance has approx 13 statements</span>          </div>  </li></ol>
      consumers = Bosh::Director::Models::Links::LinkConsumer.where(deployment: instance.deployment_model, instance_group: instance.instance_group_name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance calls 'instance.deployment_model' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L255" class="js-smell-location">0</a>                  <a href="links_manager.html#L259" class="js-smell-location">1</a>                  <a href="links_manager.html#L261" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance refers to 'instance' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L255" class="js-smell-location">0</a>                  <a href="links_manager.html#L257" class="js-smell-location">1</a>                  <a href="links_manager.html#L259" class="js-smell-location">2</a>                  <a href="links_manager.html#L261" class="js-smell-location">3</a>                  <a href="links_manager.html#L265" class="js-smell-location">4</a>                  <a href="links_manager.html#L268" class="js-smell-location">5</a>                  </div>  </li></ol>

      instance_model = instance.model<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance calls 'instance.model' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L257" class="js-smell-location">0</a>                  <a href="links_manager.html#L265" class="js-smell-location">1</a>                  <a href="links_manager.html#L268" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance refers to 'instance' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L255" class="js-smell-location">0</a>                  <a href="links_manager.html#L257" class="js-smell-location">1</a>                  <a href="links_manager.html#L259" class="js-smell-location">2</a>                  <a href="links_manager.html#L261" class="js-smell-location">3</a>                  <a href="links_manager.html#L265" class="js-smell-location">4</a>                  <a href="links_manager.html#L268" class="js-smell-location">5</a>                  </div>  </li></ol>
      consumers.each do |consumer|
        next if consumer.serial_id != instance.deployment_model.links_serial_id<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance calls 'instance.deployment_model' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L255" class="js-smell-location">0</a>                  <a href="links_manager.html#L259" class="js-smell-location">1</a>                  <a href="links_manager.html#L261" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance calls 'instance.deployment_model.links_serial_id' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L259" class="js-smell-location">0</a>                  <a href="links_manager.html#L261" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance refers to 'instance' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L255" class="js-smell-location">0</a>                  <a href="links_manager.html#L257" class="js-smell-location">1</a>                  <a href="links_manager.html#L259" class="js-smell-location">2</a>                  <a href="links_manager.html#L261" class="js-smell-location">3</a>                  <a href="links_manager.html#L265" class="js-smell-location">4</a>                  <a href="links_manager.html#L268" class="js-smell-location">5</a>                  </div>  </li></ol>
        consumer.intents.each do |consumer_intent|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance contains iterators nested 2 deep</span>          </div>  </li></ol>
          next if consumer_intent.serial_id != instance.deployment_model.links_serial_id<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance calls 'instance.deployment_model' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L255" class="js-smell-location">0</a>                  <a href="links_manager.html#L259" class="js-smell-location">1</a>                  <a href="links_manager.html#L261" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance calls 'instance.deployment_model.links_serial_id' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L259" class="js-smell-location">0</a>                  <a href="links_manager.html#L261" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance refers to 'instance' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L255" class="js-smell-location">0</a>                  <a href="links_manager.html#L257" class="js-smell-location">1</a>                  <a href="links_manager.html#L259" class="js-smell-location">2</a>                  <a href="links_manager.html#L261" class="js-smell-location">3</a>                  <a href="links_manager.html#L265" class="js-smell-location">4</a>                  <a href="links_manager.html#L268" class="js-smell-location">5</a>                  </div>  </li></ol>
          next if consumer_intent.links.empty?

          newest_link = Bosh::Director::Models::Links::Link.where(link_consumer_intent_id: consumer_intent.id).order(Sequel.desc(:id)).first<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Identical code found in 2 nodes</span>              <span>Locations:</span>                  <a href="links_manager.html#L264" class="js-smell-location">0</a>                  <a href="links_manager.html#L317" class="js-smell-location">1</a>                  </div>  </li></ol>
          instance_link = Bosh::Director::Models::Links::InstancesLink.where(instance_id: instance.model.id, link_id: newest_link.id).first<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Identical code found in 2 nodes</span>              <span>Locations:</span>                  <a href="links_manager.html#L265" class="js-smell-location">0</a>                  <a href="links_manager.html#L268" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance calls 'Bosh::Director::Models::Links::InstancesLink.where(instance_id: instance.model.id, link_id: newest_link.id)' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L265" class="js-smell-location">0</a>                  <a href="links_manager.html#L268" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance calls 'Bosh::Director::Models::Links::InstancesLink.where(instance_id: instance.model.id, link_id: newest_link.id).first' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L265" class="js-smell-location">0</a>                  <a href="links_manager.html#L268" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance calls 'instance.model' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L257" class="js-smell-location">0</a>                  <a href="links_manager.html#L265" class="js-smell-location">1</a>                  <a href="links_manager.html#L268" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance calls 'instance.model.id' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L265" class="js-smell-location">0</a>                  <a href="links_manager.html#L268" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance calls 'newest_link.id' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L265" class="js-smell-location">0</a>                  <a href="links_manager.html#L268" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance refers to 'instance' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L255" class="js-smell-location">0</a>                  <a href="links_manager.html#L257" class="js-smell-location">1</a>                  <a href="links_manager.html#L259" class="js-smell-location">2</a>                  <a href="links_manager.html#L261" class="js-smell-location">3</a>                  <a href="links_manager.html#L265" class="js-smell-location">4</a>                  <a href="links_manager.html#L268" class="js-smell-location">5</a>                  </div>  </li></ol>
          if instance_link.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance performs a nil-check</span>          </div>  </li></ol>
            instance_model.add_link(newest_link)
            instance_link = Bosh::Director::Models::Links::InstancesLink.where(instance_id: instance.model.id, link_id: newest_link.id).first<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Identical code found in 2 nodes</span>              <span>Locations:</span>                  <a href="links_manager.html#L265" class="js-smell-location">0</a>                  <a href="links_manager.html#L268" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance calls 'Bosh::Director::Models::Links::InstancesLink.where(instance_id: instance.model.id, link_id: newest_link.id)' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L265" class="js-smell-location">0</a>                  <a href="links_manager.html#L268" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance calls 'Bosh::Director::Models::Links::InstancesLink.where(instance_id: instance.model.id, link_id: newest_link.id).first' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L265" class="js-smell-location">0</a>                  <a href="links_manager.html#L268" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance calls 'instance.model' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L257" class="js-smell-location">0</a>                  <a href="links_manager.html#L265" class="js-smell-location">1</a>                  <a href="links_manager.html#L268" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance calls 'instance.model.id' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L265" class="js-smell-location">0</a>                  <a href="links_manager.html#L268" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance calls 'newest_link.id' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L265" class="js-smell-location">0</a>                  <a href="links_manager.html#L268" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#bind_links_to_instance refers to 'instance' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L255" class="js-smell-location">0</a>                  <a href="links_manager.html#L257" class="js-smell-location">1</a>                  <a href="links_manager.html#L259" class="js-smell-location">2</a>                  <a href="links_manager.html#L261" class="js-smell-location">3</a>                  <a href="links_manager.html#L265" class="js-smell-location">4</a>                  <a href="links_manager.html#L268" class="js-smell-location">5</a>                  </div>  </li></ol>
          end
          if instance_link.serial_id != @serial_id
            instance_link.serial_id = @serial_id
            instance_link.save
          end
        end
      end
    end

    def update_provider_intents_contents(link_providers, deployment_plan)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_provider_intents_contents has a flog score of 47</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_provider_intents_contents has approx 11 statements</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_provider_intents_contents doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
      link_providers.select { |provider| provider.type == &#39;job&#39; &amp;&amp; provider.serial_id == deployment_plan.model.links_serial_id }.each do |provider|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_provider_intents_contents calls 'deployment_plan.model' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L279" class="js-smell-location">0</a>                  <a href="links_manager.html#L282" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_provider_intents_contents calls 'deployment_plan.model.links_serial_id' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L279" class="js-smell-location">0</a>                  <a href="links_manager.html#L282" class="js-smell-location">1</a>                  </div>  </li></ol>
        instance_group = deployment_plan.instance_group(provider.instance_group)
        provider.intents.each do |provider_intent|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_provider_intents_contents contains iterators nested 2 deep</span>          </div>  </li></ol>
          next if provider_intent.serial_id != deployment_plan.model.links_serial_id<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_provider_intents_contents calls 'deployment_plan.model' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L279" class="js-smell-location">0</a>                  <a href="links_manager.html#L282" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_provider_intents_contents calls 'deployment_plan.model.links_serial_id' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L279" class="js-smell-location">0</a>                  <a href="links_manager.html#L282" class="js-smell-location">1</a>                  </div>  </li></ol>
          metadata = {}
          metadata = JSON.parse(provider_intent.metadata) unless provider_intent.metadata.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_provider_intents_contents calls 'provider_intent.metadata' 2 times</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_provider_intents_contents performs a nil-check</span>          </div>  </li></ol>

          properties = metadata[&#39;mapped_properties&#39;]

          content = Bosh::Director::DeploymentPlan::Link.new(provider.deployment.name, instance_group, properties, deployment_plan.use_dns_addresses?, deployment_plan.use_short_dns_addresses?).spec.to_json
          provider_intent.content = content
          provider_intent.save
        end
      end
    end

    def remove_unused_links(deployment_model)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#remove_unused_links has a flog score of 71</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#remove_unused_links has approx 15 statements</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#remove_unused_links doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
      serial_id = deployment_model.links_serial_id

      deployment_model.link_providers.each do |provider|
        provider.intents.each do |provider_intent|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#remove_unused_links contains iterators nested 2 deep</span>          </div>  </li></ol>
          provider_intent.delete unless provider_intent.serial_id == serial_id
        end
        provider.delete unless provider.serial_id == serial_id
      end

      deployment_model.link_consumers.each do |consumer|
        next if consumer.type == &#39;external&#39;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#remove_unused_links calls 'consumer.type' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L306" class="js-smell-location">0</a>                  <a href="links_manager.html#L310" class="js-smell-location">1</a>                  <a href="links_manager.html#L316" class="js-smell-location">2</a>                  </div>  </li></ol>
        consumer.intents.each do |consumer_intent|
          if consumer_intent.serial_id == serial_id<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#remove_unused_links calls 'consumer_intent.serial_id' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L308" class="js-smell-location">0</a>                  <a href="links_manager.html#L313" class="js-smell-location">1</a>                  </div>  </li></ol>
            Bosh::Director::Models::Links::Link.where(link_consumer_intent: consumer_intent).each do |link|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#remove_unused_links contains iterators nested 3 deep</span>          </div>  </li></ol>
              if consumer.type == &#39;job&#39;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#remove_unused_links calls 'consumer.type' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L306" class="js-smell-location">0</a>                  <a href="links_manager.html#L310" class="js-smell-location">1</a>                  <a href="links_manager.html#L316" class="js-smell-location">2</a>                  </div>  </li></ol>
                instances_links = Bosh::Director::Models::Links::InstancesLink.where(
                  link_id: link.id,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#remove_unused_links calls 'link.id' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L312" class="js-smell-location">0</a>                  <a href="links_manager.html#L320" class="js-smell-location">1</a>                  </div>  </li></ol>
                  serial_id: consumer_intent.serial_id,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#remove_unused_links calls 'consumer_intent.serial_id' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L308" class="js-smell-location">0</a>                  <a href="links_manager.html#L313" class="js-smell-location">1</a>                  </div>  </li></ol>
                )
                link.delete if instances_links.count.zero?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#remove_unused_links calls 'link.delete' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L315" class="js-smell-location">0</a>                  <a href="links_manager.html#L320" class="js-smell-location">1</a>                  </div>  </li></ol>
              elsif consumer.type == &#39;variable&#39;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#remove_unused_links calls 'consumer.type' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L306" class="js-smell-location">0</a>                  <a href="links_manager.html#L310" class="js-smell-location">1</a>                  <a href="links_manager.html#L316" class="js-smell-location">2</a>                  </div>  </li></ol>
                newest_link = Bosh::Director::Models::Links::Link.where(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Identical code found in 2 nodes</span>              <span>Locations:</span>                  <a href="links_manager.html#L264" class="js-smell-location">0</a>                  <a href="links_manager.html#L317" class="js-smell-location">1</a>                  </div>  </li></ol>
                  link_consumer_intent_id: consumer_intent.id,
                ).order(Sequel.desc(:id)).first
                link.delete if link.id != newest_link.id<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#remove_unused_links calls 'link.delete' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L315" class="js-smell-location">0</a>                  <a href="links_manager.html#L320" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#remove_unused_links calls 'link.id' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L312" class="js-smell-location">0</a>                  <a href="links_manager.html#L320" class="js-smell-location">1</a>                  </div>  </li></ol>
              end
            end
          else
            consumer_intent.destroy
          end
        end
        consumer.destroy unless consumer.serial_id == serial_id
      end
    end

    def resolve_consumer_intent_and_generate_link(consumer_intent, global_use_dns_entry, dry_run, external_provider_intent = nil)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link has a flog score of 64</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link has 4 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link has approx 20 statements</span>          </div>  </li></ol>
      consumer_intent_metadata = {}
      consumer_intent_metadata = JSON.parse(consumer_intent.metadata) unless consumer_intent.metadata.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link calls 'consumer_intent.metadata' 2 times</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link refers to 'consumer_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L333" class="js-smell-location">0</a>                  <a href="links_manager.html#L342" class="js-smell-location">1</a>                  <a href="links_manager.html#L355" class="js-smell-location">2</a>                  <a href="links_manager.html#L361" class="js-smell-location">3</a>                  <a href="links_manager.html#L362" class="js-smell-location">4</a>                  <a href="links_manager.html#L376" class="js-smell-location">5</a>                  <a href="links_manager.html#L383" class="js-smell-location">6</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link performs a nil-check</span>              <span>Locations:</span>                  <a href="links_manager.html#L333" class="js-smell-location">0</a>                  <a href="links_manager.html#L349" class="js-smell-location">1</a>                  </div>  </li></ol>
      is_manual_link = !!consumer_intent_metadata[&#39;manual_link&#39;]

      if is_manual_link
        provider_intent = get_manual_link_provider_for_consumer(consumer_intent)
        link_content = provider_intent.content || &#39;{}&#39;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link calls 'provider_intent.content' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L338" class="js-smell-location">0</a>                  <a href="links_manager.html#L372" class="js-smell-location">1</a>                  </div>  </li></ol>

        unless dry_run<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Control-Parameter.md" target="_blank"><b>ControlParameter</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link is controlled by argument 'dry_run'</span>              <span>Locations:</span>                  <a href="links_manager.html#L340" class="js-smell-location">0</a>                  <a href="links_manager.html#L367" class="js-smell-location">1</a>                  </div>  </li></ol>
          find_or_create_link(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link calls 'find_or_create_link( ... )' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L341" class="js-smell-location">0</a>                  <a href="links_manager.html#L382" class="js-smell-location">1</a>                  </div>  </li></ol>
            name: consumer_intent.original_name,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link calls 'consumer_intent.original_name' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L342" class="js-smell-location">0</a>                  <a href="links_manager.html#L383" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link refers to 'consumer_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L333" class="js-smell-location">0</a>                  <a href="links_manager.html#L342" class="js-smell-location">1</a>                  <a href="links_manager.html#L355" class="js-smell-location">2</a>                  <a href="links_manager.html#L361" class="js-smell-location">3</a>                  <a href="links_manager.html#L362" class="js-smell-location">4</a>                  <a href="links_manager.html#L376" class="js-smell-location">5</a>                  <a href="links_manager.html#L383" class="js-smell-location">6</a>                  </div>  </li></ol>
            provider_intent: provider_intent,
            consumer_intent: consumer_intent,
            link_content: link_content,
          )
        end
      else
        if external_provider_intent.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link performs a nil-check</span>              <span>Locations:</span>                  <a href="links_manager.html#L333" class="js-smell-location">0</a>                  <a href="links_manager.html#L349" class="js-smell-location">1</a>                  </div>  </li></ol>
          found_provider_intents = provider_intents_for_consumer_intent(consumer_intent, consumer_intent_metadata)
        else
          found_provider_intents = [external_provider_intent]
        end

        consumer = consumer_intent.link_consumer<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link refers to 'consumer_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L333" class="js-smell-location">0</a>                  <a href="links_manager.html#L342" class="js-smell-location">1</a>                  <a href="links_manager.html#L355" class="js-smell-location">2</a>                  <a href="links_manager.html#L361" class="js-smell-location">3</a>                  <a href="links_manager.html#L362" class="js-smell-location">4</a>                  <a href="links_manager.html#L376" class="js-smell-location">5</a>                  <a href="links_manager.html#L383" class="js-smell-location">6</a>                  </div>  </li></ol>
        current_deployment_name = consumer.deployment.name

        link_network = consumer_intent_metadata[&#39;network&#39;]
        is_explicit_link = !!consumer_intent_metadata[&#39;explicit_link&#39;]

        if found_provider_intents.empty? &amp;&amp; consumer_intent.optional<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link refers to 'consumer_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L333" class="js-smell-location">0</a>                  <a href="links_manager.html#L342" class="js-smell-location">1</a>                  <a href="links_manager.html#L355" class="js-smell-location">2</a>                  <a href="links_manager.html#L361" class="js-smell-location">3</a>                  <a href="links_manager.html#L362" class="js-smell-location">4</a>                  <a href="links_manager.html#L376" class="js-smell-location">5</a>                  <a href="links_manager.html#L383" class="js-smell-location">6</a>                  </div>  </li></ol>
          return unless is_explicit_link &amp;&amp; !consumer_intent.blocked<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link refers to 'consumer_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L333" class="js-smell-location">0</a>                  <a href="links_manager.html#L342" class="js-smell-location">1</a>                  <a href="links_manager.html#L355" class="js-smell-location">2</a>                  <a href="links_manager.html#L361" class="js-smell-location">3</a>                  <a href="links_manager.html#L362" class="js-smell-location">4</a>                  <a href="links_manager.html#L376" class="js-smell-location">5</a>                  <a href="links_manager.html#L383" class="js-smell-location">6</a>                  </div>  </li></ol>
        end

        validate_found_providers(found_provider_intents, consumer_intent, link_network)

        unless dry_run<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Control-Parameter.md" target="_blank"><b>ControlParameter</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link is controlled by argument 'dry_run'</span>              <span>Locations:</span>                  <a href="links_manager.html#L340" class="js-smell-location">0</a>                  <a href="links_manager.html#L367" class="js-smell-location">1</a>                  </div>  </li></ol>
          provider_intent = found_provider_intents.first

          # TODO: Links: discuss about possibility of value of content being empty; will cause nil class error
          if is_explicit_link
            content = provider_intent.content || &#39;{}&#39;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link calls 'provider_intent.content' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L338" class="js-smell-location">0</a>                  <a href="links_manager.html#L372" class="js-smell-location">1</a>                  </div>  </li></ol>
            provider_intent_networks = JSON.parse(content)[&#39;networks&#39;]

            if link_network &amp;&amp; !provider_intent_networks.include?(link_network)
              raise Bosh::Director::DeploymentInvalidLink, &quot;Can&#39;t resolve link &#39;#{consumer_intent.name}&#39;#{&quot; in instance group &#39;#{consumer.instance_group}&#39;&quot; unless consumer.instance_group.empty?} on job &#39;#{consumer.name}&#39; in deployment &#39;#{current_deployment_name}&#39; with network &#39;#{link_network}&#39;&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link calls 'consumer.instance_group' 2 times</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link refers to 'consumer_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L333" class="js-smell-location">0</a>                  <a href="links_manager.html#L342" class="js-smell-location">1</a>                  <a href="links_manager.html#L355" class="js-smell-location">2</a>                  <a href="links_manager.html#L361" class="js-smell-location">3</a>                  <a href="links_manager.html#L362" class="js-smell-location">4</a>                  <a href="links_manager.html#L376" class="js-smell-location">5</a>                  <a href="links_manager.html#L383" class="js-smell-location">6</a>                  </div>  </li></ol>
            end
          end

          link_content = extract_provider_link_content(consumer_intent_metadata, global_use_dns_entry, link_network, provider_intent)

          find_or_create_link(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link calls 'find_or_create_link( ... )' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L341" class="js-smell-location">0</a>                  <a href="links_manager.html#L382" class="js-smell-location">1</a>                  </div>  </li></ol>
            name: consumer_intent.original_name,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link calls 'consumer_intent.original_name' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L342" class="js-smell-location">0</a>                  <a href="links_manager.html#L383" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#resolve_consumer_intent_and_generate_link refers to 'consumer_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L333" class="js-smell-location">0</a>                  <a href="links_manager.html#L342" class="js-smell-location">1</a>                  <a href="links_manager.html#L355" class="js-smell-location">2</a>                  <a href="links_manager.html#L361" class="js-smell-location">3</a>                  <a href="links_manager.html#L362" class="js-smell-location">4</a>                  <a href="links_manager.html#L376" class="js-smell-location">5</a>                  <a href="links_manager.html#L383" class="js-smell-location">6</a>                  </div>  </li></ol>
            provider_intent: provider_intent,
            consumer_intent: consumer_intent,
            link_content: link_content,
          )
        end
      end
    end

    def migrate_links_provider_instance_group(deployment_model, instance_group_model)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="links_manager.html#L392" class="js-smell-location">0</a>                  <a href="links_manager.html#L406" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#migrate_links_provider_instance_group has approx 7 statements</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#migrate_links_provider_instance_group doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
      instance_group_list = instance_group_model.migrated_from.map { |h| h[&#39;name&#39;] }<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Uncommunicative-Variable-Name.md" target="_blank"><b>UncommunicativeVariableName</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#migrate_links_provider_instance_group has the variable name 'h'</span>          </div>  </li></ol>

      instance_group_list.each do |instance_group_name|
        deployment_model.link_providers.each do |link_provider|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#migrate_links_provider_instance_group contains iterators nested 2 deep</span>          </div>  </li></ol>
          next if link_provider.instance_group != instance_group_name
          if link_provider.serial_id == deployment_model.links_serial_id
            link_provider.instance_group = instance_group_model.name
            link_provider.save
          end
        end
      end
    end

    def migrate_links_consumer_instance_group(deployment_model, instance_group_model)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="links_manager.html#L392" class="js-smell-location">0</a>                  <a href="links_manager.html#L406" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#migrate_links_consumer_instance_group has approx 7 statements</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#migrate_links_consumer_instance_group doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
      instance_group_list = instance_group_model.migrated_from.map { |h| h[&#39;name&#39;] }<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Uncommunicative-Variable-Name.md" target="_blank"><b>UncommunicativeVariableName</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#migrate_links_consumer_instance_group has the variable name 'h'</span>          </div>  </li></ol>

      instance_group_list.each do |instance_group_name|
        deployment_model.link_consumers.each do |link_consumer|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#migrate_links_consumer_instance_group contains iterators nested 2 deep</span>          </div>  </li></ol>
          next if link_consumer.instance_group != instance_group_name
          if link_consumer.serial_id == deployment_model.links_serial_id
            link_consumer.instance_group = instance_group_model.name
            link_consumer.save
          end
        end
      end
    end

    private

    def extract_provider_link_content(consumer_intent_metadata, global_use_dns_entry, link_network, provider_intent)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#extract_provider_link_content has 4 parameters</span>          </div>  </li></ol>
      link_use_ip_address = consumer_intent_metadata[&#39;ip_addresses&#39;]
      provider_content = provider_intent.content || &#39;{}&#39;
      # determine what network name / dns entry things to use
      link_spec = update_addresses(JSON.parse(provider_content), link_network, global_use_dns_entry, link_use_ip_address)
      link_spec.to_json
    end

    def provider_intents_for_consumer_intent(consumer_intent, consumer_intent_metadata)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#provider_intents_for_consumer_intent has a flog score of 52</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#provider_intents_for_consumer_intent has approx 18 statements</span>          </div>  </li></ol>
      consumer = consumer_intent.link_consumer
      found_provider_intents = []

      unless consumer_intent.blocked
        deployment_name = consumer_intent_metadata[&#39;from_deployment&#39;] || consumer.deployment.name<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#provider_intents_for_consumer_intent calls 'consumer.deployment' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L435" class="js-smell-location">0</a>                  <a href="links_manager.html#L436" class="js-smell-location">1</a>                  <a href="links_manager.html#L442" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#provider_intents_for_consumer_intent calls 'consumer.deployment.name' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L435" class="js-smell-location">0</a>                  <a href="links_manager.html#L436" class="js-smell-location">1</a>                  </div>  </li></ol>
        is_cross_deployment = (consumer.deployment.name != deployment_name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#provider_intents_for_consumer_intent calls 'consumer.deployment' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L435" class="js-smell-location">0</a>                  <a href="links_manager.html#L436" class="js-smell-location">1</a>                  <a href="links_manager.html#L442" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#provider_intents_for_consumer_intent calls 'consumer.deployment.name' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L435" class="js-smell-location">0</a>                  <a href="links_manager.html#L436" class="js-smell-location">1</a>                  </div>  </li></ol>

        if is_cross_deployment
          deployment = Bosh::Director::Models::Deployment.find(name: deployment_name)
          raise Bosh::Director::DeploymentNotFound, &quot;Can&#39;t find deployment &#39;#{deployment_name}&#39;&quot; if deployment.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#provider_intents_for_consumer_intent performs a nil-check</span>          </div>  </li></ol>
        else
          deployment = consumer.deployment<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#provider_intents_for_consumer_intent calls 'consumer.deployment' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L435" class="js-smell-location">0</a>                  <a href="links_manager.html#L436" class="js-smell-location">1</a>                  <a href="links_manager.html#L442" class="js-smell-location">2</a>                  </div>  </li></ol>
        end

        providers = deployment.link_providers

        is_explicit_link = !!consumer_intent_metadata[&#39;explicit_link&#39;]

        providers.each do |provider|
          provider.intents.each do |provider_intent|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#provider_intents_for_consumer_intent contains iterators nested 2 deep</span>          </div>  </li></ol>
            next if provider_intent.type != consumer_intent.type<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#provider_intents_for_consumer_intent refers to 'provider_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L451" class="js-smell-location">0</a>                  <a href="links_manager.html#L454" class="js-smell-location">1</a>                  <a href="links_manager.html#L455" class="js-smell-location">2</a>                  <a href="links_manager.html#L458" class="js-smell-location">3</a>                  <a href="links_manager.html#L459" class="js-smell-location">4</a>                  </div>  </li></ol>

            if is_explicit_link
              next if provider_intent.name != consumer_intent.name<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#provider_intents_for_consumer_intent refers to 'provider_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L451" class="js-smell-location">0</a>                  <a href="links_manager.html#L454" class="js-smell-location">1</a>                  <a href="links_manager.html#L455" class="js-smell-location">2</a>                  <a href="links_manager.html#L458" class="js-smell-location">3</a>                  <a href="links_manager.html#L459" class="js-smell-location">4</a>                  </div>  </li></ol>
              next if is_cross_deployment &amp;&amp; !provider_intent.shared<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#provider_intents_for_consumer_intent refers to 'provider_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L451" class="js-smell-location">0</a>                  <a href="links_manager.html#L454" class="js-smell-location">1</a>                  <a href="links_manager.html#L455" class="js-smell-location">2</a>                  <a href="links_manager.html#L458" class="js-smell-location">3</a>                  <a href="links_manager.html#L459" class="js-smell-location">4</a>                  </div>  </li></ol>
            end

            next if provider_intent.serial_id != deployment.links_serial_id<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#provider_intents_for_consumer_intent refers to 'provider_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L451" class="js-smell-location">0</a>                  <a href="links_manager.html#L454" class="js-smell-location">1</a>                  <a href="links_manager.html#L455" class="js-smell-location">2</a>                  <a href="links_manager.html#L458" class="js-smell-location">3</a>                  <a href="links_manager.html#L459" class="js-smell-location">4</a>                  </div>  </li></ol>
            next unless provider_intent.consumable<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#provider_intents_for_consumer_intent refers to 'provider_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L451" class="js-smell-location">0</a>                  <a href="links_manager.html#L454" class="js-smell-location">1</a>                  <a href="links_manager.html#L455" class="js-smell-location">2</a>                  <a href="links_manager.html#L458" class="js-smell-location">3</a>                  <a href="links_manager.html#L459" class="js-smell-location">4</a>                  </div>  </li></ol>
            found_provider_intents &lt;&lt; provider_intent
          end
        end
      end
      found_provider_intents
    end

    def get_manual_link_provider_for_consumer(consumer_intent)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_manual_link_provider_for_consumer has approx 9 statements</span>          </div>  </li></ol>
      consumer_name = consumer_intent.link_consumer.name<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_manual_link_provider_for_consumer calls 'consumer_intent.link_consumer' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L468" class="js-smell-location">0</a>                  <a href="links_manager.html#L469" class="js-smell-location">1</a>                  <a href="links_manager.html#L473" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_manual_link_provider_for_consumer refers to 'consumer_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L468" class="js-smell-location">0</a>                  <a href="links_manager.html#L469" class="js-smell-location">1</a>                  <a href="links_manager.html#L470" class="js-smell-location">2</a>                  <a href="links_manager.html#L473" class="js-smell-location">3</a>                  </div>  </li></ol>
      consumer_instance_group = consumer_intent.link_consumer.instance_group<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_manual_link_provider_for_consumer calls 'consumer_intent.link_consumer' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L468" class="js-smell-location">0</a>                  <a href="links_manager.html#L469" class="js-smell-location">1</a>                  <a href="links_manager.html#L473" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_manual_link_provider_for_consumer refers to 'consumer_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L468" class="js-smell-location">0</a>                  <a href="links_manager.html#L469" class="js-smell-location">1</a>                  <a href="links_manager.html#L470" class="js-smell-location">2</a>                  <a href="links_manager.html#L473" class="js-smell-location">3</a>                  </div>  </li></ol>
      consumer_intent_name = consumer_intent.original_name<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_manual_link_provider_for_consumer refers to 'consumer_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L468" class="js-smell-location">0</a>                  <a href="links_manager.html#L469" class="js-smell-location">1</a>                  <a href="links_manager.html#L470" class="js-smell-location">2</a>                  <a href="links_manager.html#L473" class="js-smell-location">3</a>                  </div>  </li></ol>

      manual_provider = find_provider(
        deployment_model: consumer_intent.link_consumer.deployment,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_manual_link_provider_for_consumer calls 'consumer_intent.link_consumer' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L468" class="js-smell-location">0</a>                  <a href="links_manager.html#L469" class="js-smell-location">1</a>                  <a href="links_manager.html#L473" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_manual_link_provider_for_consumer refers to 'consumer_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L468" class="js-smell-location">0</a>                  <a href="links_manager.html#L469" class="js-smell-location">1</a>                  <a href="links_manager.html#L470" class="js-smell-location">2</a>                  <a href="links_manager.html#L473" class="js-smell-location">3</a>                  </div>  </li></ol>
        instance_group_name: consumer_instance_group,
        name: consumer_name,
        type: &#39;manual&#39;,
      )

      error_msg = &quot;Failed to find manual link provider for consumer &#39;#{consumer_intent_name}&#39; in job &#39;#{consumer_name}&#39; in instance group &#39;#{consumer_intent_name}&#39;&quot;
      raise error_msg if manual_provider.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_manual_link_provider_for_consumer calls 'raise error_msg' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L480" class="js-smell-location">0</a>                  <a href="links_manager.html#L483" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_manual_link_provider_for_consumer performs a nil-check</span>              <span>Locations:</span>                  <a href="links_manager.html#L480" class="js-smell-location">0</a>                  <a href="links_manager.html#L483" class="js-smell-location">1</a>                  </div>  </li></ol>

      manual_provider_intent = manual_provider.find_intent_by_name(consumer_intent_name)
      raise error_msg if manual_provider_intent.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_manual_link_provider_for_consumer calls 'raise error_msg' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L480" class="js-smell-location">0</a>                  <a href="links_manager.html#L483" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#get_manual_link_provider_for_consumer performs a nil-check</span>              <span>Locations:</span>                  <a href="links_manager.html#L480" class="js-smell-location">0</a>                  <a href="links_manager.html#L483" class="js-smell-location">1</a>                  </div>  </li></ol>

      manual_provider_intent
    end

    def update_addresses(provider_intent_content, preferred_network_name, global_use_dns_entry, link_use_ip_address)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses has a flog score of 54</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses has 4 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses has approx 23 statements</span>          </div>  </li></ol>
      provider_intent_content_copy = Bosh::Common::DeepCopy.copy(provider_intent_content)
      provider_dns_enabled = provider_intent_content_copy[&#39;use_dns_addresses&#39;]
      if !provider_intent_content_copy.key?(&#39;default_network&#39;)
        unless link_use_ip_address.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses calls 'link_use_ip_address.nil?' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L492" class="js-smell-location">0</a>                  <a href="links_manager.html#L509" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses performs a nil-check</span>              <span>Locations:</span>                  <a href="links_manager.html#L492" class="js-smell-location">0</a>                  <a href="links_manager.html#L509" class="js-smell-location">1</a>                  <a href="links_manager.html#L523" class="js-smell-location">2</a>                  </div>  </li></ol>
          raise Bosh::Director::LinkLookupError, &#39;Unable to retrieve default network from provider. Please redeploy provider deployment&#39;
        end

        if preferred_network_name
          provider_intent_content_copy[&#39;instances&#39;].each do |instance|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses calls 'provider_intent_content_copy['instances']' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L497" class="js-smell-location">0</a>                  <a href="links_manager.html#L508" class="js-smell-location">1</a>                  <a href="links_manager.html#L523" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses calls 'provider_intent_content_copy['instances'].each' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L497" class="js-smell-location">0</a>                  <a href="links_manager.html#L508" class="js-smell-location">1</a>                  </div>  </li></ol>
            desired_addresses = instance[&#39;addresses&#39;]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses calls 'instance['addresses']' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L498" class="js-smell-location">0</a>                  <a href="links_manager.html#L510" class="js-smell-location">1</a>                  <a href="links_manager.html#L512" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses refers to 'instance' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L498" class="js-smell-location">0</a>                  <a href="links_manager.html#L500" class="js-smell-location">1</a>                  <a href="links_manager.html#L501" class="js-smell-location">2</a>                  <a href="links_manager.html#L510" class="js-smell-location">3</a>                  <a href="links_manager.html#L512" class="js-smell-location">4</a>                  <a href="links_manager.html#L518" class="js-smell-location">5</a>                  <a href="links_manager.html#L519" class="js-smell-location">6</a>                  <a href="links_manager.html#L524" class="js-smell-location">7</a>                  <a href="links_manager.html#L525" class="js-smell-location">8</a>                  </div>  </li></ol>
            raise Bosh::Director::LinkLookupError, &quot;Provider link does not have network: &#39;#{preferred_network_name}&#39;&quot; unless desired_addresses.key?(preferred_network_name)
            instance[&#39;address&#39;] = desired_addresses[preferred_network_name]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses refers to 'instance' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L498" class="js-smell-location">0</a>                  <a href="links_manager.html#L500" class="js-smell-location">1</a>                  <a href="links_manager.html#L501" class="js-smell-location">2</a>                  <a href="links_manager.html#L510" class="js-smell-location">3</a>                  <a href="links_manager.html#L512" class="js-smell-location">4</a>                  <a href="links_manager.html#L518" class="js-smell-location">5</a>                  <a href="links_manager.html#L519" class="js-smell-location">6</a>                  <a href="links_manager.html#L524" class="js-smell-location">7</a>                  <a href="links_manager.html#L525" class="js-smell-location">8</a>                  </div>  </li></ol>
            log_warning_if_applicable(instance[&#39;address&#39;], global_use_dns_entry, instance[&#39;name&#39;], instance[&#39;id&#39;])<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses calls 'instance['address']' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L501" class="js-smell-location">0</a>                  <a href="links_manager.html#L519" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses calls 'instance['id']' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L501" class="js-smell-location">0</a>                  <a href="links_manager.html#L519" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses calls 'instance['name']' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L501" class="js-smell-location">0</a>                  <a href="links_manager.html#L519" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses calls 'log_warning_if_applicable(instance['address'], global_use_dns_entry, instance['name'], instance['id'])' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L501" class="js-smell-location">0</a>                  <a href="links_manager.html#L519" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses refers to 'instance' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L498" class="js-smell-location">0</a>                  <a href="links_manager.html#L500" class="js-smell-location">1</a>                  <a href="links_manager.html#L501" class="js-smell-location">2</a>                  <a href="links_manager.html#L510" class="js-smell-location">3</a>                  <a href="links_manager.html#L512" class="js-smell-location">4</a>                  <a href="links_manager.html#L518" class="js-smell-location">5</a>                  <a href="links_manager.html#L519" class="js-smell-location">6</a>                  <a href="links_manager.html#L524" class="js-smell-location">7</a>                  <a href="links_manager.html#L525" class="js-smell-location">8</a>                  </div>  </li></ol>
          end
        end
      else
        network_name = preferred_network_name || provider_intent_content_copy[&#39;default_network&#39;]
        provider_intent_content_copy[&#39;default_network&#39;] = network_name

        provider_intent_content_copy[&#39;instances&#39;].each do |instance|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses calls 'provider_intent_content_copy['instances']' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L497" class="js-smell-location">0</a>                  <a href="links_manager.html#L508" class="js-smell-location">1</a>                  <a href="links_manager.html#L523" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses calls 'provider_intent_content_copy['instances'].each' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L497" class="js-smell-location">0</a>                  <a href="links_manager.html#L508" class="js-smell-location">1</a>                  </div>  </li></ol>
          if link_use_ip_address.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses calls 'link_use_ip_address.nil?' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L492" class="js-smell-location">0</a>                  <a href="links_manager.html#L509" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses performs a nil-check</span>              <span>Locations:</span>                  <a href="links_manager.html#L492" class="js-smell-location">0</a>                  <a href="links_manager.html#L509" class="js-smell-location">1</a>                  <a href="links_manager.html#L523" class="js-smell-location">2</a>                  </div>  </li></ol>
            desired_addresses = provider_dns_enabled ? instance[&#39;dns_addresses&#39;] : instance[&#39;addresses&#39;]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses calls 'instance['addresses']' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L498" class="js-smell-location">0</a>                  <a href="links_manager.html#L510" class="js-smell-location">1</a>                  <a href="links_manager.html#L512" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses calls 'instance['dns_addresses']' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L510" class="js-smell-location">0</a>                  <a href="links_manager.html#L512" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses refers to 'instance' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L498" class="js-smell-location">0</a>                  <a href="links_manager.html#L500" class="js-smell-location">1</a>                  <a href="links_manager.html#L501" class="js-smell-location">2</a>                  <a href="links_manager.html#L510" class="js-smell-location">3</a>                  <a href="links_manager.html#L512" class="js-smell-location">4</a>                  <a href="links_manager.html#L518" class="js-smell-location">5</a>                  <a href="links_manager.html#L519" class="js-smell-location">6</a>                  <a href="links_manager.html#L524" class="js-smell-location">7</a>                  <a href="links_manager.html#L525" class="js-smell-location">8</a>                  </div>  </li></ol>
          else
            desired_addresses = link_use_ip_address ? instance[&#39;addresses&#39;] : instance[&#39;dns_addresses&#39;]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses calls 'instance['addresses']' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L498" class="js-smell-location">0</a>                  <a href="links_manager.html#L510" class="js-smell-location">1</a>                  <a href="links_manager.html#L512" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses calls 'instance['dns_addresses']' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L510" class="js-smell-location">0</a>                  <a href="links_manager.html#L512" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses refers to 'instance' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L498" class="js-smell-location">0</a>                  <a href="links_manager.html#L500" class="js-smell-location">1</a>                  <a href="links_manager.html#L501" class="js-smell-location">2</a>                  <a href="links_manager.html#L510" class="js-smell-location">3</a>                  <a href="links_manager.html#L512" class="js-smell-location">4</a>                  <a href="links_manager.html#L518" class="js-smell-location">5</a>                  <a href="links_manager.html#L519" class="js-smell-location">6</a>                  <a href="links_manager.html#L524" class="js-smell-location">7</a>                  <a href="links_manager.html#L525" class="js-smell-location">8</a>                  </div>  </li></ol>
            global_use_dns_entry = !link_use_ip_address
          end

          raise Bosh::Director::LinkLookupError, &quot;Provider link does not have network: &#39;#{network_name}&#39;&quot; unless desired_addresses.key?(network_name)

          instance[&#39;address&#39;] = desired_addresses[network_name]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses refers to 'instance' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L498" class="js-smell-location">0</a>                  <a href="links_manager.html#L500" class="js-smell-location">1</a>                  <a href="links_manager.html#L501" class="js-smell-location">2</a>                  <a href="links_manager.html#L510" class="js-smell-location">3</a>                  <a href="links_manager.html#L512" class="js-smell-location">4</a>                  <a href="links_manager.html#L518" class="js-smell-location">5</a>                  <a href="links_manager.html#L519" class="js-smell-location">6</a>                  <a href="links_manager.html#L524" class="js-smell-location">7</a>                  <a href="links_manager.html#L525" class="js-smell-location">8</a>                  </div>  </li></ol>
          log_warning_if_applicable(instance[&#39;address&#39;], global_use_dns_entry, instance[&#39;name&#39;], instance[&#39;id&#39;])<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses calls 'instance['address']' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L501" class="js-smell-location">0</a>                  <a href="links_manager.html#L519" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses calls 'instance['id']' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L501" class="js-smell-location">0</a>                  <a href="links_manager.html#L519" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses calls 'instance['name']' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L501" class="js-smell-location">0</a>                  <a href="links_manager.html#L519" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses calls 'log_warning_if_applicable(instance['address'], global_use_dns_entry, instance['name'], instance['id'])' 2 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L501" class="js-smell-location">0</a>                  <a href="links_manager.html#L519" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses refers to 'instance' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L498" class="js-smell-location">0</a>                  <a href="links_manager.html#L500" class="js-smell-location">1</a>                  <a href="links_manager.html#L501" class="js-smell-location">2</a>                  <a href="links_manager.html#L510" class="js-smell-location">3</a>                  <a href="links_manager.html#L512" class="js-smell-location">4</a>                  <a href="links_manager.html#L518" class="js-smell-location">5</a>                  <a href="links_manager.html#L519" class="js-smell-location">6</a>                  <a href="links_manager.html#L524" class="js-smell-location">7</a>                  <a href="links_manager.html#L525" class="js-smell-location">8</a>                  </div>  </li></ol>
        end
      end

      provider_intent_content_copy[&#39;instances&#39;]&amp;.each do |instance|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses calls 'provider_intent_content_copy['instances']' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L497" class="js-smell-location">0</a>                  <a href="links_manager.html#L508" class="js-smell-location">1</a>                  <a href="links_manager.html#L523" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses performs a nil-check</span>              <span>Locations:</span>                  <a href="links_manager.html#L492" class="js-smell-location">0</a>                  <a href="links_manager.html#L509" class="js-smell-location">1</a>                  <a href="links_manager.html#L523" class="js-smell-location">2</a>                  </div>  </li></ol>
        instance.delete(&#39;addresses&#39;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses refers to 'instance' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L498" class="js-smell-location">0</a>                  <a href="links_manager.html#L500" class="js-smell-location">1</a>                  <a href="links_manager.html#L501" class="js-smell-location">2</a>                  <a href="links_manager.html#L510" class="js-smell-location">3</a>                  <a href="links_manager.html#L512" class="js-smell-location">4</a>                  <a href="links_manager.html#L518" class="js-smell-location">5</a>                  <a href="links_manager.html#L519" class="js-smell-location">6</a>                  <a href="links_manager.html#L524" class="js-smell-location">7</a>                  <a href="links_manager.html#L525" class="js-smell-location">8</a>                  </div>  </li></ol>
        instance.delete(&#39;dns_addresses&#39;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#update_addresses refers to 'instance' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L498" class="js-smell-location">0</a>                  <a href="links_manager.html#L500" class="js-smell-location">1</a>                  <a href="links_manager.html#L501" class="js-smell-location">2</a>                  <a href="links_manager.html#L510" class="js-smell-location">3</a>                  <a href="links_manager.html#L512" class="js-smell-location">4</a>                  <a href="links_manager.html#L518" class="js-smell-location">5</a>                  <a href="links_manager.html#L519" class="js-smell-location">6</a>                  <a href="links_manager.html#L524" class="js-smell-location">7</a>                  <a href="links_manager.html#L525" class="js-smell-location">8</a>                  </div>  </li></ol>
      end

      provider_intent_content_copy
    end

    def validate_found_providers(found_provider_intents, consumer_intent, link_network)
      raise Bosh::Director::DeploymentInvalidLink, Bosh::Director::Links::LinksErrorBuilder.build_link_error(consumer_intent, found_provider_intents, link_network) if found_provider_intents.size != 1
    end

    def log_warning_if_applicable(address, dns_required, instance_name, instance_id)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#log_warning_if_applicable has 4 parameters</span>          </div>  </li></ol>
      if dns_required &amp;&amp; ip_address?(address)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Control-Parameter.md" target="_blank"><b>ControlParameter</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#log_warning_if_applicable is controlled by argument 'dns_required'</span>          </div>  </li></ol>
        message = &quot;DNS address not available for the link provider instance: #{instance_name}/#{instance_id}&quot;
        @logger.warn(message)
        @event_logger.warn(message)
      end
    end

    def are_equal(content1, content2)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal has a flog score of 64</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal has approx 11 statements</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Uncommunicative-Parameter-Name.md" target="_blank"><b>UncommunicativeParameterName</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal has the parameter name 'content1'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Uncommunicative-Parameter-Name.md" target="_blank"><b>UncommunicativeParameterName</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal has the parameter name 'content2'</span>          </div>  </li></ol>
      if content1.is_a?(Hash)
        return false unless content1.keys.count.equal?(content2.keys.count)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal refers to 'content2' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L545" class="js-smell-location">0</a>                  <a href="links_manager.html#L547" class="js-smell-location">1</a>                  <a href="links_manager.html#L548" class="js-smell-location">2</a>                  <a href="links_manager.html#L549" class="js-smell-location">3</a>                  <a href="links_manager.html#L551" class="js-smell-location">4</a>                  <a href="links_manager.html#L557" class="js-smell-location">5</a>                  <a href="links_manager.html#L559" class="js-smell-location">6</a>                  <a href="links_manager.html#L560" class="js-smell-location">7</a>                  <a href="links_manager.html#L561" class="js-smell-location">8</a>                  <a href="links_manager.html#L563" class="js-smell-location">9</a>                  </div>  </li></ol>
        content1.each_key do |key|
          return false unless content2.has_key?(key) #only checking for key, not value<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal refers to 'content2' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L545" class="js-smell-location">0</a>                  <a href="links_manager.html#L547" class="js-smell-location">1</a>                  <a href="links_manager.html#L548" class="js-smell-location">2</a>                  <a href="links_manager.html#L549" class="js-smell-location">3</a>                  <a href="links_manager.html#L551" class="js-smell-location">4</a>                  <a href="links_manager.html#L557" class="js-smell-location">5</a>                  <a href="links_manager.html#L559" class="js-smell-location">6</a>                  <a href="links_manager.html#L560" class="js-smell-location">7</a>                  <a href="links_manager.html#L561" class="js-smell-location">8</a>                  <a href="links_manager.html#L563" class="js-smell-location">9</a>                  </div>  </li></ol>
          if content1[key].is_a?(Enumerable) &amp;&amp; content1[key].class == content2[key].class<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal calls 'content1[key]' 4 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L548" class="js-smell-location">0</a>                  <a href="links_manager.html#L549" class="js-smell-location">1</a>                  <a href="links_manager.html#L551" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal calls 'content2[key]' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L548" class="js-smell-location">0</a>                  <a href="links_manager.html#L549" class="js-smell-location">1</a>                  <a href="links_manager.html#L551" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal refers to 'content2' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L545" class="js-smell-location">0</a>                  <a href="links_manager.html#L547" class="js-smell-location">1</a>                  <a href="links_manager.html#L548" class="js-smell-location">2</a>                  <a href="links_manager.html#L549" class="js-smell-location">3</a>                  <a href="links_manager.html#L551" class="js-smell-location">4</a>                  <a href="links_manager.html#L557" class="js-smell-location">5</a>                  <a href="links_manager.html#L559" class="js-smell-location">6</a>                  <a href="links_manager.html#L560" class="js-smell-location">7</a>                  <a href="links_manager.html#L561" class="js-smell-location">8</a>                  <a href="links_manager.html#L563" class="js-smell-location">9</a>                  </div>  </li></ol>
            return false unless are_equal(content1[key], content2[key])<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal calls 'content1[key]' 4 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L548" class="js-smell-location">0</a>                  <a href="links_manager.html#L549" class="js-smell-location">1</a>                  <a href="links_manager.html#L551" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal calls 'content2[key]' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L548" class="js-smell-location">0</a>                  <a href="links_manager.html#L549" class="js-smell-location">1</a>                  <a href="links_manager.html#L551" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal refers to 'content2' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L545" class="js-smell-location">0</a>                  <a href="links_manager.html#L547" class="js-smell-location">1</a>                  <a href="links_manager.html#L548" class="js-smell-location">2</a>                  <a href="links_manager.html#L549" class="js-smell-location">3</a>                  <a href="links_manager.html#L551" class="js-smell-location">4</a>                  <a href="links_manager.html#L557" class="js-smell-location">5</a>                  <a href="links_manager.html#L559" class="js-smell-location">6</a>                  <a href="links_manager.html#L560" class="js-smell-location">7</a>                  <a href="links_manager.html#L561" class="js-smell-location">8</a>                  <a href="links_manager.html#L563" class="js-smell-location">9</a>                  </div>  </li></ol>
          else
            return false unless content1[key].eql?(content2[key])<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal calls 'content1[key]' 4 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L548" class="js-smell-location">0</a>                  <a href="links_manager.html#L549" class="js-smell-location">1</a>                  <a href="links_manager.html#L551" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal calls 'content2[key]' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L548" class="js-smell-location">0</a>                  <a href="links_manager.html#L549" class="js-smell-location">1</a>                  <a href="links_manager.html#L551" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal refers to 'content2' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L545" class="js-smell-location">0</a>                  <a href="links_manager.html#L547" class="js-smell-location">1</a>                  <a href="links_manager.html#L548" class="js-smell-location">2</a>                  <a href="links_manager.html#L549" class="js-smell-location">3</a>                  <a href="links_manager.html#L551" class="js-smell-location">4</a>                  <a href="links_manager.html#L557" class="js-smell-location">5</a>                  <a href="links_manager.html#L559" class="js-smell-location">6</a>                  <a href="links_manager.html#L560" class="js-smell-location">7</a>                  <a href="links_manager.html#L561" class="js-smell-location">8</a>                  <a href="links_manager.html#L563" class="js-smell-location">9</a>                  </div>  </li></ol>
          end
        end
      end

      if content1.is_a?(Array)
        return false unless content2.count.equal?(content1.count)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal refers to 'content2' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L545" class="js-smell-location">0</a>                  <a href="links_manager.html#L547" class="js-smell-location">1</a>                  <a href="links_manager.html#L548" class="js-smell-location">2</a>                  <a href="links_manager.html#L549" class="js-smell-location">3</a>                  <a href="links_manager.html#L551" class="js-smell-location">4</a>                  <a href="links_manager.html#L557" class="js-smell-location">5</a>                  <a href="links_manager.html#L559" class="js-smell-location">6</a>                  <a href="links_manager.html#L560" class="js-smell-location">7</a>                  <a href="links_manager.html#L561" class="js-smell-location">8</a>                  <a href="links_manager.html#L563" class="js-smell-location">9</a>                  </div>  </li></ol>
        content1.each do |item|
          return false unless content2.include?(item)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal refers to 'content2' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L545" class="js-smell-location">0</a>                  <a href="links_manager.html#L547" class="js-smell-location">1</a>                  <a href="links_manager.html#L548" class="js-smell-location">2</a>                  <a href="links_manager.html#L549" class="js-smell-location">3</a>                  <a href="links_manager.html#L551" class="js-smell-location">4</a>                  <a href="links_manager.html#L557" class="js-smell-location">5</a>                  <a href="links_manager.html#L559" class="js-smell-location">6</a>                  <a href="links_manager.html#L560" class="js-smell-location">7</a>                  <a href="links_manager.html#L561" class="js-smell-location">8</a>                  <a href="links_manager.html#L563" class="js-smell-location">9</a>                  </div>  </li></ol>
          if item.is_a?(Enumerable) &amp;&amp; item.class == content2.fetch(content2.find_index(item)).class<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal calls 'content2.fetch(content2.find_index(item))' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L560" class="js-smell-location">0</a>                  <a href="links_manager.html#L561" class="js-smell-location">1</a>                  <a href="links_manager.html#L563" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal calls 'content2.find_index(item)' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L560" class="js-smell-location">0</a>                  <a href="links_manager.html#L561" class="js-smell-location">1</a>                  <a href="links_manager.html#L563" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal refers to 'content2' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L545" class="js-smell-location">0</a>                  <a href="links_manager.html#L547" class="js-smell-location">1</a>                  <a href="links_manager.html#L548" class="js-smell-location">2</a>                  <a href="links_manager.html#L549" class="js-smell-location">3</a>                  <a href="links_manager.html#L551" class="js-smell-location">4</a>                  <a href="links_manager.html#L557" class="js-smell-location">5</a>                  <a href="links_manager.html#L559" class="js-smell-location">6</a>                  <a href="links_manager.html#L560" class="js-smell-location">7</a>                  <a href="links_manager.html#L561" class="js-smell-location">8</a>                  <a href="links_manager.html#L563" class="js-smell-location">9</a>                  </div>  </li></ol>
            return false unless are_equal(item, content2.fetch(content2.find_index(item)))<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal calls 'content2.fetch(content2.find_index(item))' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L560" class="js-smell-location">0</a>                  <a href="links_manager.html#L561" class="js-smell-location">1</a>                  <a href="links_manager.html#L563" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal calls 'content2.find_index(item)' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L560" class="js-smell-location">0</a>                  <a href="links_manager.html#L561" class="js-smell-location">1</a>                  <a href="links_manager.html#L563" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal refers to 'content2' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L545" class="js-smell-location">0</a>                  <a href="links_manager.html#L547" class="js-smell-location">1</a>                  <a href="links_manager.html#L548" class="js-smell-location">2</a>                  <a href="links_manager.html#L549" class="js-smell-location">3</a>                  <a href="links_manager.html#L551" class="js-smell-location">4</a>                  <a href="links_manager.html#L557" class="js-smell-location">5</a>                  <a href="links_manager.html#L559" class="js-smell-location">6</a>                  <a href="links_manager.html#L560" class="js-smell-location">7</a>                  <a href="links_manager.html#L561" class="js-smell-location">8</a>                  <a href="links_manager.html#L563" class="js-smell-location">9</a>                  </div>  </li></ol>
          else
            return false unless item.eql?(content2.fetch(content2.find_index(item)))<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal calls 'content2.fetch(content2.find_index(item))' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L560" class="js-smell-location">0</a>                  <a href="links_manager.html#L561" class="js-smell-location">1</a>                  <a href="links_manager.html#L563" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal calls 'content2.find_index(item)' 3 times</span>              <span>Locations:</span>                  <a href="links_manager.html#L560" class="js-smell-location">0</a>                  <a href="links_manager.html#L561" class="js-smell-location">1</a>                  <a href="links_manager.html#L563" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksManager#are_equal refers to 'content2' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_manager.html#L545" class="js-smell-location">0</a>                  <a href="links_manager.html#L547" class="js-smell-location">1</a>                  <a href="links_manager.html#L548" class="js-smell-location">2</a>                  <a href="links_manager.html#L549" class="js-smell-location">3</a>                  <a href="links_manager.html#L551" class="js-smell-location">4</a>                  <a href="links_manager.html#L557" class="js-smell-location">5</a>                  <a href="links_manager.html#L559" class="js-smell-location">6</a>                  <a href="links_manager.html#L560" class="js-smell-location">7</a>                  <a href="links_manager.html#L561" class="js-smell-location">8</a>                  <a href="links_manager.html#L563" class="js-smell-location">9</a>                  </div>  </li></ol>
          end
        end
      end

      true
    end
  end
end
</code>
  </div>
</div>

        </div>
      </div>
    </div>

    <!-- Javascripts -->
    <script src='../../../assets/javascripts/jquery.min.js'></script>
    <script src='../../../assets/javascripts/jquery.tablesorter.min.js'></script>
    <script src='../../../assets/javascripts/jquery.scrollTo.min.js'></script>
    <script src='../../../assets/javascripts/jquery.timeago.js'></script>
    <script src='../../../assets/javascripts/highcharts.src-4.0.1.js'></script>
    <script src='../../../assets/javascripts/prettify.js'></script>
    <script src='../../../assets/javascripts/bootstrap.min.js'></script>
    <script src='../../../assets/javascripts/application.js'></script>
    <script src='../../../assets/javascripts/jquery.filtertable.min.js'></script>
  </body>
</html>
