<!DOCTYPE html>
<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ruby Critic - Home</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- StyleSheets -->
    <link href="../../../assets/stylesheets/bootstrap.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../assets/stylesheets/font-awesome.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../assets/stylesheets/prettify.custom_theme.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../assets/stylesheets/application.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  </head>

  <body>
    <header class="navbar navbar-default navbar-fixed-top">
      <a href="#menu-toggle" class="btn btn-default hidden-lg visible-sm-* hidden-md visible-xs-* pull-left" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a>
      <a href="../../../overview.html"><img src="../../../assets/images/logo.png" title="Ruby Critic Logo" width="55"><span class="logo">RUBYCRITIC</span></a>
    </header>
    <div id="wrapper">
      <!-- Sidebar -->
      <aside id="sidebar-wrapper">
        <ul class="sidebar-nav">
          <li class="sidebar-item">
            <a href="../../../overview.html" class="project-nav-item overview-nav"><i class="fa fa-dashboard"></i>Overview</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../code_index.html" class="project-nav-item code-index-nav"><i class="fa fa-code"></i>Code</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../smells_index.html" class="project-nav-item smells-index-nav"><i class="fa fa-warning"></i>Smells</a>
          </li>
        </ul>
      </aside>
      <!-- /#sidebar-wrapper -->
      <div id="page-content-wrapper">
        <div class="container-fluid">
          <div class="row">
  <!--Page Title -->
  <div class="Page_Title">
    <div class="file-time">
      <span class="committed-at">
        
          Updated <time class='js-timeago' datetime='2018-06-22 15:27:04 -0400'>2018-06-22 15:27:04 -0400</time>
        
      </span>
    </div>
    <div>
      <h3><small>bosh/director/config_server /</small> client.rb</h3>
    </div>
  </div>
  <!--End Page Title -->
  <div class="Content_Wrapper">
    <!-- code detail -->
    <div class="code-top-detail clearfix row">
      <div class="col-md-8">
        <div class="row">
          <div class="col-md-1">
            <div class="rating f big">
              F
            </div>
          </div>
          <div class="code-statistics col-md-11">
            <div class="col-md-3">
              <div><span class="metric">469</span><small> lines of codes</small></div>
              <div><span class="metric">22</span><small> methods</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">19.2</span><small> complexity/method</small></div>
              <div><span class="metric">91</span><small> churn</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">421.42</span><small> complexity</small></div>
              <div><span class="metric">106</span><small> duplications</small></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="code-tabs">
          <ul class="nav nav-pills right-to-left">
            <li><a href="#" id="toggle-code" class="toggle-button button">code</a></li>
            <li class="active">
              <a href="#" id="toggle-smells" class="toggle-button button">
                73
                smells
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <code class="prettyprint linenums lang-ruby file-code js-file-code">require &#39;bosh/director/config_server/config_server_helper&#39;

module Bosh::Director::ConfigServer
  class ConfigServerClient<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Irresponsible-Module.md" target="_blank"><b>IrresponsibleModule</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient has no descriptive comment</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Instance-Variables.md" target="_blank"><b>TooManyInstanceVariables</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient has at least 5 instance variables</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Methods.md" target="_blank"><b>TooManyMethods</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient has at least 22 methods</span>          </div>  </li></ol>
    def initialize(http_client, director_name, logger)
      @config_server_http_client = http_client
      @director_name = director_name
      @deep_hash_replacer = DeepHashReplacement.new
      @deployment_lookup = Bosh::Director::Api::DeploymentLookup.new
      @logger = logger
    end

    # @param [Hash] raw_hash Hash to be interpolated. This method only supports Absolute Names.
    # @param [Hash] options Additional options
    #   Options include:
    #   - &#39;subtrees_to_ignore&#39;: [Array] Array of paths that should not be interpolated in src
    # @return [Hash] A Deep copy of the interpolated src Hash
    def interpolate(raw_hash, options = {})<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#interpolate has approx 8 statements</span>          </div>  </li></ol>
      return raw_hash if raw_hash.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#interpolate performs a nil-check</span>          </div>  </li></ol>
      raise &quot;Unable to interpolate provided object. Expected a &#39;Hash&#39;, got &#39;#{raw_hash.class}&#39;&quot; unless raw_hash.is_a?(Hash)

      subtrees_to_ignore = options.fetch(:subtrees_to_ignore, [])

      variables_paths = @deep_hash_replacer.variables_path(raw_hash, subtrees_to_ignore)
      variables_list = variables_paths.flat_map { |c| c[&#39;variables&#39;] }.uniq<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Uncommunicative-Variable-Name.md" target="_blank"><b>UncommunicativeVariableName</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#interpolate has the variable name 'c'</span>          </div>  </li></ol>

      retrieved_config_server_values = fetch_values_with_latest(variables_list)

      @deep_hash_replacer.replace_variables(raw_hash, variables_paths, retrieved_config_server_values)
    end

    # @param [Hash] raw_hash Hash to be interpolated
    # @param [VariableSet] variable_set The variable set to use with interpolation.
    # @param [Hash] options Additional options
    #   Options include:
    #   - &#39;subtrees_to_ignore&#39;: [Array] Array of paths that should not be interpolated in src
    #   - &#39;must_be_absolute_name&#39;: [Boolean] Flag to check if all the variables start with &#39;/&#39;
    # @return [Hash] A Deep copy of the interpolated src Hash
    def interpolate_with_versioning(raw_hash, variable_set, options = {})<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#interpolate_with_versioning has approx 10 statements</span>          </div>  </li></ol>
      return raw_hash if raw_hash.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#interpolate_with_versioning performs a nil-check</span>              <span>Locations:</span>                  <a href="client.html#L40" class="js-smell-location">0</a>                  <a href="client.html#L42" class="js-smell-location">1</a>                  </div>  </li></ol>
      raise &quot;Unable to interpolate provided object. Expected a &#39;Hash&#39;, got &#39;#{raw_hash.class}&#39;&quot; unless raw_hash.is_a?(Hash)
      raise &quot;Variable Set cannot be nil.&quot; if variable_set.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#interpolate_with_versioning performs a nil-check</span>              <span>Locations:</span>                  <a href="client.html#L40" class="js-smell-location">0</a>                  <a href="client.html#L42" class="js-smell-location">1</a>                  </div>  </li></ol>

      subtrees_to_ignore = options.fetch(:subtrees_to_ignore, [])

      variables_paths = @deep_hash_replacer.variables_path(raw_hash, subtrees_to_ignore)
      variables_list = variables_paths.flat_map { |c| c[&#39;variables&#39;] }.uniq<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Uncommunicative-Variable-Name.md" target="_blank"><b>UncommunicativeVariableName</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#interpolate_with_versioning has the variable name 'c'</span>          </div>  </li></ol>

      must_be_absolute_name = options.fetch(:must_be_absolute_name, false)
      retrieved_config_server_values = fetch_values_with_deployment(variables_list, variable_set, must_be_absolute_name)

      @deep_hash_replacer.replace_variables(raw_hash, variables_paths, retrieved_config_server_values)
    end

    # @param [Hash] link_properties_hash Link spec properties to be interpolated
    # @param [VariableSet] consumer_variable_set The variable set of the consumer deployment
    # @param [VariableSet] provider_variable_set The variable set of the provider deployment
    # @return [Hash] A Deep copy of the interpolated links spec
    def interpolate_cross_deployment_link(link_properties_hash, consumer_variable_set, provider_variable_set)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#interpolate_cross_deployment_link has approx 7 statements</span>          </div>  </li></ol>
      return link_properties_hash if link_properties_hash.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#interpolate_cross_deployment_link performs a nil-check</span>          </div>  </li></ol>
      raise &quot;Unable to interpolate cross deployment link properties. Expected a &#39;Hash&#39;, got &#39;#{link_properties_hash.class}&#39;&quot; unless link_properties_hash.is_a?(Hash)

      variables_paths = @deep_hash_replacer.variables_path(link_properties_hash)
      variables_list = variables_paths.flat_map { |c| c[&#39;variables&#39;] }.uniq<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Uncommunicative-Variable-Name.md" target="_blank"><b>UncommunicativeVariableName</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#interpolate_cross_deployment_link has the variable name 'c'</span>          </div>  </li></ol>

      retrieved_config_server_values = resolve_cross_deployments_variables(variables_list, consumer_variable_set, provider_variable_set)

      @deep_hash_replacer.replace_variables(link_properties_hash, variables_paths, retrieved_config_server_values)
    end

    # @param [DeploymentPlan::Variables] variables Object representing variables passed by the user
    # @param [String] deployment_name
    def generate_values(variables, deployment_name, converge_variables = false)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values has a flog score of 59</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Boolean-Parameter.md" target="_blank"><b>BooleanParameter</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values has boolean parameter 'converge_variables'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values has approx 15 statements</span>          </div>  </li></ol>
      deployment_model = @deployment_lookup.by_name(deployment_name)
      current_variable_set = deployment_model.current_variable_set

      variables.spec.each do |variable|
        variable_name = variable[&#39;name&#39;]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values refers to 'variable' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L78" class="js-smell-location">0</a>                  <a href="client.html#L87" class="js-smell-location">1</a>                  <a href="client.html#L88" class="js-smell-location">2</a>                  <a href="client.html#L89" class="js-smell-location">3</a>                  <a href="client.html#L95" class="js-smell-location">4</a>                  <a href="client.html#L99" class="js-smell-location">5</a>                  <a href="client.html#L104" class="js-smell-location">6</a>                  <a href="client.html#L105" class="js-smell-location">7</a>                  <a href="client.html#L107" class="js-smell-location">8</a>                  <a href="client.html#L115" class="js-smell-location">9</a>                  <a href="client.html#L118" class="js-smell-location">10</a>                  </div>  </li></ol>
        ConfigServerHelper.validate_variable_name(variable_name)

        constructed_name = ConfigServerHelper.add_prefix_if_not_absolute(
          variable_name,
          @director_name,
          deployment_name,
        )

        if variable[&#39;type&#39;] == &#39;certificate&#39; &amp;&amp; variable[&#39;options&#39;] &amp;&amp; variable[&#39;options&#39;][&#39;ca&#39;]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values calls 'variable['options']' 10 times</span>              <span>Locations:</span>                  <a href="client.html#L87" class="js-smell-location">0</a>                  <a href="client.html#L88" class="js-smell-location">1</a>                  <a href="client.html#L89" class="js-smell-location">2</a>                  <a href="client.html#L99" class="js-smell-location">3</a>                  <a href="client.html#L104" class="js-smell-location">4</a>                  <a href="client.html#L105" class="js-smell-location">5</a>                  <a href="client.html#L107" class="js-smell-location">6</a>                  <a href="client.html#L118" class="js-smell-location">7</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values calls 'variable['options']['ca']' 2 times</span>              <span>Locations:</span>                  <a href="client.html#L87" class="js-smell-location">0</a>                  <a href="client.html#L89" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values calls 'variable['type'] == 'certificate'' 2 times</span>              <span>Locations:</span>                  <a href="client.html#L87" class="js-smell-location">0</a>                  <a href="client.html#L95" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values calls 'variable['type']' 3 times</span>              <span>Locations:</span>                  <a href="client.html#L87" class="js-smell-location">0</a>                  <a href="client.html#L95" class="js-smell-location">1</a>                  <a href="client.html#L115" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values refers to 'variable' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L78" class="js-smell-location">0</a>                  <a href="client.html#L87" class="js-smell-location">1</a>                  <a href="client.html#L88" class="js-smell-location">2</a>                  <a href="client.html#L89" class="js-smell-location">3</a>                  <a href="client.html#L95" class="js-smell-location">4</a>                  <a href="client.html#L99" class="js-smell-location">5</a>                  <a href="client.html#L104" class="js-smell-location">6</a>                  <a href="client.html#L105" class="js-smell-location">7</a>                  <a href="client.html#L107" class="js-smell-location">8</a>                  <a href="client.html#L115" class="js-smell-location">9</a>                  <a href="client.html#L118" class="js-smell-location">10</a>                  </div>  </li></ol>
          variable[&#39;options&#39;][&#39;ca&#39;] = ConfigServerHelper.add_prefix_if_not_absolute(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values calls 'variable['options']' 10 times</span>              <span>Locations:</span>                  <a href="client.html#L87" class="js-smell-location">0</a>                  <a href="client.html#L88" class="js-smell-location">1</a>                  <a href="client.html#L89" class="js-smell-location">2</a>                  <a href="client.html#L99" class="js-smell-location">3</a>                  <a href="client.html#L104" class="js-smell-location">4</a>                  <a href="client.html#L105" class="js-smell-location">5</a>                  <a href="client.html#L107" class="js-smell-location">6</a>                  <a href="client.html#L118" class="js-smell-location">7</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values refers to 'variable' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L78" class="js-smell-location">0</a>                  <a href="client.html#L87" class="js-smell-location">1</a>                  <a href="client.html#L88" class="js-smell-location">2</a>                  <a href="client.html#L89" class="js-smell-location">3</a>                  <a href="client.html#L95" class="js-smell-location">4</a>                  <a href="client.html#L99" class="js-smell-location">5</a>                  <a href="client.html#L104" class="js-smell-location">6</a>                  <a href="client.html#L105" class="js-smell-location">7</a>                  <a href="client.html#L107" class="js-smell-location">8</a>                  <a href="client.html#L115" class="js-smell-location">9</a>                  <a href="client.html#L118" class="js-smell-location">10</a>                  </div>  </li></ol>
            variable[&#39;options&#39;][&#39;ca&#39;],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values calls 'variable['options']' 10 times</span>              <span>Locations:</span>                  <a href="client.html#L87" class="js-smell-location">0</a>                  <a href="client.html#L88" class="js-smell-location">1</a>                  <a href="client.html#L89" class="js-smell-location">2</a>                  <a href="client.html#L99" class="js-smell-location">3</a>                  <a href="client.html#L104" class="js-smell-location">4</a>                  <a href="client.html#L105" class="js-smell-location">5</a>                  <a href="client.html#L107" class="js-smell-location">6</a>                  <a href="client.html#L118" class="js-smell-location">7</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values calls 'variable['options']['ca']' 2 times</span>              <span>Locations:</span>                  <a href="client.html#L87" class="js-smell-location">0</a>                  <a href="client.html#L89" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values refers to 'variable' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L78" class="js-smell-location">0</a>                  <a href="client.html#L87" class="js-smell-location">1</a>                  <a href="client.html#L88" class="js-smell-location">2</a>                  <a href="client.html#L89" class="js-smell-location">3</a>                  <a href="client.html#L95" class="js-smell-location">4</a>                  <a href="client.html#L99" class="js-smell-location">5</a>                  <a href="client.html#L104" class="js-smell-location">6</a>                  <a href="client.html#L105" class="js-smell-location">7</a>                  <a href="client.html#L107" class="js-smell-location">8</a>                  <a href="client.html#L115" class="js-smell-location">9</a>                  <a href="client.html#L118" class="js-smell-location">10</a>                  </div>  </li></ol>
            @director_name,
            deployment_name,
          )
        end

        if variable[&#39;type&#39;] == &#39;certificate&#39;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values calls 'variable['type'] == 'certificate'' 2 times</span>              <span>Locations:</span>                  <a href="client.html#L87" class="js-smell-location">0</a>                  <a href="client.html#L95" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values calls 'variable['type']' 3 times</span>              <span>Locations:</span>                  <a href="client.html#L87" class="js-smell-location">0</a>                  <a href="client.html#L95" class="js-smell-location">1</a>                  <a href="client.html#L115" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values refers to 'variable' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L78" class="js-smell-location">0</a>                  <a href="client.html#L87" class="js-smell-location">1</a>                  <a href="client.html#L88" class="js-smell-location">2</a>                  <a href="client.html#L89" class="js-smell-location">3</a>                  <a href="client.html#L95" class="js-smell-location">4</a>                  <a href="client.html#L99" class="js-smell-location">5</a>                  <a href="client.html#L104" class="js-smell-location">6</a>                  <a href="client.html#L105" class="js-smell-location">7</a>                  <a href="client.html#L107" class="js-smell-location">8</a>                  <a href="client.html#L115" class="js-smell-location">9</a>                  <a href="client.html#L118" class="js-smell-location">10</a>                  </div>  </li></ol>
          links = find_variable_link(deployment_model, variable_name)

          unless links.empty?
            variable[&#39;options&#39;] ||= {}<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values calls 'variable['options']' 10 times</span>              <span>Locations:</span>                  <a href="client.html#L87" class="js-smell-location">0</a>                  <a href="client.html#L88" class="js-smell-location">1</a>                  <a href="client.html#L89" class="js-smell-location">2</a>                  <a href="client.html#L99" class="js-smell-location">3</a>                  <a href="client.html#L104" class="js-smell-location">4</a>                  <a href="client.html#L105" class="js-smell-location">5</a>                  <a href="client.html#L107" class="js-smell-location">6</a>                  <a href="client.html#L118" class="js-smell-location">7</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values refers to 'variable' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L78" class="js-smell-location">0</a>                  <a href="client.html#L87" class="js-smell-location">1</a>                  <a href="client.html#L88" class="js-smell-location">2</a>                  <a href="client.html#L89" class="js-smell-location">3</a>                  <a href="client.html#L95" class="js-smell-location">4</a>                  <a href="client.html#L99" class="js-smell-location">5</a>                  <a href="client.html#L104" class="js-smell-location">6</a>                  <a href="client.html#L105" class="js-smell-location">7</a>                  <a href="client.html#L107" class="js-smell-location">8</a>                  <a href="client.html#L115" class="js-smell-location">9</a>                  <a href="client.html#L118" class="js-smell-location">10</a>                  </div>  </li></ol>
            links.each do |type, link|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values contains iterators nested 2 deep</span>          </div>  </li></ol>
              link_url = generate_dns_address_from_link(link)

              if type == &#39;alternative_name&#39;
                variable[&#39;options&#39;][&#39;alternative_names&#39;] ||= []<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values calls 'variable['options']' 10 times</span>              <span>Locations:</span>                  <a href="client.html#L87" class="js-smell-location">0</a>                  <a href="client.html#L88" class="js-smell-location">1</a>                  <a href="client.html#L89" class="js-smell-location">2</a>                  <a href="client.html#L99" class="js-smell-location">3</a>                  <a href="client.html#L104" class="js-smell-location">4</a>                  <a href="client.html#L105" class="js-smell-location">5</a>                  <a href="client.html#L107" class="js-smell-location">6</a>                  <a href="client.html#L118" class="js-smell-location">7</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values calls 'variable['options']['alternative_names']' 2 times</span>              <span>Locations:</span>                  <a href="client.html#L104" class="js-smell-location">0</a>                  <a href="client.html#L105" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values refers to 'variable' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L78" class="js-smell-location">0</a>                  <a href="client.html#L87" class="js-smell-location">1</a>                  <a href="client.html#L88" class="js-smell-location">2</a>                  <a href="client.html#L89" class="js-smell-location">3</a>                  <a href="client.html#L95" class="js-smell-location">4</a>                  <a href="client.html#L99" class="js-smell-location">5</a>                  <a href="client.html#L104" class="js-smell-location">6</a>                  <a href="client.html#L105" class="js-smell-location">7</a>                  <a href="client.html#L107" class="js-smell-location">8</a>                  <a href="client.html#L115" class="js-smell-location">9</a>                  <a href="client.html#L118" class="js-smell-location">10</a>                  </div>  </li></ol>
                variable[&#39;options&#39;][&#39;alternative_names&#39;] &lt;&lt; link_url<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values calls 'variable['options']' 10 times</span>              <span>Locations:</span>                  <a href="client.html#L87" class="js-smell-location">0</a>                  <a href="client.html#L88" class="js-smell-location">1</a>                  <a href="client.html#L89" class="js-smell-location">2</a>                  <a href="client.html#L99" class="js-smell-location">3</a>                  <a href="client.html#L104" class="js-smell-location">4</a>                  <a href="client.html#L105" class="js-smell-location">5</a>                  <a href="client.html#L107" class="js-smell-location">6</a>                  <a href="client.html#L118" class="js-smell-location">7</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values calls 'variable['options']['alternative_names']' 2 times</span>              <span>Locations:</span>                  <a href="client.html#L104" class="js-smell-location">0</a>                  <a href="client.html#L105" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values refers to 'variable' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L78" class="js-smell-location">0</a>                  <a href="client.html#L87" class="js-smell-location">1</a>                  <a href="client.html#L88" class="js-smell-location">2</a>                  <a href="client.html#L89" class="js-smell-location">3</a>                  <a href="client.html#L95" class="js-smell-location">4</a>                  <a href="client.html#L99" class="js-smell-location">5</a>                  <a href="client.html#L104" class="js-smell-location">6</a>                  <a href="client.html#L105" class="js-smell-location">7</a>                  <a href="client.html#L107" class="js-smell-location">8</a>                  <a href="client.html#L115" class="js-smell-location">9</a>                  <a href="client.html#L118" class="js-smell-location">10</a>                  </div>  </li></ol>
              elsif type == &#39;common_name&#39;
                variable[&#39;options&#39;][type] = variable[&#39;options&#39;][type] || link_url<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values calls 'variable['options']' 10 times</span>              <span>Locations:</span>                  <a href="client.html#L87" class="js-smell-location">0</a>                  <a href="client.html#L88" class="js-smell-location">1</a>                  <a href="client.html#L89" class="js-smell-location">2</a>                  <a href="client.html#L99" class="js-smell-location">3</a>                  <a href="client.html#L104" class="js-smell-location">4</a>                  <a href="client.html#L105" class="js-smell-location">5</a>                  <a href="client.html#L107" class="js-smell-location">6</a>                  <a href="client.html#L118" class="js-smell-location">7</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values refers to 'variable' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L78" class="js-smell-location">0</a>                  <a href="client.html#L87" class="js-smell-location">1</a>                  <a href="client.html#L88" class="js-smell-location">2</a>                  <a href="client.html#L89" class="js-smell-location">3</a>                  <a href="client.html#L95" class="js-smell-location">4</a>                  <a href="client.html#L99" class="js-smell-location">5</a>                  <a href="client.html#L104" class="js-smell-location">6</a>                  <a href="client.html#L105" class="js-smell-location">7</a>                  <a href="client.html#L107" class="js-smell-location">8</a>                  <a href="client.html#L115" class="js-smell-location">9</a>                  <a href="client.html#L118" class="js-smell-location">10</a>                  </div>  </li></ol>
              end
            end
          end
        end

        generate_value_and_record_event(
          constructed_name,
          variable[&#39;type&#39;],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values calls 'variable['type']' 3 times</span>              <span>Locations:</span>                  <a href="client.html#L87" class="js-smell-location">0</a>                  <a href="client.html#L95" class="js-smell-location">1</a>                  <a href="client.html#L115" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values refers to 'variable' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L78" class="js-smell-location">0</a>                  <a href="client.html#L87" class="js-smell-location">1</a>                  <a href="client.html#L88" class="js-smell-location">2</a>                  <a href="client.html#L89" class="js-smell-location">3</a>                  <a href="client.html#L95" class="js-smell-location">4</a>                  <a href="client.html#L99" class="js-smell-location">5</a>                  <a href="client.html#L104" class="js-smell-location">6</a>                  <a href="client.html#L105" class="js-smell-location">7</a>                  <a href="client.html#L107" class="js-smell-location">8</a>                  <a href="client.html#L115" class="js-smell-location">9</a>                  <a href="client.html#L118" class="js-smell-location">10</a>                  </div>  </li></ol>
          deployment_name,
          current_variable_set,
          variable[&#39;options&#39;],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values calls 'variable['options']' 10 times</span>              <span>Locations:</span>                  <a href="client.html#L87" class="js-smell-location">0</a>                  <a href="client.html#L88" class="js-smell-location">1</a>                  <a href="client.html#L89" class="js-smell-location">2</a>                  <a href="client.html#L99" class="js-smell-location">3</a>                  <a href="client.html#L104" class="js-smell-location">4</a>                  <a href="client.html#L105" class="js-smell-location">5</a>                  <a href="client.html#L107" class="js-smell-location">6</a>                  <a href="client.html#L118" class="js-smell-location">7</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_values refers to 'variable' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L78" class="js-smell-location">0</a>                  <a href="client.html#L87" class="js-smell-location">1</a>                  <a href="client.html#L88" class="js-smell-location">2</a>                  <a href="client.html#L89" class="js-smell-location">3</a>                  <a href="client.html#L95" class="js-smell-location">4</a>                  <a href="client.html#L99" class="js-smell-location">5</a>                  <a href="client.html#L104" class="js-smell-location">6</a>                  <a href="client.html#L105" class="js-smell-location">7</a>                  <a href="client.html#L107" class="js-smell-location">8</a>                  <a href="client.html#L115" class="js-smell-location">9</a>                  <a href="client.html#L118" class="js-smell-location">10</a>                  </div>  </li></ol>
          converge_variables,
        )
      end
    end

    private

    def generate_wildcard(link_url)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_wildcard doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
      exploded = link_url.split(&#39;.&#39;, 2)
      exploded[0] = &#39;*&#39;
      exploded.join(&#39;.&#39;)
    end

    def find_variable_link(deployment_model, variable_name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#find_variable_link has approx 7 statements</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#find_variable_link doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
      links_manager = Bosh::Director::Links::LinksManager.new(deployment_model.links_serial_id)

      consumer = links_manager.find_consumer(
        deployment_model: deployment_model,
        instance_group_name: &#39;&#39;,
        name: variable_name,
        type: &#39;variable&#39;,
      )

      return {} if consumer.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#find_variable_link performs a nil-check</span>          </div>  </li></ol>

      result = {}
      consumer.intents.each do |consumer_intent|
        result[consumer_intent.original_name] = consumer_intent.links.first
      end
      result
    end

    def generate_dns_address_from_link(link)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_dns_address_from_link has approx 8 statements</span>          </div>  </li></ol>
      link_content = JSON.parse(link.link_content)

      return link_content[&#39;address&#39;] if link.link_provider_intent&amp;.link_provider&amp;.type == &#39;manual&#39;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_dns_address_from_link refers to 'link_content' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L154" class="js-smell-location">0</a>                  <a href="client.html#L156" class="js-smell-location">1</a>                  <a href="client.html#L159" class="js-smell-location">2</a>                  <a href="client.html#L160" class="js-smell-location">3</a>                  <a href="client.html#L161" class="js-smell-location">4</a>                  <a href="client.html#L162" class="js-smell-location">5</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_dns_address_from_link performs a nil-check</span>          </div>  </li></ol>

      use_short_dns_addresses = link_content.fetch(&#39;use_short_dns_addresses&#39;, false)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_dns_address_from_link refers to 'link_content' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L154" class="js-smell-location">0</a>                  <a href="client.html#L156" class="js-smell-location">1</a>                  <a href="client.html#L159" class="js-smell-location">2</a>                  <a href="client.html#L160" class="js-smell-location">3</a>                  <a href="client.html#L161" class="js-smell-location">4</a>                  <a href="client.html#L162" class="js-smell-location">5</a>                  </div>  </li></ol>
      dns_encoder = Bosh::Director::LocalDnsEncoderManager.create_dns_encoder(use_short_dns_addresses)
      query_criteria = {
        deployment_name: link_content[&#39;deployment_name&#39;],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_dns_address_from_link refers to 'link_content' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L154" class="js-smell-location">0</a>                  <a href="client.html#L156" class="js-smell-location">1</a>                  <a href="client.html#L159" class="js-smell-location">2</a>                  <a href="client.html#L160" class="js-smell-location">3</a>                  <a href="client.html#L161" class="js-smell-location">4</a>                  <a href="client.html#L162" class="js-smell-location">5</a>                  </div>  </li></ol>
        instance_group: link_content[&#39;instance_group&#39;],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_dns_address_from_link refers to 'link_content' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L154" class="js-smell-location">0</a>                  <a href="client.html#L156" class="js-smell-location">1</a>                  <a href="client.html#L159" class="js-smell-location">2</a>                  <a href="client.html#L160" class="js-smell-location">3</a>                  <a href="client.html#L161" class="js-smell-location">4</a>                  <a href="client.html#L162" class="js-smell-location">5</a>                  </div>  </li></ol>
        default_network: link_content[&#39;default_network&#39;],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_dns_address_from_link refers to 'link_content' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L154" class="js-smell-location">0</a>                  <a href="client.html#L156" class="js-smell-location">1</a>                  <a href="client.html#L159" class="js-smell-location">2</a>                  <a href="client.html#L160" class="js-smell-location">3</a>                  <a href="client.html#L161" class="js-smell-location">4</a>                  <a href="client.html#L162" class="js-smell-location">5</a>                  </div>  </li></ol>
        root_domain: link_content[&#39;domain&#39;],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_dns_address_from_link refers to 'link_content' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L154" class="js-smell-location">0</a>                  <a href="client.html#L156" class="js-smell-location">1</a>                  <a href="client.html#L159" class="js-smell-location">2</a>                  <a href="client.html#L160" class="js-smell-location">3</a>                  <a href="client.html#L161" class="js-smell-location">4</a>                  <a href="client.html#L162" class="js-smell-location">5</a>                  </div>  </li></ol>
      }
      url = dns_encoder.encode_query(query_criteria)
      url = generate_wildcard(url) if link_wants_wildcard(link)
      url
    end

    def link_wants_wildcard(link)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#link_wants_wildcard doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
      metadata = JSON.parse(link.link_consumer_intent.metadata || &#39;{}&#39;)
      metadata[&#39;wildcard&#39;] || false
    end

    def fetch_values_with_deployment(variables, variable_set, must_be_absolute_name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#fetch_values_with_deployment has a flog score of 47</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#fetch_values_with_deployment has approx 21 statements</span>          </div>  </li></ol>
      ConfigServerHelper.validate_absolute_names(variables) if must_be_absolute_name<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Control-Parameter.md" target="_blank"><b>ControlParameter</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#fetch_values_with_deployment is controlled by argument 'must_be_absolute_name'</span>          </div>  </li></ol>

      errors = []
      config_values = {}

      deployment_name = variable_set.deployment.name

      variables.each do |variable|
        name = ConfigServerHelper.add_prefix_if_not_absolute(
          ConfigServerHelper.extract_variable_name(variable),
          @director_name,
          deployment_name
        )

        begin
          name_root = get_name_root(name)

          saved_variable_mapping = variable_set.find_variable_by_name(name_root)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#fetch_values_with_deployment calls 'variable_set.find_variable_by_name(name_root)' 2 times</span>              <span>Locations:</span>                  <a href="client.html#L192" class="js-smell-location">0</a>                  <a href="client.html#L203" class="js-smell-location">1</a>                  </div>  </li></ol>

          if saved_variable_mapping.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#fetch_values_with_deployment performs a nil-check</span>          </div>  </li></ol>
            raise Bosh::Director::ConfigServerInconsistentVariableState, &quot;Expected variable &#39;#{name_root}&#39; to be already versioned in deployment &#39;#{deployment_name}&#39;&quot; unless variable_set.writable

            variable_id, variable_value = get_variable_id_and_value_by_name(name)

            begin
              save_variable(name_root, variable_set, variable_id)
              config_values[variable] = variable_value
            rescue Sequel::UniqueConstraintViolation
              saved_variable_mapping = variable_set.find_variable_by_name(name_root)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#fetch_values_with_deployment calls 'variable_set.find_variable_by_name(name_root)' 2 times</span>              <span>Locations:</span>                  <a href="client.html#L192" class="js-smell-location">0</a>                  <a href="client.html#L203" class="js-smell-location">1</a>                  </div>  </li></ol>
              config_values[variable] = get_variable_value_by_id(saved_variable_mapping.variable_name, saved_variable_mapping.variable_id)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#fetch_values_with_deployment calls 'saved_variable_mapping.variable_id' 2 times</span>              <span>Locations:</span>                  <a href="client.html#L204" class="js-smell-location">0</a>                  <a href="client.html#L208" class="js-smell-location">1</a>                  </div>  </li></ol>
            end

          else
            config_values[variable] = get_variable_value_by_id(name, saved_variable_mapping.variable_id)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#fetch_values_with_deployment calls 'saved_variable_mapping.variable_id' 2 times</span>              <span>Locations:</span>                  <a href="client.html#L204" class="js-smell-location">0</a>                  <a href="client.html#L208" class="js-smell-location">1</a>                  </div>  </li></ol>
          end
        rescue Bosh::Director::ConfigServerFetchError, Bosh::Director::ConfigServerMissingName =&gt; e<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Uncommunicative-Variable-Name.md" target="_blank"><b>UncommunicativeVariableName</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#fetch_values_with_deployment has the variable name 'e'</span>          </div>  </li></ol>
          errors &lt;&lt; e
        end
      end

      if errors.length &gt; 0<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Identical code found in 3 nodes</span>              <span>Locations:</span>                  <a href="client.html#L215" class="js-smell-location">0</a>                  <a href="client.html#L267" class="js-smell-location">1</a>                  <a href="client.html#L292" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Repeated-Conditional.md" target="_blank"><b>RepeatedConditional</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient tests 'errors.length > 0' at least 3 times</span>              <span>Locations:</span>                  <a href="client.html#L215" class="js-smell-location">0</a>                  <a href="client.html#L267" class="js-smell-location">1</a>                  <a href="client.html#L292" class="js-smell-location">2</a>                  </div>  </li></ol>
        message = errors.map { |error| &quot;- #{error.message}&quot; }.join(&quot;\n&quot;)
        raise Bosh::Director::ConfigServerFetchError, message
      end

      config_values
    end

    def resolve_cross_deployments_variables(variables, consumer_variable_set, provider_variable_set)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#resolve_cross_deployments_variables has a flog score of 56</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#resolve_cross_deployments_variables has approx 24 statements</span>          </div>  </li></ol>
      provider_deployment_name = provider_variable_set.deployment.name

      errors = []
      config_values = {}

      variables.each do |variable|
        raw_variable_name = ConfigServerHelper.add_prefix_if_not_absolute(
          ConfigServerHelper.extract_variable_name(variable),
          @director_name,
          provider_deployment_name
        )

        variable_composed_name = get_name_root(raw_variable_name)
        consumer_variable_model = consumer_variable_set.find_provided_variable_by_name(variable_composed_name, provider_deployment_name)

        begin
          if !consumer_variable_model.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#resolve_cross_deployments_variables performs a nil-check</span>              <span>Locations:</span>                  <a href="client.html#L240" class="js-smell-location">0</a>                  <a href="client.html#L247" class="js-smell-location">1</a>                  </div>  </li></ol>
            variable_id_to_fetch = consumer_variable_model.variable_id
          elsif !consumer_variable_set.writable
            consumer_deployment_name = consumer_variable_set.deployment.name
            raise Bosh::Director::ConfigServerInconsistentVariableState, &quot;Expected variable &#39;#{variable_composed_name}&#39; to be already versioned in deployment &#39;#{consumer_deployment_name}&#39;&quot;
          else
            provider_variable_model = provider_variable_set.find_variable_by_name(variable_composed_name)
            raise Bosh::Director::ConfigServerInconsistentVariableState, &quot;Expected variable &#39;#{variable_composed_name}&#39; to be already versioned in link provider deployment &#39;#{provider_deployment_name}&#39;&quot; if provider_variable_model.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#resolve_cross_deployments_variables performs a nil-check</span>              <span>Locations:</span>                  <a href="client.html#L240" class="js-smell-location">0</a>                  <a href="client.html#L247" class="js-smell-location">1</a>                  </div>  </li></ol>

            variable_id = provider_variable_model.variable_id<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#resolve_cross_deployments_variables calls 'provider_variable_model.variable_id' 2 times</span>              <span>Locations:</span>                  <a href="client.html#L249" class="js-smell-location">0</a>                  <a href="client.html#L258" class="js-smell-location">1</a>                  </div>  </li></ol>
            variable_name = provider_variable_model.variable_name

            begin
              consumer_variable_set.add_variable(variable_name: variable_name, variable_id: variable_id, is_local: false, provider_deployment: provider_deployment_name)
            rescue Sequel::UniqueConstraintViolation
              @logger.debug(&quot;Variable &#39;#{variable_name}&#39; was already added to consumer variable set &#39;#{consumer_variable_set.id}&#39;&quot;)
            end

            variable_id_to_fetch = provider_variable_model.variable_id<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#resolve_cross_deployments_variables calls 'provider_variable_model.variable_id' 2 times</span>              <span>Locations:</span>                  <a href="client.html#L249" class="js-smell-location">0</a>                  <a href="client.html#L258" class="js-smell-location">1</a>                  </div>  </li></ol>
          end

          config_values[variable] = get_variable_value_by_id(raw_variable_name, variable_id_to_fetch)
        rescue Bosh::Director::ConfigServerInconsistentVariableState, Bosh::Director::ConfigServerFetchError, Bosh::Director::ConfigServerMissingName =&gt; e<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Uncommunicative-Variable-Name.md" target="_blank"><b>UncommunicativeVariableName</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#resolve_cross_deployments_variables has the variable name 'e'</span>          </div>  </li></ol>
          errors &lt;&lt; e
        end
      end

      if errors.length &gt; 0<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Identical code found in 3 nodes</span>              <span>Locations:</span>                  <a href="client.html#L215" class="js-smell-location">0</a>                  <a href="client.html#L267" class="js-smell-location">1</a>                  <a href="client.html#L292" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Repeated-Conditional.md" target="_blank"><b>RepeatedConditional</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient tests 'errors.length > 0' at least 3 times</span>              <span>Locations:</span>                  <a href="client.html#L215" class="js-smell-location">0</a>                  <a href="client.html#L267" class="js-smell-location">1</a>                  <a href="client.html#L292" class="js-smell-location">2</a>                  </div>  </li></ol>
        message = errors.map { |error| &quot;- #{error.message}&quot; }.join(&quot;\n&quot;)
        raise Bosh::Director::ConfigServerFetchError, message
      end

      config_values
    end

    def fetch_values_with_latest(variables)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#fetch_values_with_latest has approx 13 statements</span>          </div>  </li></ol>
      ConfigServerHelper.validate_absolute_names(variables)

      errors = []
      config_values = {}

      variables.each do |variable|
        name = ConfigServerHelper.extract_variable_name(variable)

        begin
          variable_id, variable_value = get_variable_id_and_value_by_name(name)
          config_values[variable] = variable_value
        rescue Bosh::Director::ConfigServerFetchError, Bosh::Director::ConfigServerMissingName =&gt; e<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Uncommunicative-Variable-Name.md" target="_blank"><b>UncommunicativeVariableName</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#fetch_values_with_latest has the variable name 'e'</span>          </div>  </li></ol>
          errors &lt;&lt; e<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#fetch_values_with_latest refers to 'errors' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L288" class="js-smell-location">0</a>                  <a href="client.html#L292" class="js-smell-location">1</a>                  <a href="client.html#L293" class="js-smell-location">2</a>                  </div>  </li></ol>
        end
      end

      if errors.length &gt; 0<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Identical code found in 3 nodes</span>              <span>Locations:</span>                  <a href="client.html#L215" class="js-smell-location">0</a>                  <a href="client.html#L267" class="js-smell-location">1</a>                  <a href="client.html#L292" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#fetch_values_with_latest refers to 'errors' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L288" class="js-smell-location">0</a>                  <a href="client.html#L292" class="js-smell-location">1</a>                  <a href="client.html#L293" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Repeated-Conditional.md" target="_blank"><b>RepeatedConditional</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient tests 'errors.length > 0' at least 3 times</span>              <span>Locations:</span>                  <a href="client.html#L215" class="js-smell-location">0</a>                  <a href="client.html#L267" class="js-smell-location">1</a>                  <a href="client.html#L292" class="js-smell-location">2</a>                  </div>  </li></ol>
        message = errors.map { |error| &quot;- #{error.message}&quot; }.join(&quot;\n&quot;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#fetch_values_with_latest refers to 'errors' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L288" class="js-smell-location">0</a>                  <a href="client.html#L292" class="js-smell-location">1</a>                  <a href="client.html#L293" class="js-smell-location">2</a>                  </div>  </li></ol>
        raise Bosh::Director::ConfigServerFetchError, message
      end

      config_values
    end

    def get_variable_value_by_id(name, id)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#get_variable_value_by_id has a flog score of 28</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#get_variable_value_by_id has approx 10 statements</span>          </div>  </li></ol>
      name_root = get_name_root(name)
      response = @config_server_http_client.get_by_id(id)

      begin
        parsed_response = JSON.parse(response.body)
      rescue JSON::ParserError
        raise Bosh::Director::ConfigServerFetchError, &quot;Failed to fetch variable &#39;#{name_root}&#39; with id &#39;#{id}&#39; from config server: Invalid JSON response&quot;
      end

      if response.kind_of? Net::HTTPNotFound
        raise Bosh::Director::ConfigServerMissingName, &quot;Failed to find variable &#39;#{name_root}&#39; with id &#39;#{id}&#39; from config server: HTTP Code &#39;404&#39;, Error: &#39;#{parsed_response[&#39;error&#39;]}&#39;&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#get_variable_value_by_id calls 'parsed_response['error']' 2 times</span>              <span>Locations:</span>                  <a href="client.html#L311" class="js-smell-location">0</a>                  <a href="client.html#L313" class="js-smell-location">1</a>                  </div>  </li></ol>
      elsif !response.kind_of? Net::HTTPOK
        raise Bosh::Director::ConfigServerFetchError, &quot;Failed to fetch variable &#39;#{name_root}&#39; with id &#39;#{id}&#39; from config server: HTTP Code &#39;#{response.code}&#39;, Error: &#39;#{parsed_response[&#39;error&#39;]}&#39;&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="client.html#L313" class="js-smell-location">0</a>                  <a href="client.html#L402" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#get_variable_value_by_id calls 'parsed_response['error']' 2 times</span>              <span>Locations:</span>                  <a href="client.html#L311" class="js-smell-location">0</a>                  <a href="client.html#L313" class="js-smell-location">1</a>                  </div>  </li></ol>
      end

      raise Bosh::Director::ConfigServerFetchError, &quot;Failed to fetch variable &#39;#{name_root}&#39; from config server: Expected response to be a hash, got &#39;#{parsed_response.class}&#39;&quot; unless parsed_response.is_a?(Hash)
      raise Bosh::Director::ConfigServerFetchError, &quot;Failed to fetch variable &#39;#{name_root}&#39; from config server: Expected response to have key &#39;id&#39;&quot; unless parsed_response.has_key?(&#39;id&#39;)
      raise Bosh::Director::ConfigServerFetchError, &quot;Failed to fetch variable &#39;#{name_root}&#39; from config server: Expected response to have key &#39;value&#39;&quot; unless parsed_response.has_key?(&#39;value&#39;)

      extract_variable_value(name, parsed_response[&#39;value&#39;])
    end

    def extract_variable_value(name, raw_value)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#extract_variable_value has approx 9 statements</span>          </div>  </li></ol>
      name_tokens = name.split(&#39;.&#39;)
      name_root = name_tokens.shift<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#extract_variable_value refers to 'name_tokens' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L325" class="js-smell-location">0</a>                  <a href="client.html#L327" class="js-smell-location">1</a>                  <a href="client.html#L328" class="js-smell-location">2</a>                  </div>  </li></ol>

      name_tokens.each_with_index do |token, index|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#extract_variable_value refers to 'name_tokens' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L325" class="js-smell-location">0</a>                  <a href="client.html#L327" class="js-smell-location">1</a>                  <a href="client.html#L328" class="js-smell-location">2</a>                  </div>  </li></ol>
        parent = index &gt; 0 ? ([name_root] + name_tokens[0..(index - 1)]).join(&#39;.&#39;) : name_root<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#extract_variable_value refers to 'name_tokens' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L325" class="js-smell-location">0</a>                  <a href="client.html#L327" class="js-smell-location">1</a>                  <a href="client.html#L328" class="js-smell-location">2</a>                  </div>  </li></ol>
        raise Bosh::Director::ConfigServerFetchError, &quot;Failed to fetch variable &#39;#{name_root}&#39; from config server: Expected parent &#39;#{parent}&#39; to be a hash&quot; unless raw_value.is_a?(Hash)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#extract_variable_value refers to 'raw_value' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L329" class="js-smell-location">0</a>                  <a href="client.html#L330" class="js-smell-location">1</a>                  <a href="client.html#L332" class="js-smell-location">2</a>                  </div>  </li></ol>
        raise Bosh::Director::ConfigServerFetchError, &quot;Failed to fetch variable &#39;#{name_root}&#39; from config server: Expected parent &#39;#{parent}&#39; hash to have key &#39;#{token}&#39;&quot; unless raw_value.has_key?(token)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#extract_variable_value refers to 'raw_value' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L329" class="js-smell-location">0</a>                  <a href="client.html#L330" class="js-smell-location">1</a>                  <a href="client.html#L332" class="js-smell-location">2</a>                  </div>  </li></ol>

        raw_value = raw_value[token]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#extract_variable_value refers to 'raw_value' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="client.html#L329" class="js-smell-location">0</a>                  <a href="client.html#L330" class="js-smell-location">1</a>                  <a href="client.html#L332" class="js-smell-location">2</a>                  </div>  </li></ol>
      end

      raw_value
    end

    def get_variable_id_and_value_by_name(name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#get_variable_id_and_value_by_name has a flog score of 35</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#get_variable_id_and_value_by_name has approx 13 statements</span>          </div>  </li></ol>
      name_root = get_name_root(name)
      response = @config_server_http_client.get(name_root)

      begin
        response_body = JSON.parse(response.body)
      rescue JSON::ParserError
        raise Bosh::Director::ConfigServerFetchError, &quot;Failed to fetch variable &#39;#{name_root}&#39; from config server: Invalid JSON response&quot;
      end

      if response.kind_of? Net::HTTPOK
        response_data = response_body[&#39;data&#39;]

        raise Bosh::Director::ConfigServerFetchError, &quot;Failed to fetch variable &#39;#{name_root}&#39; from config server: Expected data to be an array&quot; unless response_data.is_a?(Array)
        raise Bosh::Director::ConfigServerFetchError, &quot;Failed to fetch variable &#39;#{name_root}&#39; from config server: Expected data to be non empty array&quot; if response_data.empty?

        fetched_variable = response_data[0]
        raise Bosh::Director::ConfigServerFetchError, &quot;Failed to fetch variable &#39;#{name_root}&#39; from config server: Expected data[0] to have key &#39;id&#39;&quot; unless fetched_variable.has_key?(&#39;id&#39;)
        raise Bosh::Director::ConfigServerFetchError, &quot;Failed to fetch variable &#39;#{name_root}&#39; from config server: Expected data[0] to have key &#39;value&#39;&quot; unless fetched_variable.has_key?(&#39;value&#39;)

        return fetched_variable[&#39;id&#39;], extract_variable_value(name, fetched_variable[&#39;value&#39;])
      elsif response.kind_of? Net::HTTPNotFound
        raise Bosh::Director::ConfigServerMissingName, &quot;Failed to find variable &#39;#{name_root}&#39; from config server: HTTP Code &#39;404&#39;, Error: &#39;#{response_body[&#39;error&#39;]}&#39;&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#get_variable_id_and_value_by_name calls 'response_body['error']' 2 times</span>              <span>Locations:</span>                  <a href="client.html#L360" class="js-smell-location">0</a>                  <a href="client.html#L362" class="js-smell-location">1</a>                  </div>  </li></ol>
      else
        raise Bosh::Director::ConfigServerFetchError, &quot;Failed to fetch variable &#39;#{name_root}&#39; from config server: HTTP Code &#39;#{response.code}&#39;, Error: &#39;#{response_body[&#39;error&#39;]}&#39;&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#get_variable_id_and_value_by_name calls 'response_body['error']' 2 times</span>              <span>Locations:</span>                  <a href="client.html#L360" class="js-smell-location">0</a>                  <a href="client.html#L362" class="js-smell-location">1</a>                  </div>  </li></ol>
      end
    end

    def name_exists?(name)
      get_variable_id_and_value_by_name(name)
      true
    rescue Bosh::Director::ConfigServerMissingName
      false
    end

    def save_variable(name_root, variable_set, variable_id)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#save_variable doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
      variable_set.add_variable(variable_name: name_root, variable_id: variable_id)
    end

    def generate_value(name, type, variable_set, options, converge_variable)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_value has a flog score of 33</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_value has 5 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_value has approx 15 statements</span>          </div>  </li></ol>
      parameters = options.nil? ? {} : options<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_value performs a nil-check</span>          </div>  </li></ol>

      request_body = {
        &#39;name&#39; =&gt; name,
        &#39;type&#39; =&gt; type,
        &#39;parameters&#39; =&gt; parameters
      }

      request_body[&#39;mode&#39;] = &#39;converge&#39; if converge_variable<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Control-Parameter.md" target="_blank"><b>ControlParameter</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_value is controlled by argument 'converge_variable'</span>          </div>  </li></ol>

      unless variable_set.writable
        raise Bosh::Director::ConfigServerGenerationError, &quot;Variable &#39;#{get_name_root(name)}&#39; cannot be generated. Variable generation allowed only during deploy action&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_value calls 'get_name_root(name)' 4 times</span>              <span>Locations:</span>                  <a href="client.html#L389" class="js-smell-location">0</a>                  <a href="client.html#L397" class="js-smell-location">1</a>                  <a href="client.html#L410" class="js-smell-location">2</a>                  <a href="client.html#L412" class="js-smell-location">3</a>                  </div>  </li></ol>
      end

      response = @config_server_http_client.post(request_body)

      begin
        parsed_response_body = JSON.parse(response.body)
      rescue JSON::ParserError
        raise Bosh::Director::ConfigServerGenerationError, &quot;Config Server returned a NON-JSON body while generating value for &#39;#{get_name_root(name)}&#39; with type &#39;#{type}&#39;&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_value calls 'get_name_root(name)' 4 times</span>              <span>Locations:</span>                  <a href="client.html#L389" class="js-smell-location">0</a>                  <a href="client.html#L397" class="js-smell-location">1</a>                  <a href="client.html#L410" class="js-smell-location">2</a>                  <a href="client.html#L412" class="js-smell-location">3</a>                  </div>  </li></ol>
      end

      unless response.kind_of? Net::HTTPSuccess
        @logger.error(&quot;Config server error while generating value for &#39;#{name}&#39;: #{response.code}  #{parsed_response_body[&#39;error&#39;]}. Request body sent: #{request_body}&quot;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_value calls 'parsed_response_body['error']' 2 times</span>              <span>Locations:</span>                  <a href="client.html#L401" class="js-smell-location">0</a>                  <a href="client.html#L402" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_value calls 'response.code' 2 times</span>              <span>Locations:</span>                  <a href="client.html#L401" class="js-smell-location">0</a>                  <a href="client.html#L402" class="js-smell-location">1</a>                  </div>  </li></ol>
        raise Bosh::Director::ConfigServerGenerationError, &quot;Config Server failed to generate value for &#39;#{name}&#39; with type &#39;#{type}&#39;. HTTP Code &#39;#{response.code}&#39;, Error: &#39;#{parsed_response_body[&#39;error&#39;]}&#39;&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="client.html#L313" class="js-smell-location">0</a>                  <a href="client.html#L402" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_value calls 'parsed_response_body['error']' 2 times</span>              <span>Locations:</span>                  <a href="client.html#L401" class="js-smell-location">0</a>                  <a href="client.html#L402" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_value calls 'response.code' 2 times</span>              <span>Locations:</span>                  <a href="client.html#L401" class="js-smell-location">0</a>                  <a href="client.html#L402" class="js-smell-location">1</a>                  </div>  </li></ol>
      end

      generated_variable = parsed_response_body

      raise Bosh::Director::ConfigServerGenerationError, &quot;Failed to version generated variable &#39;#{name}&#39;. Expected Config Server response to have key &#39;id&#39;&quot; unless generated_variable.has_key?(&#39;id&#39;)

      begin
        save_variable(get_name_root(name), variable_set, generated_variable[&#39;id&#39;])<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_value calls 'get_name_root(name)' 4 times</span>              <span>Locations:</span>                  <a href="client.html#L389" class="js-smell-location">0</a>                  <a href="client.html#L397" class="js-smell-location">1</a>                  <a href="client.html#L410" class="js-smell-location">2</a>                  <a href="client.html#L412" class="js-smell-location">3</a>                  </div>  </li></ol>
      rescue Sequel::UniqueConstraintViolation
        @logger.debug(&quot;variable &#39;#{get_name_root(name)}&#39; was already added to set &#39;#{variable_set.id}&#39;&quot;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_value calls 'get_name_root(name)' 4 times</span>              <span>Locations:</span>                  <a href="client.html#L389" class="js-smell-location">0</a>                  <a href="client.html#L397" class="js-smell-location">1</a>                  <a href="client.html#L410" class="js-smell-location">2</a>                  <a href="client.html#L412" class="js-smell-location">3</a>                  </div>  </li></ol>
      end

      generated_variable
    end

    def generate_certificate(name, deployment_name, variable_set, options)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_certificate has 4 parameters</span>          </div>  </li></ol>
      dns_record_names = options[:dns_record_names]

      certificate_options = {
        &#39;common_name&#39; =&gt; dns_record_names.first,
        &#39;alternative_names&#39; =&gt; dns_record_names
      }

      generate_value_and_record_event(name, &#39;certificate&#39;, deployment_name, variable_set, certificate_options)
    end

    def get_name_root(variable_name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#get_name_root doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
      name_tokens = variable_name.split(&#39;.&#39;)
      name_tokens[0]
    end

    def add_event(options)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#add_event doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
      Bosh::Director::Config.current_job.event_manager.create_event(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#add_event calls 'Bosh::Director::Config.current_job' 3 times</span>              <span>Locations:</span>                  <a href="client.html#L435" class="js-smell-location">0</a>                  <a href="client.html#L437" class="js-smell-location">1</a>                  <a href="client.html#L439" class="js-smell-location">2</a>                  </div>  </li></ol>
        {
          user: Bosh::Director::Config.current_job.username,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#add_event calls 'Bosh::Director::Config.current_job' 3 times</span>              <span>Locations:</span>                  <a href="client.html#L435" class="js-smell-location">0</a>                  <a href="client.html#L437" class="js-smell-location">1</a>                  <a href="client.html#L439" class="js-smell-location">2</a>                  </div>  </li></ol>
          object_type: &#39;variable&#39;,
          task: Bosh::Director::Config.current_job.task_id,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#add_event calls 'Bosh::Director::Config.current_job' 3 times</span>              <span>Locations:</span>                  <a href="client.html#L435" class="js-smell-location">0</a>                  <a href="client.html#L437" class="js-smell-location">1</a>                  <a href="client.html#L439" class="js-smell-location">2</a>                  </div>  </li></ol>
          action: options.fetch(:action),
          object_name: options.fetch(:object_name),
          deployment: options.fetch(:deployment_name),
          context: options.fetch(:context, {}),
          error: options.fetch(:error, nil)
        })
    end

    def generate_value_and_record_event(variable_name, variable_type, deployment_name, variable_set, options, converge_variable)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_value_and_record_event has 6 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_value_and_record_event has approx 6 statements</span>          </div>  </li></ol>
      begin
        result = generate_value(variable_name, variable_type, variable_set, options, converge_variable)
        add_event(
          :action =&gt; &#39;create&#39;,
          :deployment_name =&gt; deployment_name,
          :object_name =&gt; variable_name,
          :context =&gt; {&#39;name&#39; =&gt; result[&#39;name&#39;], &#39;id&#39; =&gt; result[&#39;id&#39;]}
        )
        result
      rescue Exception =&gt; e<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Uncommunicative-Variable-Name.md" target="_blank"><b>UncommunicativeVariableName</b></a>        </span>      </div>      <span>Bosh::Director::ConfigServer::ConfigServerClient#generate_value_and_record_event has the variable name 'e'</span>          </div>  </li></ol>
        add_event(
          :action =&gt; &#39;create&#39;,
          :deployment_name =&gt; deployment_name,
          :object_name =&gt; variable_name,
          :error =&gt; e
        )
        raise e
      end
    end
  end
end
</code>
  </div>
</div>

        </div>
      </div>
    </div>

    <!-- Javascripts -->
    <script src='../../../assets/javascripts/jquery.min.js'></script>
    <script src='../../../assets/javascripts/jquery.tablesorter.min.js'></script>
    <script src='../../../assets/javascripts/jquery.scrollTo.min.js'></script>
    <script src='../../../assets/javascripts/jquery.timeago.js'></script>
    <script src='../../../assets/javascripts/highcharts.src-4.0.1.js'></script>
    <script src='../../../assets/javascripts/prettify.js'></script>
    <script src='../../../assets/javascripts/bootstrap.min.js'></script>
    <script src='../../../assets/javascripts/application.js'></script>
    <script src='../../../assets/javascripts/jquery.filtertable.min.js'></script>
  </body>
</html>
