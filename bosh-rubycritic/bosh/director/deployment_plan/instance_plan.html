<!DOCTYPE html>
<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ruby Critic - Home</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- StyleSheets -->
    <link href="../../../assets/stylesheets/bootstrap.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../assets/stylesheets/font-awesome.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../assets/stylesheets/prettify.custom_theme.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../assets/stylesheets/application.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  </head>

  <body>
    <header class="navbar navbar-default navbar-fixed-top">
      <a href="#menu-toggle" class="btn btn-default hidden-lg visible-sm-* hidden-md visible-xs-* pull-left" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a>
      <a href="../../../overview.html"><img src="../../../assets/images/logo.png" title="Ruby Critic Logo" width="55"><span class="logo">RUBYCRITIC</span></a>
    </header>
    <div id="wrapper">
      <!-- Sidebar -->
      <aside id="sidebar-wrapper">
        <ul class="sidebar-nav">
          <li class="sidebar-item">
            <a href="../../../overview.html" class="project-nav-item overview-nav"><i class="fa fa-dashboard"></i>Overview</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../code_index.html" class="project-nav-item code-index-nav"><i class="fa fa-code"></i>Code</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../smells_index.html" class="project-nav-item smells-index-nav"><i class="fa fa-warning"></i>Smells</a>
          </li>
        </ul>
      </aside>
      <!-- /#sidebar-wrapper -->
      <div id="page-content-wrapper">
        <div class="container-fluid">
          <div class="row">
  <!--Page Title -->
  <div class="Page_Title">
    <div class="file-time">
      <span class="committed-at">
        
          Updated <time class='js-timeago' datetime='2018-05-17 08:12:19 -0700'>2018-05-17 08:12:19 -0700</time>
        
      </span>
    </div>
    <div>
      <h3><small>bosh/director/deployment_plan /</small> instance_plan.rb</h3>
    </div>
  </div>
  <!--End Page Title -->
  <div class="Content_Wrapper">
    <!-- code detail -->
    <div class="code-top-detail clearfix row">
      <div class="col-md-8">
        <div class="row">
          <div class="col-md-1">
            <div class="rating f big">
              F
            </div>
          </div>
          <div class="code-statistics col-md-11">
            <div class="col-md-3">
              <div><span class="metric">454</span><small> lines of codes</small></div>
              <div><span class="metric">48</span><small> methods</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">11.1</span><small> complexity/method</small></div>
              <div><span class="metric">150</span><small> churn</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">530.95</span><small> complexity</small></div>
              <div><span class="metric">46</span><small> duplications</small></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="code-tabs">
          <ul class="nav nav-pills right-to-left">
            <li><a href="#" id="toggle-code" class="toggle-button button">code</a></li>
            <li class="active">
              <a href="#" id="toggle-smells" class="toggle-button button">
                71
                smells
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <code class="prettyprint linenums lang-ruby file-code js-file-code">require &#39;common/deep_copy&#39;

module Bosh
  module Director
    module DeploymentPlan
      class InstancePlan<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Instance-Variable-Assumption.md" target="_blank"><b>InstanceVariableAssumption</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan assumes too much for instance variable '@changes'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Irresponsible-Module.md" target="_blank"><b>IrresponsibleModule</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan has no descriptive comment</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Instance-Variables.md" target="_blank"><b>TooManyInstanceVariables</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan has at least 13 instance variables</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Methods.md" target="_blank"><b>TooManyMethods</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan has at least 44 methods</span>          </div>  </li></ol>
        # existing_instance: Model::Instance
        # desired_instance: DeploymentPlan::DesiredInstance
        # instance: DeploymentPlan::Instance
        def initialize(existing_instance:,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Boolean-Parameter.md" target="_blank"><b>BooleanParameter</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#initialize has boolean parameter 'recreate_deployment'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Boolean-Parameter.md" target="_blank"><b>BooleanParameter</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#initialize has boolean parameter 'skip_drain'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Boolean-Parameter.md" target="_blank"><b>BooleanParameter</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#initialize has boolean parameter 'use_dns_addresses'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Boolean-Parameter.md" target="_blank"><b>BooleanParameter</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#initialize has boolean parameter 'use_short_dns_addresses'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#initialize has 10 parameters</span>          </div>  </li></ol>
                       desired_instance:,
                       instance:,
                       network_plans: [],
                       skip_drain: false,
                       recreate_deployment: false,
                       use_dns_addresses: false,
                       use_short_dns_addresses: false,
                       logger: Config.logger,
                       tags: {})
          @existing_instance = existing_instance
          @desired_instance = desired_instance
          @instance = instance
          @network_plans = network_plans
          @skip_drain = skip_drain
          @recreate_deployment = recreate_deployment
          @use_dns_addresses = use_dns_addresses
          @use_short_dns_addresses = use_short_dns_addresses
          @logger = logger
          @tags = tags
          @powerdns_manager = PowerDnsManagerProvider.create
          @config_server_client = Bosh::Director::ConfigServer::ClientFactory.create(@logger).create_client
        end

        attr_reader :desired_instance, :existing_instance, :instance, :skip_drain, :recreate_deployment, :tags

        attr_accessor :network_plans<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Attribute.md" target="_blank"><b>Attribute</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#network_plans is a writable attribute</span>          </div>  </li></ol>

        # An instance of Bosh::Director::Core::Templates::RenderedJobInstance
        attr_accessor :rendered_templates<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Attribute.md" target="_blank"><b>Attribute</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#rendered_templates is a writable attribute</span>          </div>  </li></ol>

        ##
        # @return [Boolean] returns true if the any of the expected specifications
        #   differ from the ones provided by the VM
        def changed?
          !changes.empty?
        end

        def should_create_swap_delete?
          @desired_instance.instance_group&amp;.should_create_swap_delete?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#should_create_swap_delete? performs a nil-check</span>          </div>  </li></ol>
        end

        def unresponsive_agent?
          return false if @instance.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#unresponsive_agent? performs a nil-check</span>          </div>  </li></ol>
          @instance.current_job_state == &#39;unresponsive&#39;
        end

        ##
        # @return [Set&lt;Symbol&gt;] returns a set of all of the specification differences
        def changes<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#changes has a flog score of 41</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#changes has approx 17 statements</span>          </div>  </li></ol>
          return @changes if @changes

          @changes = Set.new
          @changes &lt;&lt; :dirty if @instance.dirty?
          @changes &lt;&lt; :restart if restart_requested?
          @changes &lt;&lt; :recreate if recreation_requested?
          @changes &lt;&lt; :cloud_properties if instance.cloud_properties_changed?
          @changes &lt;&lt; :stemcell if stemcell_changed?
          @changes &lt;&lt; :env if env_changed?
          @changes &lt;&lt; :network if networks_changed? || network_settings_changed?
          @changes &lt;&lt; :packages if packages_changed?
          @changes &lt;&lt; :persistent_disk if persistent_disk_changed?
          @changes &lt;&lt; :configuration if configuration_changed?
          @changes &lt;&lt; :job if job_changed?
          @changes &lt;&lt; :state if state_changed?
          @changes &lt;&lt; :dns if dns_changed?
          @changes &lt;&lt; :trusted_certs if instance.trusted_certs_changed?
          @changes
        end

        def persistent_disk_changed?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#persistent_disk_changed? has a flog score of 26</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#persistent_disk_changed? has approx 7 statements</span>          </div>  </li></ol>
          return @existing_instance.active_persistent_disks.any? if @existing_instance &amp;&amp; obsolete?

          existing_disk_collection = instance_model.active_persistent_disks
          desired_disks_collection = @desired_instance.instance_group.persistent_disk_collection

          changed_disk_pairs = PersistentDiskCollection.changed_disk_pairs(
            existing_disk_collection,
            instance.previous_variable_set,
            desired_disks_collection,
            instance.desired_variable_set,
          )

          changed_disk_pairs.each do |disk_pair|
            log_changes(__method__, disk_pair[:old], disk_pair[:new], instance)
          end
          !changed_disk_pairs.empty?
        end

        def instance_model
          new? ? instance.model : existing_instance<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Repeated-Conditional.md" target="_blank"><b>RepeatedConditional</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan tests 'new?' at least 3 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L100" class="js-smell-location">0</a>                  <a href="instance_plan.html#L147" class="js-smell-location">1</a>                  <a href="instance_plan.html#L361" class="js-smell-location">2</a>                  </div>  </li></ol>
        end

        def should_be_ignored?
          !instance_model.nil? &amp;&amp; instance_model.ignore<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#should_be_ignored? performs a nil-check</span>          </div>  </li></ol>
        end

        def restart_requested?
          @instance.virtual_state == &#39;restart&#39;
        end

        def recreation_requested?
          if @recreate_deployment
            @logger.debug(&quot;#{__method__} job deployment is configured with \&quot;recreate\&quot; state&quot;)
            true
          elsif unresponsive_agent?
            @logger.debug(&quot;#{__method__} instance should be recreated because of unresponsive agent&quot;)
            true
          else
            @instance.virtual_state == &#39;recreate&#39;
          end
        end

        def networks_changed?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#networks_changed? has a flog score of 44</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#networks_changed? has approx 8 statements</span>          </div>  </li></ol>
          desired_network_plans = network_plans.select(&amp;:desired?)
          obsolete_network_plans = network_plans.select(&amp;:obsolete?)

          changed = false
          if obsolete_network_plans.any?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="instance_plan.html#L128" class="js-smell-location">0</a>                  <a href="instance_plan.html#L135" class="js-smell-location">1</a>                  </div>  </li></ol>
            @logger.debug(
              &quot;#{__method__} obsolete reservations: [#{obsolete_network_plans.map(&amp;:reservation).map(&amp;:to_s).join(&#39;, &#39;)}]&quot;,
            )
            changed = true
          end

          if desired_network_plans.any?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="instance_plan.html#L128" class="js-smell-location">0</a>                  <a href="instance_plan.html#L135" class="js-smell-location">1</a>                  </div>  </li></ol>
            @logger.debug(
              &quot;#{__method__} desired reservations: [#{desired_network_plans.map(&amp;:reservation).map(&amp;:to_s).join(&#39;, &#39;)}]&quot;,
            )
            changed = true
          end

          changed
        end

        def network_settings_changed?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#network_settings_changed? has approx 9 statements</span>          </div>  </li></ol>
          changed = false
          old_network_settings = new? ? {} : @existing_instance.spec_p(&#39;networks&#39;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Repeated-Conditional.md" target="_blank"><b>RepeatedConditional</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan tests 'new?' at least 3 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L100" class="js-smell-location">0</a>                  <a href="instance_plan.html#L147" class="js-smell-location">1</a>                  <a href="instance_plan.html#L361" class="js-smell-location">2</a>                  </div>  </li></ol>
          new_network_settings = network_settings_hash

          interpolated_old_network_settings = @config_server_client.interpolate_with_versioning(
            old_network_settings,
            @instance.previous_variable_set,
          )
          interpolated_new_network_settings = @config_server_client.interpolate_with_versioning(
            new_network_settings,
            @instance.desired_variable_set,
          )

          if interpolated_old_network_settings != {} &amp;&amp;
             remove_dns_record_name_from_network_settings(interpolated_old_network_settings) != interpolated_new_network_settings
            @logger.debug(
              &quot;#{__method__} network settings changed FROM: #{old_network_settings} &quot; \
              &quot;TO: #{new_network_settings} on instance #{@existing_instance}&quot;,
            )
            changed = true
          end

          changed
        end

        def state_changed?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#state_changed? has a flog score of 42</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#state_changed? has approx 6 statements</span>          </div>  </li></ol>
          if instance.state == &#39;detached&#39; &amp;&amp;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#state_changed? calls 'instance.state' 5 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L172" class="js-smell-location">0</a>                  <a href="instance_plan.html#L173" class="js-smell-location">1</a>                  <a href="instance_plan.html#L180" class="js-smell-location">2</a>                  <a href="instance_plan.html#L181" class="js-smell-location">3</a>                  <a href="instance_plan.html#L182" class="js-smell-location">4</a>                  </div>  </li></ol>
             existing_instance.state != instance.state<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#state_changed? calls 'instance.state' 5 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L172" class="js-smell-location">0</a>                  <a href="instance_plan.html#L173" class="js-smell-location">1</a>                  <a href="instance_plan.html#L180" class="js-smell-location">2</a>                  <a href="instance_plan.html#L181" class="js-smell-location">3</a>                  <a href="instance_plan.html#L182" class="js-smell-location">4</a>                  </div>  </li></ol>
            @logger.debug(&quot;Instance &#39;#{instance}&#39; needs to be detached&quot;)
            return true
          end

          return true if unresponsive_agent?

          if instance.state == &#39;stopped&#39; &amp;&amp; instance.current_job_state == &#39;running&#39; ||<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#state_changed? calls 'instance.current_job_state' 3 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L180" class="js-smell-location">0</a>                  <a href="instance_plan.html#L181" class="js-smell-location">1</a>                  <a href="instance_plan.html#L182" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#state_changed? calls 'instance.state' 5 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L172" class="js-smell-location">0</a>                  <a href="instance_plan.html#L173" class="js-smell-location">1</a>                  <a href="instance_plan.html#L180" class="js-smell-location">2</a>                  <a href="instance_plan.html#L181" class="js-smell-location">3</a>                  <a href="instance_plan.html#L182" class="js-smell-location">4</a>                  </div>  </li></ol>
             instance.state == &#39;started&#39; &amp;&amp; instance.current_job_state != &#39;running&#39;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#state_changed? calls 'instance.current_job_state' 3 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L180" class="js-smell-location">0</a>                  <a href="instance_plan.html#L181" class="js-smell-location">1</a>                  <a href="instance_plan.html#L182" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#state_changed? calls 'instance.state' 5 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L172" class="js-smell-location">0</a>                  <a href="instance_plan.html#L173" class="js-smell-location">1</a>                  <a href="instance_plan.html#L180" class="js-smell-location">2</a>                  <a href="instance_plan.html#L181" class="js-smell-location">3</a>                  <a href="instance_plan.html#L182" class="js-smell-location">4</a>                  </div>  </li></ol>
            @logger.debug(&quot;Instance state is &#39;#{instance.state}&#39; and agent reports &#39;#{instance.current_job_state}&#39;&quot;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#state_changed? calls 'instance.current_job_state' 3 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L180" class="js-smell-location">0</a>                  <a href="instance_plan.html#L181" class="js-smell-location">1</a>                  <a href="instance_plan.html#L182" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#state_changed? calls 'instance.state' 5 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L172" class="js-smell-location">0</a>                  <a href="instance_plan.html#L173" class="js-smell-location">1</a>                  <a href="instance_plan.html#L180" class="js-smell-location">2</a>                  <a href="instance_plan.html#L181" class="js-smell-location">3</a>                  <a href="instance_plan.html#L182" class="js-smell-location">4</a>                  </div>  </li></ol>
            return true
          end

          false
        end

        def dns_changed?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#dns_changed? has a flog score of 32</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#dns_changed? has approx 8 statements</span>          </div>  </li></ol>
          power_dns_changed = false

          if @powerdns_manager.dns_enabled?
            power_dns_changed = network_settings.dns_record_info.any? do |name, ip|
              not_found = @powerdns_manager.find_dns_record(name, ip).nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#dns_changed? performs a nil-check</span>          </div>  </li></ol>

              if not_found
                @logger.debug(
                  &quot;#{__method__} The requested dns record with name &#39;#{name}&#39; &quot; \
                  &quot;and ip &#39;#{ip}&#39; was not found in the db.&quot;,
                )
              end

              not_found
            end
          end

          diff = LocalDnsRepo.new(@logger, Config.root_domain).diff(instance_model)
          if diff.changes?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#dns_changed? calls 'diff.changes?' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L208" class="js-smell-location">0</a>                  <a href="instance_plan.html#L211" class="js-smell-location">1</a>                  </div>  </li></ol>
            log_changes(:local_dns_changed?, diff.obsolete + diff.unaffected, diff.unaffected + diff.missing, instance)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#dns_changed? calls 'diff.unaffected' 2 times</span>          </div>  </li></ol>
          end
          power_dns_changed || diff.changes?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#dns_changed? calls 'diff.changes?' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L208" class="js-smell-location">0</a>                  <a href="instance_plan.html#L211" class="js-smell-location">1</a>                  </div>  </li></ol>
        end

        def configuration_changed?
          changed = instance.configuration_hash != instance_model.spec_p(&#39;configuration_hash&#39;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#configuration_changed? calls 'instance.configuration_hash' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L215" class="js-smell-location">0</a>                  <a href="instance_plan.html#L216" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#configuration_changed? calls 'instance_model.spec_p('configuration_hash')' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L215" class="js-smell-location">0</a>                  <a href="instance_plan.html#L216" class="js-smell-location">1</a>                  </div>  </li></ol>
          log_changes(__method__, instance_model.spec_p(&#39;configuration_hash&#39;), instance.configuration_hash, instance) if changed<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#configuration_changed? calls 'instance.configuration_hash' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L215" class="js-smell-location">0</a>                  <a href="instance_plan.html#L216" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#configuration_changed? calls 'instance_model.spec_p('configuration_hash')' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L215" class="js-smell-location">0</a>                  <a href="instance_plan.html#L216" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Repeated-Conditional.md" target="_blank"><b>RepeatedConditional</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan tests 'changed' at least 3 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L216" class="js-smell-location">0</a>                  <a href="instance_plan.html#L348" class="js-smell-location">1</a>                  <a href="instance_plan.html#L356" class="js-smell-location">2</a>                  </div>  </li></ol>
          changed
        end

        def remove_obsolete_network_plans_for_ips(ips)
          network_plans.delete_if { |plan| ips.include?(plan.reservation.ip.to_s) }
        end

        def release_obsolete_network_plans(ip_provider)
          network_plans.select(&amp;:obsolete?).each do |network_plan|
            reservation = network_plan.reservation
            ip_provider.release(reservation)
          end
          network_plans.delete_if(&amp;:obsolete?)
        end

        def release_all_network_plans
          network_plans.clear
        end

        def obsolete?
          desired_instance.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#obsolete? performs a nil-check</span>          </div>  </li></ol>
        end

        def new?
          existing_instance.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#new? performs a nil-check</span>          </div>  </li></ol>
        end

        def existing?
          !new? &amp;&amp; !obsolete?
        end

        def network_settings<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#network_settings has a flog score of 26</span>          </div>  </li></ol>
          desired_reservations = network_plans
                                 .reject(&amp;:obsolete?)
                                 .map(&amp;:reservation)

          DeploymentPlan::NetworkSettings.new(
            @instance.instance_group_name,
            @instance.model.deployment.name,
            @desired_instance.instance_group.default_network,
            desired_reservations,
            @instance.current_networks,
            @instance.availability_zone,
            @instance.index,
            @instance.uuid,
            root_domain,
            @use_short_dns_addresses,
          )
        end

        def network_settings_hash
          network_settings.to_hash
        end

        def network_address
          network_settings.network_address(@use_dns_addresses)
        end

        # @param [Boolean] prefer_dns_entry Flag for using DNS entry when available.
        # @return [Hash] A hash mapping network names to their associated address
        def network_addresses(prefer_dns_entry)
          network_settings.network_addresses(prefer_dns_entry)
        end

        def root_domain
          @powerdns_manager.root_domain
        end

        def needs_shutting_down?
          obsolete? || recreate_for_non_network_reasons? || networks_changed? || network_settings_changed?
        end

        def vm_matches_plan?(vm)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#vm_matches_plan? has a flog score of 32</span>          </div>  </li></ol>
          desired_instance_group = @desired_instance.instance_group
          desired_cloud_properties = @config_server_client.interpolate_with_versioning(
            @instance.cloud_properties,
            @instance.desired_variable_set,
          )
          vm_cloud_properties = @config_server_client.interpolate_with_versioning(
            JSON.parse(vm.cloud_properties_json),
            @instance.previous_variable_set,
          )

          vm.stemcell_name == @instance.stemcell.name &amp;&amp;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#vm_matches_plan? calls '@instance.stemcell' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L300" class="js-smell-location">0</a>                  <a href="instance_plan.html#L301" class="js-smell-location">1</a>                  </div>  </li></ol>
            vm.stemcell_version == @instance.stemcell.version &amp;&amp;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#vm_matches_plan? calls '@instance.stemcell' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L300" class="js-smell-location">0</a>                  <a href="instance_plan.html#L301" class="js-smell-location">1</a>                  </div>  </li></ol>
            JSON.parse(vm.env_json || &#39;{}&#39;) == desired_instance_group.env.spec &amp;&amp;
            vm_cloud_properties == desired_cloud_properties
        end

        def needs_duplicate_vm?
          obsolete? || recreate_for_non_network_reasons? || networks_changed?
        end

        def recreate_for_non_network_reasons?
          instance.cloud_properties_changed? ||
            stemcell_changed? ||
            env_changed? ||
            recreation_requested?
        end

        def find_existing_reservation_for_network(network)
          @instance.existing_network_reservations.find_for_network(network)
        end

        def desired_az_name
          @desired_instance.az ? @desired_instance.az.name : nil<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#desired_az_name calls '@desired_instance.az' 2 times</span>          </div>  </li></ol>
        end

        def network_plan_for_network(network)
          @network_plans.find { |plan| plan.reservation.network == network }
        end

        def spec
          return InstanceSpec.create_empty if obsolete?

          InstanceSpec.create_from_instance_plan(self)
        end

        def templates
          @desired_instance.instance_group.jobs
        end

        def job_changed?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#job_changed? has approx 6 statements</span>          </div>  </li></ol>
          job = @desired_instance.instance_group
          return true if @instance.current_job_spec.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#job_changed? calls '@instance.current_job_spec' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L341" class="js-smell-location">0</a>                  <a href="instance_plan.html#L346" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#job_changed? performs a nil-check</span>          </div>  </li></ol>

          # The agent job spec could be in legacy form.  job_spec cannot be,
          # though, because we got it from the spec function in job.rb which
          # automatically makes it non-legacy.
          converted_current = InstanceGroup.convert_from_legacy_spec(@instance.current_job_spec)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#job_changed? calls '@instance.current_job_spec' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L341" class="js-smell-location">0</a>                  <a href="instance_plan.html#L346" class="js-smell-location">1</a>                  </div>  </li></ol>
          changed = job.spec != converted_current<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#job_changed? calls 'job.spec' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L347" class="js-smell-location">0</a>                  <a href="instance_plan.html#L348" class="js-smell-location">1</a>                  </div>  </li></ol>
          log_changes(__method__, converted_current, job.spec, @instance) if changed<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#job_changed? calls 'job.spec' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L347" class="js-smell-location">0</a>                  <a href="instance_plan.html#L348" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Repeated-Conditional.md" target="_blank"><b>RepeatedConditional</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan tests 'changed' at least 3 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L216" class="js-smell-location">0</a>                  <a href="instance_plan.html#L348" class="js-smell-location">1</a>                  <a href="instance_plan.html#L356" class="js-smell-location">2</a>                  </div>  </li></ol>
          changed
        end

        def packages_changed?
          instance_group = @desired_instance.instance_group

          changed = instance_group.package_spec != @instance.current_packages<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#packages_changed? calls '@instance.current_packages' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L355" class="js-smell-location">0</a>                  <a href="instance_plan.html#L356" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#packages_changed? calls 'instance_group.package_spec' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L355" class="js-smell-location">0</a>                  <a href="instance_plan.html#L356" class="js-smell-location">1</a>                  </div>  </li></ol>
          log_changes(__method__, @instance.current_packages, instance_group.package_spec, @instance) if changed<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#packages_changed? calls '@instance.current_packages' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L355" class="js-smell-location">0</a>                  <a href="instance_plan.html#L356" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#packages_changed? calls 'instance_group.package_spec' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L355" class="js-smell-location">0</a>                  <a href="instance_plan.html#L356" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Repeated-Conditional.md" target="_blank"><b>RepeatedConditional</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan tests 'changed' at least 3 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L216" class="js-smell-location">0</a>                  <a href="instance_plan.html#L348" class="js-smell-location">1</a>                  <a href="instance_plan.html#L356" class="js-smell-location">2</a>                  </div>  </li></ol>
          changed
        end

        def already_detached?
          return false if new?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Repeated-Conditional.md" target="_blank"><b>RepeatedConditional</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan tests 'new?' at least 3 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L100" class="js-smell-location">0</a>                  <a href="instance_plan.html#L147" class="js-smell-location">1</a>                  <a href="instance_plan.html#L361" class="js-smell-location">2</a>                  </div>  </li></ol>

          @existing_instance.state == &#39;detached&#39;
        end

        def needs_disk?
          instance_group = @desired_instance.instance_group

          instance_group.persistent_disk_collection.needs_disk?
        end

        def persist_current_spec
          instance_model.update(spec: spec.full_spec)
        end

        private

        def remove_dns_record_name_from_network_settings(network_settings)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#remove_dns_record_name_from_network_settings has approx 6 statements</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#remove_dns_record_name_from_network_settings doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
          return network_settings if network_settings.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#remove_dns_record_name_from_network_settings performs a nil-check</span>          </div>  </li></ol>

          modified_network_settings = Bosh::Common::DeepCopy.copy(network_settings)

          modified_network_settings.each do |_name, network_setting|
            network_setting.delete_if { |key, _value| key == &#39;dns_record_name&#39; }<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#remove_dns_record_name_from_network_settings contains iterators nested 2 deep</span>          </div>  </li></ol>
          end
          modified_network_settings
        end

        def env_changed?
          instance_group = @desired_instance.instance_group

          if @existing_instance&amp;.vm_env &amp;&amp; instance_group.env.spec != @existing_instance.vm_env<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#env_changed? calls '@existing_instance.vm_env' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L392" class="js-smell-location">0</a>                  <a href="instance_plan.html#L393" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#env_changed? calls 'instance_group.env' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L392" class="js-smell-location">0</a>                  <a href="instance_plan.html#L393" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#env_changed? calls 'instance_group.env.spec' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L392" class="js-smell-location">0</a>                  <a href="instance_plan.html#L393" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#env_changed? performs a nil-check</span>          </div>  </li></ol>
            log_changes(__method__, @existing_instance.vm_env, instance_group.env.spec, @existing_instance)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#env_changed? calls '@existing_instance.vm_env' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L392" class="js-smell-location">0</a>                  <a href="instance_plan.html#L393" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#env_changed? calls 'instance_group.env' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L392" class="js-smell-location">0</a>                  <a href="instance_plan.html#L393" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#env_changed? calls 'instance_group.env.spec' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L392" class="js-smell-location">0</a>                  <a href="instance_plan.html#L393" class="js-smell-location">1</a>                  </div>  </li></ol>
            return true
          end
          false
        end

        def stemcell_changed?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#stemcell_changed? has a flog score of 27</span>          </div>  </li></ol>
          if @existing_instance&amp;.spec_p(&#39;stemcell.name&#39;) &amp;&amp;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#stemcell_changed? performs a nil-check</span>              <span>Locations:</span>                  <a href="instance_plan.html#L400" class="js-smell-location">0</a>                  <a href="instance_plan.html#L406" class="js-smell-location">1</a>                  </div>  </li></ol>
             @instance.stemcell.name != @existing_instance.spec_p(&#39;stemcell.name&#39;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#stemcell_changed? calls '@existing_instance.spec_p('stemcell.name')' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L401" class="js-smell-location">0</a>                  <a href="instance_plan.html#L402" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#stemcell_changed? calls '@instance.stemcell' 4 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L401" class="js-smell-location">0</a>                  <a href="instance_plan.html#L402" class="js-smell-location">1</a>                  <a href="instance_plan.html#L407" class="js-smell-location">2</a>                  <a href="instance_plan.html#L411" class="js-smell-location">3</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#stemcell_changed? calls '@instance.stemcell.name' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L401" class="js-smell-location">0</a>                  <a href="instance_plan.html#L402" class="js-smell-location">1</a>                  </div>  </li></ol>
            log_changes(__method__, @existing_instance.spec_p(&#39;stemcell.name&#39;), @instance.stemcell.name, @existing_instance)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#stemcell_changed? calls '@existing_instance.spec_p('stemcell.name')' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L401" class="js-smell-location">0</a>                  <a href="instance_plan.html#L402" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#stemcell_changed? calls '@instance.stemcell' 4 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L401" class="js-smell-location">0</a>                  <a href="instance_plan.html#L402" class="js-smell-location">1</a>                  <a href="instance_plan.html#L407" class="js-smell-location">2</a>                  <a href="instance_plan.html#L411" class="js-smell-location">3</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#stemcell_changed? calls '@instance.stemcell.name' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L401" class="js-smell-location">0</a>                  <a href="instance_plan.html#L402" class="js-smell-location">1</a>                  </div>  </li></ol>
            return true
          end

          if @existing_instance&amp;.spec_p(&#39;stemcell.version&#39;) &amp;&amp;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#stemcell_changed? performs a nil-check</span>              <span>Locations:</span>                  <a href="instance_plan.html#L400" class="js-smell-location">0</a>                  <a href="instance_plan.html#L406" class="js-smell-location">1</a>                  </div>  </li></ol>
             @instance.stemcell.version != @existing_instance.spec_p(&#39;stemcell.version&#39;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#stemcell_changed? calls '@existing_instance.spec_p('stemcell.version')' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L407" class="js-smell-location">0</a>                  <a href="instance_plan.html#L410" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#stemcell_changed? calls '@instance.stemcell' 4 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L401" class="js-smell-location">0</a>                  <a href="instance_plan.html#L402" class="js-smell-location">1</a>                  <a href="instance_plan.html#L407" class="js-smell-location">2</a>                  <a href="instance_plan.html#L411" class="js-smell-location">3</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#stemcell_changed? calls '@instance.stemcell.version' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L407" class="js-smell-location">0</a>                  <a href="instance_plan.html#L411" class="js-smell-location">1</a>                  </div>  </li></ol>
            log_changes(
              __method__,
              &quot;version: #{@existing_instance.spec_p(&#39;stemcell.version&#39;)}&quot;,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#stemcell_changed? calls '@existing_instance.spec_p('stemcell.version')' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L407" class="js-smell-location">0</a>                  <a href="instance_plan.html#L410" class="js-smell-location">1</a>                  </div>  </li></ol>
              &quot;version: #{@instance.stemcell.version}&quot;,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#stemcell_changed? calls '@instance.stemcell' 4 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L401" class="js-smell-location">0</a>                  <a href="instance_plan.html#L402" class="js-smell-location">1</a>                  <a href="instance_plan.html#L407" class="js-smell-location">2</a>                  <a href="instance_plan.html#L411" class="js-smell-location">3</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#stemcell_changed? calls '@instance.stemcell.version' 2 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L407" class="js-smell-location">0</a>                  <a href="instance_plan.html#L411" class="js-smell-location">1</a>                  </div>  </li></ol>
              @existing_instance,
            )
            return true
          end

          false
        end

        def log_changes(method_sym, old_state, new_state, instance)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::InstancePlan#log_changes has 4 parameters</span>          </div>  </li></ol>
          @logger.debug(&quot;#{method_sym} changed FROM: #{old_state} TO: #{new_state} on instance #{instance}&quot;)
        end
      end

      class ResurrectionInstancePlan &lt; InstancePlan<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Instance-Variable-Assumption.md" target="_blank"><b>InstanceVariableAssumption</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::ResurrectionInstancePlan assumes too much for instance variable '@existing_instance'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Instance-Variable-Assumption.md" target="_blank"><b>InstanceVariableAssumption</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::ResurrectionInstancePlan assumes too much for instance variable '@instance'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Irresponsible-Module.md" target="_blank"><b>IrresponsibleModule</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::ResurrectionInstancePlan has no descriptive comment</span>          </div>  </li></ol>
        def network_settings_hash
          @existing_instance.spec_p(&#39;networks&#39;)
        end

        def spec
          InstanceSpec.create_from_database(@existing_instance.spec, @instance)
        end

        def needs_disk?
          @existing_instance.managed_persistent_disk_cid
        end

        def templates<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::ResurrectionInstancePlan#templates has a flog score of 38</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::ResurrectionInstancePlan#templates has approx 9 statements</span>          </div>  </li></ol>
          @existing_instance.templates.map do |template_model|
            model_release_version = @instance.model.deployment.release_versions.find do |release_version|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::ResurrectionInstancePlan#templates calls '@instance.model' 3 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L440" class="js-smell-location">0</a>                  <a href="instance_plan.html#L444" class="js-smell-location">1</a>                  <a href="instance_plan.html#L446" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::ResurrectionInstancePlan#templates calls '@instance.model.deployment' 3 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L440" class="js-smell-location">0</a>                  <a href="instance_plan.html#L444" class="js-smell-location">1</a>                  <a href="instance_plan.html#L446" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::ResurrectionInstancePlan#templates contains iterators nested 2 deep</span>          </div>  </li></ol>
              release_version.templates.map(&amp;:id).include? template_model.id
            end
            release_spec = { &#39;name&#39; =&gt; model_release_version.release.name, &#39;version&#39; =&gt; model_release_version.version }
            job_release_version = ReleaseVersion.new(@instance.model.deployment, release_spec)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::ResurrectionInstancePlan#templates calls '@instance.model' 3 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L440" class="js-smell-location">0</a>                  <a href="instance_plan.html#L444" class="js-smell-location">1</a>                  <a href="instance_plan.html#L446" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::ResurrectionInstancePlan#templates calls '@instance.model.deployment' 3 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L440" class="js-smell-location">0</a>                  <a href="instance_plan.html#L444" class="js-smell-location">1</a>                  <a href="instance_plan.html#L446" class="js-smell-location">2</a>                  </div>  </li></ol>
            job_release_version.bind_model
            template = Job.new(job_release_version, template_model.name, @instance.model.deployment.name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::ResurrectionInstancePlan#templates calls '@instance.model' 3 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L440" class="js-smell-location">0</a>                  <a href="instance_plan.html#L444" class="js-smell-location">1</a>                  <a href="instance_plan.html#L446" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::ResurrectionInstancePlan#templates calls '@instance.model.deployment' 3 times</span>              <span>Locations:</span>                  <a href="instance_plan.html#L440" class="js-smell-location">0</a>                  <a href="instance_plan.html#L444" class="js-smell-location">1</a>                  <a href="instance_plan.html#L446" class="js-smell-location">2</a>                  </div>  </li></ol>
            template.bind_existing_model(template_model)
            template
          end
        end
      end
    end
  end
end
</code>
  </div>
</div>

        </div>
      </div>
    </div>

    <!-- Javascripts -->
    <script src='../../../assets/javascripts/jquery.min.js'></script>
    <script src='../../../assets/javascripts/jquery.tablesorter.min.js'></script>
    <script src='../../../assets/javascripts/jquery.scrollTo.min.js'></script>
    <script src='../../../assets/javascripts/jquery.timeago.js'></script>
    <script src='../../../assets/javascripts/highcharts.src-4.0.1.js'></script>
    <script src='../../../assets/javascripts/prettify.js'></script>
    <script src='../../../assets/javascripts/bootstrap.min.js'></script>
    <script src='../../../assets/javascripts/application.js'></script>
    <script src='../../../assets/javascripts/jquery.filtertable.min.js'></script>
  </body>
</html>
