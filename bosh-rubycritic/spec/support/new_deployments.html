<!DOCTYPE html>
<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ruby Critic - Home</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- StyleSheets -->
    <link href="../../assets/stylesheets/bootstrap.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../assets/stylesheets/font-awesome.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../assets/stylesheets/prettify.custom_theme.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../assets/stylesheets/application.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  </head>

  <body>
    <header class="navbar navbar-default navbar-fixed-top">
      <a href="#menu-toggle" class="btn btn-default hidden-lg visible-sm-* hidden-md visible-xs-* pull-left" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a>
      <a href="../../overview.html"><img src="../../assets/images/logo.png" title="Ruby Critic Logo" width="55"><span class="logo">RUBYCRITIC</span></a>
    </header>
    <div id="wrapper">
      <!-- Sidebar -->
      <aside id="sidebar-wrapper">
        <ul class="sidebar-nav">
          <li class="sidebar-item">
            <a href="../../overview.html" class="project-nav-item overview-nav"><i class="fa fa-dashboard"></i>Overview</a>
          </li>
          <li class="sidebar-item">
            <a href="../../code_index.html" class="project-nav-item code-index-nav"><i class="fa fa-code"></i>Code</a>
          </li>
          <li class="sidebar-item">
            <a href="../../smells_index.html" class="project-nav-item smells-index-nav"><i class="fa fa-warning"></i>Smells</a>
          </li>
        </ul>
      </aside>
      <!-- /#sidebar-wrapper -->
      <div id="page-content-wrapper">
        <div class="container-fluid">
          <div class="row">
  <!--Page Title -->
  <div class="Page_Title">
    <div class="file-time">
      <span class="committed-at">
        
          Updated <time class='js-timeago' datetime='2018-05-31 12:06:36 -0700'>2018-05-31 12:06:36 -0700</time>
        
      </span>
    </div>
    <div>
      <h3><small>spec/support /</small> new_deployments.rb</h3>
    </div>
  </div>
  <!--End Page Title -->
  <div class="Content_Wrapper">
    <!-- code detail -->
    <div class="code-top-detail clearfix row">
      <div class="col-md-8">
        <div class="row">
          <div class="col-md-1">
            <div class="rating f big">
              F
            </div>
          </div>
          <div class="code-statistics col-md-11">
            <div class="col-md-3">
              <div><span class="metric">612</span><small> lines of codes</small></div>
              <div><span class="metric">36</span><small> methods</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">4.0</span><small> complexity/method</small></div>
              <div><span class="metric">19</span><small> churn</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">144.03</span><small> complexity</small></div>
              <div><span class="metric">339</span><small> duplications</small></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="code-tabs">
          <ul class="nav nav-pills right-to-left">
            <li><a href="#" id="toggle-code" class="toggle-button button">code</a></li>
            <li class="active">
              <a href="#" id="toggle-smells" class="toggle-button button">
                23
                smells
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <code class="prettyprint linenums lang-ruby file-code js-file-code">module Bosh::Spec
  class NewDeployments<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Irresponsible-Module.md" target="_blank"><b>IrresponsibleModule</b></a>        </span>      </div>      <span>Bosh::Spec::NewDeployments has no descriptive comment</span>          </div>  </li></ol>
    DEFAULT_DEPLOYMENT_NAME = &#39;simple&#39;.freeze
    DISK_TYPE = {
      &#39;name&#39; =&gt; &#39;default&#39;,
      &#39;disk_size&#39; =&gt; 1024,
      &#39;cloud_properties&#39; =&gt; {},
    }.freeze

    def self.simple_cloud_config
      minimal_cloud_config.merge(
        &#39;networks&#39; =&gt; [network],
        &#39;vm_types&#39; =&gt; [vm_type],
      )
    end

    def self.minimal_cloud_config<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="deployments.html#L5" class="js-smell-location">0</a>                  <a href="new_deployments.html#L17" class="js-smell-location">1</a>                  </div>  </li></ol>
      {
        &#39;networks&#39; =&gt; [{
          &#39;name&#39; =&gt; &#39;a&#39;,
          &#39;subnets&#39; =&gt; [],
        }],

        &#39;compilation&#39; =&gt; {
          &#39;workers&#39; =&gt; 1,
          &#39;network&#39; =&gt; &#39;a&#39;,
          &#39;cloud_properties&#39; =&gt; {},
        },

        &#39;vm_types&#39; =&gt; [],
      }
    end

    def self.network(options = {})
      {
        &#39;name&#39; =&gt; &#39;a&#39;,
        &#39;subnets&#39; =&gt; [subnet],
      }.merge!(options)
    end

    def self.subnet(options = {})<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Identical code found in 2 nodes</span>              <span>Locations:</span>                  <a href="deployments.html#L439" class="js-smell-location">0</a>                  <a href="new_deployments.html#L41" class="js-smell-location">1</a>                  </div>  </li></ol>
      {
        &#39;range&#39; =&gt; &#39;192.168.1.0/24&#39;,
        &#39;gateway&#39; =&gt; &#39;192.168.1.1&#39;,
        &#39;dns&#39; =&gt; [&#39;192.168.1.1&#39;, &#39;192.168.1.2&#39;],
        &#39;static&#39; =&gt; [&#39;192.168.1.10&#39;],
        &#39;reserved&#39; =&gt; [],
        &#39;cloud_properties&#39; =&gt; {},
      }.merge!(options)
    end

    def self.vm_type
      {
        &#39;name&#39; =&gt; &#39;a&#39;,
        &#39;cloud_properties&#39; =&gt; {},
      }
    end

    def self.simple_errand_instance_group
      {
        &#39;name&#39; =&gt; &#39;fake-errand-name&#39;,
        &#39;jobs&#39; =&gt; [
          {
            &#39;release&#39; =&gt; &#39;bosh-release&#39;,
            &#39;name&#39; =&gt; &#39;errand1&#39;,
            &#39;properties&#39; =&gt; {
              &#39;errand1&#39; =&gt; {
                &#39;exit_code&#39; =&gt; 0,
                &#39;stdout&#39; =&gt; &#39;fake-errand-stdout&#39;,
                &#39;stderr&#39; =&gt; &#39;fake-errand-stderr&#39;,
                &#39;run_package_file&#39; =&gt; true,
              },
            },
          },
        ],
        &#39;stemcell&#39; =&gt; &#39;default&#39;,
        &#39;lifecycle&#39; =&gt; &#39;errand&#39;,
        &#39;vm_type&#39; =&gt; &#39;a&#39;,
        &#39;instances&#39; =&gt; 1,
        &#39;networks&#39; =&gt; [{ &#39;name&#39; =&gt; &#39;a&#39; }],
        &#39;env&#39; =&gt; {},
      }
    end

    def self.simple_instance_group(opts = {})<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Spec::NewDeployments::simple_instance_group has a flog score of 29</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Spec::NewDeployments#self.simple_instance_group has approx 10 statements</span>          </div>  </li></ol>
      instance_group_hash = {
        &#39;name&#39; =&gt; opts.fetch(:name, &#39;foobar&#39;),
        &#39;stemcell&#39; =&gt; opts[:stemcell] || &#39;default&#39;,
        &#39;vm_type&#39; =&gt; opts.fetch(:vm_type, &#39;a&#39;),
        &#39;instances&#39; =&gt; opts.fetch(:instances, 3),
        &#39;networks&#39; =&gt; [{ &#39;name&#39; =&gt; opts.fetch(:network_name, &#39;a&#39;) }],
        &#39;properties&#39; =&gt; {},
        &#39;jobs&#39; =&gt; opts.fetch(
          :jobs, [{
            &#39;name&#39; =&gt; opts.fetch(:job_name, &#39;foobar&#39;),
            &#39;properties&#39; =&gt; {},
          }]
        ),
      }

      instance_group_hash[&#39;env&#39;] = opts[:env] if opts.key?(:env)
      instance_group_hash[&#39;persistent_disk_pool&#39;] = opts[:persistent_disk_pool] if opts[:persistent_disk_pool]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Spec::NewDeployments#self.simple_instance_group calls 'opts[:persistent_disk_pool]' 2 times</span>          </div>  </li></ol>
      instance_group_hash[&#39;persistent_disk_type&#39;] = opts[:persistent_disk_type] if opts[:persistent_disk_type]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Spec::NewDeployments#self.simple_instance_group calls 'opts[:persistent_disk_type]' 2 times</span>          </div>  </li></ol>
      instance_group_hash[&#39;networks&#39;].first[&#39;static_ips&#39;] = opts[:static_ips] if opts.key?(:static_ips)
      instance_group_hash[&#39;azs&#39;] = opts[:azs] if opts.key?(:azs)
      instance_group_hash[&#39;properties&#39;] = opts[:properties] if opts.key?(:properties)

      if opts.key?(:vm_resources)
        instance_group_hash.delete(&#39;vm_type&#39;)
        instance_group_hash[&#39;vm_resources&#39;] = opts[:vm_resources]
      end

      instance_group_hash
    end

    def self.minimal_manifest
      {
        &#39;name&#39; =&gt; &#39;minimal&#39;,
        &#39;director_uuid&#39; =&gt; &#39;deadbeef&#39;,

        &#39;releases&#39; =&gt; [{
          &#39;name&#39;    =&gt; &#39;test_release&#39;,
          &#39;version&#39; =&gt; &#39;1&#39; # It&#39;s our dummy valid release from spec/assets/test_release.tgz
        }],

        &#39;stemcells&#39; =&gt; [{
          &#39;alias&#39; =&gt; &#39;default&#39;,
          &#39;os&#39; =&gt; &#39;toronto-os&#39;,
          &#39;version&#39; =&gt; &#39;latest&#39;,
        }],

        &#39;update&#39; =&gt; {
          &#39;canaries&#39;          =&gt; 2,
          &#39;canary_watch_time&#39; =&gt; 4000,
          &#39;max_in_flight&#39;     =&gt; 1,
          &#39;update_watch_time&#39; =&gt; 20,
        },
      }
    end

    def self.minimal_manifest_with_ubuntu_stemcell
      minimal_manifest.merge(&#39;stemcells&#39; =&gt; [
                               {
                                 &#39;name&#39; =&gt; &#39;ubuntu-stemcell&#39;,
                                 &#39;version&#39; =&gt; &#39;1&#39;,
                                 &#39;alias&#39; =&gt; &#39;default&#39;,
                               },
                             ])
    end

    def self.manifest_with_release
      minimal_manifest.merge(
        &#39;name&#39; =&gt; DEFAULT_DEPLOYMENT_NAME,
        &#39;releases&#39; =&gt; [{
          &#39;name&#39;    =&gt; &#39;bosh-release&#39;,
          &#39;version&#39; =&gt; &#39;0.1-dev&#39;,
        }],
      )
    end

    def self.test_release_manifest_with_stemcell
      minimal_manifest_with_ubuntu_stemcell.merge(
        &#39;name&#39; =&gt; DEFAULT_DEPLOYMENT_NAME,
        &#39;releases&#39; =&gt; [{
          &#39;name&#39;    =&gt; &#39;bosh-release&#39;,
          &#39;version&#39; =&gt; &#39;0.1-dev&#39;,
        }],
      )
    end

    def self.simple_manifest_with_instance_groups(opts = {})
      test_release_manifest_with_stemcell.merge(
        &#39;instance_groups&#39; =&gt; [simple_instance_group(opts)],
      )
    end

    def self.simple_manifest_with_instance_groups_and_vm_resources
      test_release_manifest_with_stemcell.merge(
        &#39;instance_groups&#39; =&gt; [
          simple_instance_group(vm_resources: { &#39;cpu&#39; =&gt; 2, &#39;ram&#39; =&gt; 1024, &#39;ephemeral_disk_size&#39; =&gt; 10 }),
        ],
      )
    end

    def self.manifest_with_errand<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="deployments.html#L933" class="js-smell-location">0</a>                  <a href="new_deployments.html#L185" class="js-smell-location">1</a>                  </div>  </li></ol>
      manifest = simple_manifest_with_instance_groups.merge(&#39;name&#39; =&gt; &#39;errand&#39;)
      manifest[&#39;instance_groups&#39;].find { |instance_group| instance_group[&#39;name&#39;] == &#39;foobar&#39; }[&#39;instances&#39;] = 1<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Spec::NewDeployments#self.manifest_with_errand calls 'manifest['instance_groups']' 2 times</span>              <span>Locations:</span>                  <a href="new_deployments.html#L187" class="js-smell-location">0</a>                  <a href="new_deployments.html#L188" class="js-smell-location">1</a>                  </div>  </li></ol>
      manifest[&#39;instance_groups&#39;] &lt;&lt; simple_errand_instance_group<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Spec::NewDeployments#self.manifest_with_errand calls 'manifest['instance_groups']' 2 times</span>              <span>Locations:</span>                  <a href="new_deployments.html#L187" class="js-smell-location">0</a>                  <a href="new_deployments.html#L188" class="js-smell-location">1</a>                  </div>  </li></ol>
      manifest
    end

    def self.manifest_errand_with_placeholders
      manifest = manifest_with_errand
      manifest[&#39;instance_groups&#39;][1][&#39;jobs&#39;].first[&#39;properties&#39;][&#39;errand1&#39;][&#39;stdout&#39;] = &#39;((placeholder))&#39;
      manifest.merge(&#39;env&#39; =&gt; {
        &#39;bosh&#39; =&gt; {
          &#39;password&#39; =&gt; &#39;((errand_password))&#39;,
        },
      })
    end

    def self.test_release_instance_group<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="deployments.html#L879" class="js-smell-location">0</a>                  <a href="new_deployments.html#L202" class="js-smell-location">1</a>                  </div>  </li></ol>
      {
        &#39;instance_group&#39; =&gt; [{
          &#39;name&#39; =&gt; &#39;instance_group&#39;,
          &#39;jobs&#39; =&gt; [{ &#39;name&#39; =&gt; &#39;job_using_pkg_1&#39; }],
          &#39;instances&#39; =&gt; 1,
          &#39;resource_pool&#39; =&gt; &#39;a&#39;,
          &#39;networks&#39; =&gt; [{ &#39;name&#39; =&gt; &#39;a&#39; }],
        }],
      }
    end

    def self.remote_release_manifest(remote_release_url, sha1, version = &#39;latest&#39;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="deployments.html#L858" class="js-smell-location">0</a>                  <a href="new_deployments.html#L214" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Uncommunicative-Parameter-Name.md" target="_blank"><b>UncommunicativeParameterName</b></a>        </span>      </div>      <span>Bosh::Spec::NewDeployments#self.remote_release_manifest has the parameter name 'sha1'</span>          </div>  </li></ol>
      minimal_manifest_with_ubuntu_stemcell.merge(test_release_instance_group).merge(
        &#39;releases&#39; =&gt; [{
          &#39;name&#39;    =&gt; &#39;test_release&#39;,
          &#39;version&#39; =&gt; version,
          &#39;url&#39; =&gt; remote_release_url,
          &#39;sha1&#39; =&gt; sha1,
        }],
      )
    end

    def self.local_release_manifest(local_release_path, version = &#39;latest&#39;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="deployments.html#L869" class="js-smell-location">0</a>                  <a href="new_deployments.html#L225" class="js-smell-location">1</a>                  </div>  </li></ol>
      minimal_manifest_with_ubuntu_stemcell.merge(test_release_instance_group).merge(
        &#39;releases&#39; =&gt; [{
          &#39;name&#39;    =&gt; &#39;test_release&#39;,
          &#39;version&#39; =&gt; version,
          &#39;url&#39; =&gt; local_release_path,
        }],
      )
    end

    def self.simple_cloud_config_with_multiple_azs_and_cpis<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Identical code found in 2 nodes</span>              <span>Locations:</span>                  <a href="deployments.html#L183" class="js-smell-location">0</a>                  <a href="new_deployments.html#L235" class="js-smell-location">1</a>                  </div>  </li></ol>
      cloud_config = simple_cloud_config_with_multiple_azs

      cloud_config[&#39;azs&#39;].each_index do |i|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Spec::NewDeployments#self.simple_cloud_config_with_multiple_azs_and_cpis calls 'cloud_config['azs']' 2 times</span>              <span>Locations:</span>                  <a href="new_deployments.html#L238" class="js-smell-location">0</a>                  <a href="new_deployments.html#L239" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Uncommunicative-Variable-Name.md" target="_blank"><b>UncommunicativeVariableName</b></a>        </span>      </div>      <span>Bosh::Spec::NewDeployments#self.simple_cloud_config_with_multiple_azs_and_cpis has the variable name 'i'</span>          </div>  </li></ol>
        cloud_config[&#39;azs&#39;][i][&#39;cpi&#39;] = &quot;cpi-name#{i + 1}&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Spec::NewDeployments#self.simple_cloud_config_with_multiple_azs_and_cpis calls 'cloud_config['azs']' 2 times</span>              <span>Locations:</span>                  <a href="new_deployments.html#L238" class="js-smell-location">0</a>                  <a href="new_deployments.html#L239" class="js-smell-location">1</a>                  </div>  </li></ol>
      end

      cloud_config
    end

    def self.simple_cloud_config_with_multiple_azs<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="deployments.html#L193" class="js-smell-location">0</a>                  <a href="new_deployments.html#L245" class="js-smell-location">1</a>                  </div>  </li></ol>
      networks = [
        {
          &#39;name&#39; =&gt; &#39;a&#39;,
          &#39;subnets&#39; =&gt; [
            subnet(&#39;az&#39; =&gt; &#39;z1&#39;),
            {
              &#39;range&#39; =&gt; &#39;192.168.2.0/24&#39;,
              &#39;gateway&#39; =&gt; &#39;192.168.2.1&#39;,
              &#39;dns&#39; =&gt; [&#39;192.168.2.1&#39;, &#39;192.168.2.2&#39;],
              &#39;static&#39; =&gt; [&#39;192.168.2.10&#39;],
              &#39;reserved&#39; =&gt; [],
              &#39;cloud_properties&#39; =&gt; {},
              &#39;az&#39; =&gt; &#39;z2&#39;,
            },
          ],
        },
      ]

      azs = [
        {
          &#39;name&#39; =&gt; &#39;z1&#39;,
          &#39;cloud_properties&#39; =&gt; { &#39;a&#39; =&gt; &#39;b&#39; },
        },
        {
          &#39;name&#39; =&gt; &#39;z2&#39;,
          &#39;cloud_properties&#39; =&gt; { &#39;a&#39; =&gt; &#39;b&#39; },
        },
      ]
      minimal_cloud_config.merge(
        &#39;networks&#39; =&gt; networks,
        &#39;vm_types&#39; =&gt; [vm_type],
        &#39;azs&#39; =&gt; azs,
        &#39;compilation&#39; =&gt; {
          &#39;workers&#39; =&gt; 1,
          &#39;network&#39; =&gt; &#39;a&#39;,
          &#39;cloud_properties&#39; =&gt; {},
          &#39;az&#39; =&gt; &#39;z1&#39;,
        },
      )
    end

    def self.single_cpi_config(name = &#39;cpi-name1&#39;, properties = { &#39;somekey&#39; =&gt; &#39;someval&#39; }, exec_path = nil)
      cpi_config = {
        &#39;cpis&#39; =&gt; [
          {
            &#39;name&#39; =&gt; name,
            &#39;type&#39; =&gt; &#39;cpi-type&#39;,
            &#39;properties&#39; =&gt; properties,
          },
        ],
      }
      cpi_config[&#39;cpis&#39;].first[&#39;exec_path&#39;] = exec_path unless exec_path.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Spec::NewDeployments#self.single_cpi_config performs a nil-check</span>          </div>  </li></ol>
      cpi_config
    end

    def self.multi_cpi_config(exec_path = nil)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Identical code found in 2 nodes</span>              <span>Locations:</span>                  <a href="deployments.html#L384" class="js-smell-location">0</a>                  <a href="new_deployments.html#L301" class="js-smell-location">1</a>                  </div>  </li></ol>
      cpi_config = {
        &#39;cpis&#39; =&gt; [
          {
            &#39;name&#39; =&gt; &#39;cpi-name1&#39;,
            &#39;type&#39; =&gt; &#39;cpi-type&#39;,
            &#39;properties&#39; =&gt; {
              &#39;somekey&#39; =&gt; &#39;someval&#39;,
            },
          },
          {
            &#39;name&#39; =&gt; &#39;cpi-name2&#39;,
            &#39;type&#39; =&gt; &#39;cpi-type2&#39;,
            &#39;properties&#39; =&gt; {
              &#39;somekey2&#39; =&gt; &#39;someval2&#39;,
            },
          },
        ],
      }
      cpi_config[&#39;cpis&#39;].each { |cpi| cpi[&#39;exec_path&#39;] = exec_path } unless exec_path.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Spec::NewDeployments#self.multi_cpi_config performs a nil-check</span>          </div>  </li></ol>
      cpi_config
    end

    def self.instance_group_with_many_jobs(options = {})
      {
        &#39;name&#39; =&gt; options.fetch(:name),
        &#39;jobs&#39; =&gt; options.fetch(:jobs),
        &#39;vm_type&#39; =&gt; &#39;a&#39;,
        &#39;instances&#39;     =&gt; options.fetch(:instances, 3),
        &#39;networks&#39;      =&gt; [{ &#39;name&#39; =&gt; &#39;a&#39; }],
        &#39;properties&#39;    =&gt; options.fetch(:properties, {}),
        &#39;stemcell&#39; =&gt; &#39;default&#39;,
      }
    end

    def self.test_deployment_manifest
      {
        &#39;name&#39; =&gt; &#39;test_deployment&#39;,
        &#39;releases&#39; =&gt; [{
          &#39;name&#39;    =&gt; &#39;test_release&#39;,
          &#39;version&#39; =&gt; &#39;1&#39;,
        }],

        &#39;update&#39; =&gt; {
          &#39;canaries&#39;          =&gt; 2,
          &#39;canary_watch_time&#39; =&gt; 4000,
          &#39;max_in_flight&#39;     =&gt; 1,
          &#39;update_watch_time&#39; =&gt; 20,
        },

        &#39;stemcells&#39; =&gt; [{
          &#39;alias&#39; =&gt; &#39;default&#39;,
          &#39;os&#39; =&gt; &#39;toronto-os&#39;,
          &#39;version&#39; =&gt; &#39;1&#39;,
        }],
      }
    end

    def self.test_deployment_manifest_with_job(job_name)
      test_deployment_manifest.merge(
        &#39;instance_groups&#39; =&gt; [{
          &#39;name&#39;          =&gt; job_name,
          &#39;jobs&#39; =&gt; [{
            &#39;name&#39; =&gt; job_name,
          }],
          &#39;vm_type&#39; =&gt; &#39;a&#39;,
          &#39;instances&#39; =&gt; 1,
          &#39;networks&#39; =&gt; [{ &#39;name&#39; =&gt; &#39;a&#39; }],
          &#39;stemcell&#39; =&gt; &#39;default&#39;,
        }],
      )
    end

    def self.test_deployment_manifest_referencing_multiple_releases
      {
        &#39;name&#39; =&gt; &#39;multiple_release_deployment&#39;,
        &#39;director_uuid&#39; =&gt; &#39;deadbeef&#39;,

        &#39;releases&#39; =&gt; [{
          &#39;name&#39;    =&gt; &#39;test_release&#39;,
          &#39;version&#39; =&gt; &#39;1&#39;,
        }, {
          &#39;name&#39;    =&gt; &#39;test_release_a&#39;,
          &#39;version&#39; =&gt; &#39;1&#39;,
        }],

        &#39;stemcells&#39; =&gt; [{
          &#39;alias&#39; =&gt; &#39;default&#39;,
          &#39;os&#39; =&gt; &#39;toronto-os&#39;,
          &#39;version&#39; =&gt; &#39;1&#39;,
        }],

        &#39;update&#39; =&gt; {
          &#39;canaries&#39;          =&gt; 2,
          &#39;canary_watch_time&#39; =&gt; 4000,
          &#39;max_in_flight&#39;     =&gt; 1,
          &#39;update_watch_time&#39; =&gt; 20,
        },
        &#39;instance_groups&#39; =&gt; [{
          &#39;name&#39;          =&gt; &#39;instance_group_name&#39;,
          &#39;jobs&#39; =&gt; [{
            &#39;name&#39;    =&gt; &#39;job_using_pkg_1_and_2&#39;,
            &#39;release&#39; =&gt; &#39;test_release&#39;,
          }, {
            &#39;name&#39;    =&gt; &#39;job_using_pkg_5&#39;,
            &#39;release&#39; =&gt; &#39;test_release_a&#39;,
          }],
          &#39;vm_type&#39; =&gt; &#39;a&#39;,
          &#39;instances&#39;     =&gt; 1,
          &#39;networks&#39;      =&gt; [{ &#39;name&#39; =&gt; &#39;a&#39; }],
          &#39;stemcell&#39; =&gt; &#39;default&#39;,
        }],
      }
    end

    def self.stemcell_os_specific_addon_manifest
      manifest_with_release.merge(
        &#39;instance_groups&#39; =&gt; [
          simple_instance_group(vm_type: &#39;a&#39;, name: &#39;has-addon-vm&#39;, instances: 1, stemcell: &#39;toronto&#39;),
          simple_instance_group(vm_type: &#39;b&#39;, name: &#39;no-addon-vm&#39;, instances: 1, stemcell: &#39;centos&#39;),
        ],
      )
    end

    def self.simple_os_specific_cloud_config
      vm_types = [
        {
          &#39;name&#39; =&gt; &#39;a&#39;,
          &#39;cloud_properties&#39; =&gt; {},
        },
        {
          &#39;name&#39; =&gt; &#39;b&#39;,
          &#39;cloud_properties&#39; =&gt; {},
        },
      ]
      minimal_cloud_config.merge(
        &#39;networks&#39; =&gt; [network],
        &#39;vm_types&#39; =&gt; vm_types,
      )
    end

    def self.multiple_release_manifest
      {
        &#39;name&#39; =&gt; &#39;minimal&#39;,
        &#39;director_uuid&#39; =&gt; &#39;deadbeef&#39;,

        &#39;releases&#39; =&gt; [{
          &#39;name&#39;    =&gt; &#39;test_release&#39;,
          &#39;version&#39; =&gt; &#39;1&#39; # It&#39;s our dummy valid release from spec/assets/test_release.tgz
        }, {
          &#39;name&#39;    =&gt; &#39;test_release_2&#39;,
          &#39;version&#39; =&gt; &#39;2&#39; # It&#39;s our dummy valid release from spec/assets/test_release_2.tgz
        }],

        &#39;update&#39; =&gt; {
          &#39;canaries&#39;          =&gt; 2,
          &#39;canary_watch_time&#39; =&gt; 4000,
          &#39;max_in_flight&#39;     =&gt; 1,
          &#39;update_watch_time&#39; =&gt; 20,
        },
        &#39;stemcells&#39; =&gt; [{
          &#39;alias&#39; =&gt; &#39;default&#39;,
          &#39;os&#39; =&gt; &#39;toronto-os&#39;,
          &#39;version&#39; =&gt; &#39;latest&#39;,
        }],
      }
    end

    def self.manifest_with_addons
      minimal_manifest.merge(
        &#39;name&#39; =&gt; DEFAULT_DEPLOYMENT_NAME,
        &#39;releases&#39; =&gt; [
          {
            &#39;name&#39; =&gt; &#39;bosh-release&#39;,
            &#39;version&#39; =&gt; &#39;0.1-dev&#39;,
          },
          { &#39;name&#39; =&gt; &#39;dummy2&#39;,
            &#39;version&#39; =&gt; &#39;0.2-dev&#39; },
        ],
        &#39;instance_groups&#39; =&gt; [{
          &#39;name&#39; =&gt; &#39;foobar&#39;,
          &#39;jobs&#39; =&gt; [{ &#39;name&#39; =&gt; &#39;foobar&#39;, &#39;release&#39; =&gt; &#39;bosh-release&#39; }],
          &#39;instances&#39; =&gt; 1,
          &#39;vm_type&#39; =&gt; &#39;a&#39;,
          &#39;networks&#39; =&gt; [{ &#39;name&#39; =&gt; &#39;a&#39; }],
          &#39;stemcell&#39; =&gt; &#39;default&#39;,
        }],
        &#39;addons&#39; =&gt; [{
          &#39;name&#39; =&gt; &#39;addon1&#39;,
          &#39;jobs&#39; =&gt; [{ &#39;name&#39; =&gt; &#39;dummy_with_properties&#39;, &#39;release&#39; =&gt; &#39;dummy2&#39; }],
          &#39;properties&#39; =&gt; { &#39;dummy_with_properties&#39; =&gt; { &#39;echo_value&#39; =&gt; &#39;prop_value&#39; } },
        }],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 3 nodes</span>              <span>Locations:</span>                  <a href="deployments.html#L343" class="js-smell-location">0</a>                  <a href="deployments.html#L693" class="js-smell-location">1</a>                  <a href="new_deployments.html#L492" class="js-smell-location">2</a>                  </div>  </li></ol>
      )
    end

    def self.complex_manifest_with_addon
      manifest = minimal_manifest.merge(
        &#39;name&#39; =&gt; DEFAULT_DEPLOYMENT_NAME,
        &#39;releases&#39; =&gt; [
          {
            &#39;name&#39; =&gt; &#39;bosh-release&#39;,
            &#39;version&#39; =&gt; &#39;0.1-dev&#39;,
          },
          { &#39;name&#39; =&gt; &#39;dummy2&#39;,
            &#39;version&#39; =&gt; &#39;0.2-dev&#39; },
        ],
        &#39;instance_groups&#39; =&gt; [
          simple_instance_group(
            vm_type: &#39;b&#39;,
            name: &#39;has-rc-addon-vm&#39;,
            jobs: [{ &#39;name&#39; =&gt; &#39;foobar&#39;, &#39;release&#39; =&gt; &#39;bosh-release&#39; }],
            instances: 1,
            stemcell: &#39;centos&#39;,
          ),
          simple_instance_group(
            vm_type: &#39;a&#39;,
            name: &#39;has-depl-rc-addons-vm&#39;,
            jobs: [{ &#39;name&#39; =&gt; &#39;foobar&#39;, &#39;release&#39; =&gt; &#39;bosh-release&#39; }],
            instances: 1,
          ),
          simple_instance_group(
            vm_type: &#39;a&#39;,
            name: &#39;has-depl-addon-vm&#39;,
            jobs: [{ &#39;name&#39; =&gt; &#39;foobar_without_packages&#39;, &#39;release&#39; =&gt; &#39;bosh-release&#39; }],
            instances: 1,
          ),
        ],
        &#39;addons&#39; =&gt; [
          &#39;name&#39; =&gt; &#39;addon1&#39;,
          &#39;jobs&#39; =&gt; [{ &#39;name&#39; =&gt; &#39;dummy&#39;, &#39;release&#39; =&gt; &#39;dummy2&#39; }],
          &#39;include&#39; =&gt; {
            &#39;stemcell&#39; =&gt; [
              { &#39;os&#39; =&gt; &#39;toronto-os&#39; },
            ],
          },
        ],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Identical code found in 3 nodes</span>              <span>Locations:</span>                  <a href="deployments.html#L308" class="js-smell-location">0</a>                  <a href="deployments.html#L721" class="js-smell-location">1</a>                  <a href="new_deployments.html#L536" class="js-smell-location">2</a>                  </div>  </li></ol>
      )
      manifest[&#39;stemcells&#39;] &lt;&lt; {
        &#39;alias&#39; =&gt; &#39;centos&#39;,
        &#39;os&#39; =&gt; &#39;toronto-centos&#39;,
        &#39;version&#39; =&gt; &#39;latest&#39;,
      }
      manifest
    end

    def self.manifest_with_errand_on_service_instance
      manifest = manifest_with_release
      manifest[&#39;instance_groups&#39;] = [service_instance_group_with_errand]
      manifest
    end

    def self.service_instance_group_with_errand
      {<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="../gocli/integration/errand/run_errand_success_spec.html#L44" class="js-smell-location">0</a>                  <a href="new_deployments.html#L553" class="js-smell-location">1</a>                  </div>  </li></ol>
        &#39;name&#39; =&gt; &#39;service_with_errand&#39;,
        &#39;jobs&#39; =&gt; [{
          &#39;release&#39; =&gt; &#39;bosh-release&#39;,
          &#39;name&#39; =&gt; &#39;errand1&#39;,
          &#39;properties&#39; =&gt; {
            &#39;errand1&#39; =&gt; {
              &#39;exit_code&#39; =&gt; 0,
              &#39;stdout&#39; =&gt; &#39;fake-errand-stdout-service&#39;,
              &#39;stderr&#39; =&gt; &#39;fake-errand-stderr-service&#39;,
              &#39;run_package_file&#39; =&gt; true,
            },
          },
        }],
        &#39;lifecycle&#39; =&gt; &#39;service&#39;,
        &#39;vm_type&#39; =&gt; &#39;a&#39;,
        &#39;instances&#39; =&gt; 1,
        &#39;networks&#39; =&gt; [{ &#39;name&#39; =&gt; &#39;a&#39; }],
        &#39;stemcell&#39; =&gt; &#39;default&#39;,
      }
    end

    def self.disk_type
      {
        &#39;name&#39; =&gt; &#39;disk_a&#39;,
        &#39;disk_size&#39; =&gt; 123,
      }
    end

    def self.resurrection_config_enabled
      {
        &#39;rules&#39; =&gt; [
          {
            &#39;enabled&#39; =&gt; true,
            &#39;include&#39; =&gt; {
              &#39;deployments&#39; =&gt; [&#39;simple_enabled&#39;],
              &#39;instance_groups&#39; =&gt; [&#39;foobar&#39;],
            },
          },
        ],
      }
    end

    def self.resurrection_config_disabled
      {
        &#39;rules&#39; =&gt; [
          {
            &#39;enabled&#39; =&gt; false,
            &#39;include&#39; =&gt; {
              &#39;deployments&#39; =&gt; [&#39;simple_disabled&#39;],
            },
            &#39;exclude&#39; =&gt; {
              &#39;instance_groups&#39; =&gt; [&#39;foobar_without_packages&#39;],
            },
          },
        ],
      }
    end
  end
end
</code>
  </div>
</div>

        </div>
      </div>
    </div>

    <!-- Javascripts -->
    <script src='../../assets/javascripts/jquery.min.js'></script>
    <script src='../../assets/javascripts/jquery.tablesorter.min.js'></script>
    <script src='../../assets/javascripts/jquery.scrollTo.min.js'></script>
    <script src='../../assets/javascripts/jquery.timeago.js'></script>
    <script src='../../assets/javascripts/highcharts.src-4.0.1.js'></script>
    <script src='../../assets/javascripts/prettify.js'></script>
    <script src='../../assets/javascripts/bootstrap.min.js'></script>
    <script src='../../assets/javascripts/application.js'></script>
    <script src='../../assets/javascripts/jquery.filtertable.min.js'></script>
  </body>
</html>
