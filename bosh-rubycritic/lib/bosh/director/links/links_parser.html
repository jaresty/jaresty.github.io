<!DOCTYPE html>
<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ruby Critic - Home</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- StyleSheets -->
    <link href="../../../../assets/stylesheets/bootstrap.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../../assets/stylesheets/font-awesome.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../../assets/stylesheets/prettify.custom_theme.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../../assets/stylesheets/application.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  </head>

  <body>
    <header class="navbar navbar-default navbar-fixed-top">
      <a href="#menu-toggle" class="btn btn-default hidden-lg visible-sm-* hidden-md visible-xs-* pull-left" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a>
      <a href="../../../../overview.html"><img src="../../../../assets/images/logo.png" title="Ruby Critic Logo" width="55"><span class="logo">RUBYCRITIC</span></a>
    </header>
    <div id="wrapper">
      <!-- Sidebar -->
      <aside id="sidebar-wrapper">
        <ul class="sidebar-nav">
          <li class="sidebar-item">
            <a href="../../../../overview.html" class="project-nav-item overview-nav"><i class="fa fa-dashboard"></i>Overview</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../../code_index.html" class="project-nav-item code-index-nav"><i class="fa fa-code"></i>Code</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../../smells_index.html" class="project-nav-item smells-index-nav"><i class="fa fa-warning"></i>Smells</a>
          </li>
        </ul>
      </aside>
      <!-- /#sidebar-wrapper -->
      <div id="page-content-wrapper">
        <div class="container-fluid">
          <div class="row">
  <!--Page Title -->
  <div class="Page_Title">
    <div class="file-time">
      <span class="committed-at">
        
          Updated <time class='js-timeago' datetime='2018-06-22 15:27:04 -0400'>2018-06-22 15:27:04 -0400</time>
        
      </span>
    </div>
    <div>
      <h3><small>lib/bosh/director/links /</small> links_parser.rb</h3>
    </div>
  </div>
  <!--End Page Title -->
  <div class="Content_Wrapper">
    <!-- code detail -->
    <div class="code-top-detail clearfix row">
      <div class="col-md-8">
        <div class="row">
          <div class="col-md-1">
            <div class="rating f big">
              F
            </div>
          </div>
          <div class="code-statistics col-md-11">
            <div class="col-md-3">
              <div><span class="metric">759</span><small> lines of codes</small></div>
              <div><span class="metric">41</span><small> methods</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">10.7</span><small> complexity/method</small></div>
              <div><span class="metric">16</span><small> churn</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">436.85</span><small> complexity</small></div>
              <div><span class="metric">122</span><small> duplications</small></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="code-tabs">
          <ul class="nav nav-pills right-to-left">
            <li><a href="#" id="toggle-code" class="toggle-button button">code</a></li>
            <li class="active">
              <a href="#" id="toggle-smells" class="toggle-button button">
                110
                smells
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <code class="prettyprint linenums lang-ruby file-code js-file-code">module Bosh::Director::Links
  class LinksParser<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Instance-Variable-Assumption.md" target="_blank"><b>InstanceVariableAssumption</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser assumes too much for instance variable '@links_manager'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Irresponsible-Module.md" target="_blank"><b>IrresponsibleModule</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser has no descriptive comment</span>          </div>  </li></ol>
    include Bosh::Director::ValidationHelper

    MANUAL_LINK_KEYS = %w[instances properties address].freeze

    class LinkProvidersParser<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Instance-Variable-Assumption.md" target="_blank"><b>InstanceVariableAssumption</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser assumes too much for instance variable '@links_manager'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Irresponsible-Module.md" target="_blank"><b>IrresponsibleModule</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser has no descriptive comment</span>          </div>  </li></ol>
      include Bosh::Director::ValidationHelper
      def initialize
        @logger = Bosh::Director::Config.logger
        @link_helper = LinkHelpers.new
      end

      def parse_migrated_from_providers_from_job(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#parse_migrated_from_providers_from_job has 4 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#parse_migrated_from_providers_from_job has approx 8 statements</span>          </div>  </li></ol>
        manifest_job_spec, deployment_model, current_template_model, manifest_details = {}
      )
        job_properties = manifest_details.fetch(:job_properties, {})<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#parse_migrated_from_providers_from_job refers to 'manifest_details' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L17" class="js-smell-location">0</a>                  <a href="links_parser.html#L18" class="js-smell-location">1</a>                  <a href="links_parser.html#L19" class="js-smell-location">2</a>                  </div>  </li></ol>
        instance_group_name = manifest_details.fetch(:instance_group_name, nil)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#parse_migrated_from_providers_from_job refers to 'manifest_details' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L17" class="js-smell-location">0</a>                  <a href="links_parser.html#L18" class="js-smell-location">1</a>                  <a href="links_parser.html#L19" class="js-smell-location">2</a>                  </div>  </li></ol>
        migrated_from = manifest_details.fetch(:migrated_from, [])<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#parse_migrated_from_providers_from_job refers to 'manifest_details' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L17" class="js-smell-location">0</a>                  <a href="links_parser.html#L18" class="js-smell-location">1</a>                  <a href="links_parser.html#L19" class="js-smell-location">2</a>                  </div>  </li></ol>

        migrated_from.each do |migration_block|
          # old_instance_group_name = migration_block[&#39;name&#39;]
          job_name = safe_property(manifest_job_spec, &#39;name&#39;, class: String)

          providers = Bosh::Director::Models::Links::LinkProvider.find(
            deployment: deployment_model,
            instance_group: migration_block[&#39;name&#39;],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#parse_migrated_from_providers_from_job calls 'migration_block['name']' 2 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L27" class="js-smell-location">0</a>                  <a href="links_parser.html#L32" class="js-smell-location">1</a>                  </div>  </li></ol>
            name: job_name,
            type: &#39;job&#39;,
          )

          instance_group_name = migration_block[&#39;name&#39;] unless providers.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#parse_migrated_from_providers_from_job calls 'migration_block['name']' 2 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L27" class="js-smell-location">0</a>                  <a href="links_parser.html#L32" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#parse_migrated_from_providers_from_job performs a nil-check</span>          </div>  </li></ol>
        end

        parse_providers_from_job(
          manifest_job_spec,
          deployment_model,
          current_template_model,
          job_properties: job_properties,
          instance_group_name: instance_group_name,
        )
      end

      def parse_providers_from_job(manifest_job_spec, deployment_model, current_release_template_model, manifest_details = {})<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#parse_providers_from_job has a flog score of 29</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#parse_providers_from_job has 4 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#parse_providers_from_job has approx 15 statements</span>          </div>  </li></ol>
        job_properties = manifest_details.fetch(:job_properties, {})
        instance_group_name = manifest_details.fetch(:instance_group_name, nil)
        @links_manager = Bosh::Director::Links::LinksManager.new(deployment_model.links_serial_id)

        manifest_provides_links = Bosh::Common::DeepCopy.copy(safe_property(manifest_job_spec, &#39;provides&#39;,
                                                                            class: Hash, optional: true, default: {}))
        custom_manifest_providers = Bosh::Common::DeepCopy.copy(safe_property(manifest_job_spec, &#39;custom_provider_definitions&#39;,
                                                                              class: Array, optional: true, default: []))
        job_name = safe_property(manifest_job_spec, &#39;name&#39;, class: String)

        @link_helper.validate_custom_providers(custom_manifest_providers, current_release_template_model.provides, job_name,
                                               instance_group_name, current_release_template_model.release.name)

        errors = []

        errors.concat(
          process_custom_providers(
            current_release_template_model,
            custom_manifest_providers,
            manifest_provides_links,
            deployment_model,
            job_properties: job_properties,
            instance_group_name: instance_group_name,
          ),
        )
        errors.concat(process_release_providers(current_release_template_model, manifest_provides_links, deployment_model,
                                                instance_group_name, job_properties))

        unless manifest_provides_links.empty?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="links_parser.html#L73" class="js-smell-location">0</a>                  <a href="links_parser.html#L303" class="js-smell-location">1</a>                  </div>  </li></ol>
          warning = &#39;Manifest defines unknown providers:&#39;
          manifest_provides_links.each_key do |link_name|
            warning &lt;&lt; &quot;\n  - Job &#39;#{job_name}&#39; does not define link provider &#39;#{link_name}&#39; in the release spec&quot;
          end
          @logger.warn(warning)
        end

        raise errors.join(&quot;\n&quot;) unless errors.empty?
      end

      def parse_provider_from_disk(disk_spec, deployment_model, instance_group_name)
        @links_manager = Bosh::Director::Links::LinksManager.new(deployment_model.links_serial_id)

        disk_name = disk_spec[&#39;name&#39;] # All the parsing we need

        provider = @links_manager.find_or_create_provider(
          deployment_model: deployment_model,
          instance_group_name: instance_group_name,
          name: instance_group_name,
          type: &#39;disk&#39;,
        )

        create_disk_provider_intent(deployment_model, disk_name, provider)
      end

      private

      def create_disk_provider_intent(deployment_model, disk_name, provider)
        provider_intent = @links_manager.find_or_create_provider_intent(
          link_provider: provider,
          link_original_name: disk_name,
          link_type: &#39;disk&#39;,
        )

        provider_intent.shared = false<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#create_disk_provider_intent refers to 'provider_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L108" class="js-smell-location">0</a>                  <a href="links_parser.html#L109" class="js-smell-location">1</a>                  <a href="links_parser.html#L110" class="js-smell-location">2</a>                  <a href="links_parser.html#L111" class="js-smell-location">3</a>                  </div>  </li></ol>
        provider_intent.name = disk_name<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#create_disk_provider_intent refers to 'provider_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L108" class="js-smell-location">0</a>                  <a href="links_parser.html#L109" class="js-smell-location">1</a>                  <a href="links_parser.html#L110" class="js-smell-location">2</a>                  <a href="links_parser.html#L111" class="js-smell-location">3</a>                  </div>  </li></ol>
        provider_intent.content = Bosh::Director::DeploymentPlan::DiskLink.new(deployment_model.name, disk_name).spec.to_json<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#create_disk_provider_intent refers to 'provider_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L108" class="js-smell-location">0</a>                  <a href="links_parser.html#L109" class="js-smell-location">1</a>                  <a href="links_parser.html#L110" class="js-smell-location">2</a>                  <a href="links_parser.html#L111" class="js-smell-location">3</a>                  </div>  </li></ol>
        provider_intent.save<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#create_disk_provider_intent refers to 'provider_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L108" class="js-smell-location">0</a>                  <a href="links_parser.html#L109" class="js-smell-location">1</a>                  <a href="links_parser.html#L110" class="js-smell-location">2</a>                  <a href="links_parser.html#L111" class="js-smell-location">3</a>                  </div>  </li></ol>
      end

      def process_providers(release_properties, provider_definitions, manifest_provides_links, deployment_model, job_details = {})<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_providers has 5 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_providers has approx 7 statements</span>          </div>  </li></ol>
        job_properties = job_details.fetch(:job_properties, {})<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_providers refers to 'job_details' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L115" class="js-smell-location">0</a>                  <a href="links_parser.html#L116" class="js-smell-location">1</a>                  <a href="links_parser.html#L117" class="js-smell-location">2</a>                  <a href="links_parser.html#L118" class="js-smell-location">3</a>                  </div>  </li></ol>
        instance_group_name = job_details.fetch(:instance_group_name, nil)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_providers refers to 'job_details' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L115" class="js-smell-location">0</a>                  <a href="links_parser.html#L116" class="js-smell-location">1</a>                  <a href="links_parser.html#L117" class="js-smell-location">2</a>                  <a href="links_parser.html#L118" class="js-smell-location">3</a>                  </div>  </li></ol>
        job_name = job_details.fetch(:job_name, nil)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_providers refers to 'job_details' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L115" class="js-smell-location">0</a>                  <a href="links_parser.html#L116" class="js-smell-location">1</a>                  <a href="links_parser.html#L117" class="js-smell-location">2</a>                  <a href="links_parser.html#L118" class="js-smell-location">3</a>                  </div>  </li></ol>
        are_custom_definitions = job_details.fetch(:are_custom_definitions, false)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_providers refers to 'job_details' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L115" class="js-smell-location">0</a>                  <a href="links_parser.html#L116" class="js-smell-location">1</a>                  <a href="links_parser.html#L117" class="js-smell-location">2</a>                  <a href="links_parser.html#L118" class="js-smell-location">3</a>                  </div>  </li></ol>

        provider = @links_manager.find_or_create_provider(
          deployment_model: deployment_model,
          instance_group_name: instance_group_name,
          name: job_name,
          type: &#39;job&#39;,
        )

        errors = process_provider_definitions(
          manifest_provides_links,
          provider,
          provider_definitions,
          release_properties,
          are_custom_definitions: are_custom_definitions,
          instance_group_name: instance_group_name,
          job_name: job_name,
          job_properties: job_properties,
        )
        errors
      end

      def process_provider_definitions(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_provider_definitions has a flog score of 30</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_provider_definitions has 5 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_provider_definitions has approx 14 statements</span>          </div>  </li></ol>
        manifest_provides_links,
        provider,
        provider_definitions,
        release_properties,
        manifest_details = {}
      )
        are_custom_definitions, instance_group_name, job_name, job_properties =
          @link_helper.extract_provider_definition_properties(manifest_details)
        errors = []

        provider_definitions.each do |provider_definition|
          provider_intent_params = {
            original_name: provider_definition[&#39;name&#39;],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_provider_definitions calls 'provider_definition['name']' 5 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L153" class="js-smell-location">0</a>                  <a href="links_parser.html#L155" class="js-smell-location">1</a>                  <a href="links_parser.html#L160" class="js-smell-location">2</a>                  <a href="links_parser.html#L161" class="js-smell-location">3</a>                  <a href="links_parser.html#L164" class="js-smell-location">4</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_provider_definitions refers to 'provider_definition' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L153" class="js-smell-location">0</a>                  <a href="links_parser.html#L154" class="js-smell-location">1</a>                  <a href="links_parser.html#L155" class="js-smell-location">2</a>                  <a href="links_parser.html#L160" class="js-smell-location">3</a>                  <a href="links_parser.html#L161" class="js-smell-location">4</a>                  <a href="links_parser.html#L164" class="js-smell-location">5</a>                  <a href="links_parser.html#L173" class="js-smell-location">6</a>                  </div>  </li></ol>
            type: provider_definition[&#39;type&#39;],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_provider_definitions refers to 'provider_definition' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L153" class="js-smell-location">0</a>                  <a href="links_parser.html#L154" class="js-smell-location">1</a>                  <a href="links_parser.html#L155" class="js-smell-location">2</a>                  <a href="links_parser.html#L160" class="js-smell-location">3</a>                  <a href="links_parser.html#L161" class="js-smell-location">4</a>                  <a href="links_parser.html#L164" class="js-smell-location">5</a>                  <a href="links_parser.html#L173" class="js-smell-location">6</a>                  </div>  </li></ol>
            alias: provider_definition[&#39;name&#39;],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_provider_definitions calls 'provider_definition['name']' 5 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L153" class="js-smell-location">0</a>                  <a href="links_parser.html#L155" class="js-smell-location">1</a>                  <a href="links_parser.html#L160" class="js-smell-location">2</a>                  <a href="links_parser.html#L161" class="js-smell-location">3</a>                  <a href="links_parser.html#L164" class="js-smell-location">4</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_provider_definitions refers to 'provider_definition' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L153" class="js-smell-location">0</a>                  <a href="links_parser.html#L154" class="js-smell-location">1</a>                  <a href="links_parser.html#L155" class="js-smell-location">2</a>                  <a href="links_parser.html#L160" class="js-smell-location">3</a>                  <a href="links_parser.html#L161" class="js-smell-location">4</a>                  <a href="links_parser.html#L164" class="js-smell-location">5</a>                  <a href="links_parser.html#L173" class="js-smell-location">6</a>                  </div>  </li></ol>
            shared: false,
            consumable: true,
          }

          if manifest_provides_links.key?(provider_definition[&#39;name&#39;])<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_provider_definitions calls 'provider_definition['name']' 5 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L153" class="js-smell-location">0</a>                  <a href="links_parser.html#L155" class="js-smell-location">1</a>                  <a href="links_parser.html#L160" class="js-smell-location">2</a>                  <a href="links_parser.html#L161" class="js-smell-location">3</a>                  <a href="links_parser.html#L164" class="js-smell-location">4</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_provider_definitions refers to 'provider_definition' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L153" class="js-smell-location">0</a>                  <a href="links_parser.html#L154" class="js-smell-location">1</a>                  <a href="links_parser.html#L155" class="js-smell-location">2</a>                  <a href="links_parser.html#L160" class="js-smell-location">3</a>                  <a href="links_parser.html#L161" class="js-smell-location">4</a>                  <a href="links_parser.html#L164" class="js-smell-location">5</a>                  <a href="links_parser.html#L173" class="js-smell-location">6</a>                  </div>  </li></ol>
            manifest_source = manifest_provides_links.delete(provider_definition[&#39;name&#39;])<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_provider_definitions calls 'provider_definition['name']' 5 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L153" class="js-smell-location">0</a>                  <a href="links_parser.html#L155" class="js-smell-location">1</a>                  <a href="links_parser.html#L160" class="js-smell-location">2</a>                  <a href="links_parser.html#L161" class="js-smell-location">3</a>                  <a href="links_parser.html#L164" class="js-smell-location">4</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_provider_definitions refers to 'provider_definition' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L153" class="js-smell-location">0</a>                  <a href="links_parser.html#L154" class="js-smell-location">1</a>                  <a href="links_parser.html#L155" class="js-smell-location">2</a>                  <a href="links_parser.html#L160" class="js-smell-location">3</a>                  <a href="links_parser.html#L161" class="js-smell-location">4</a>                  <a href="links_parser.html#L164" class="js-smell-location">5</a>                  <a href="links_parser.html#L173" class="js-smell-location">6</a>                  </div>  </li></ol>

            validation_errors = @link_helper.validate_provide_link(
              manifest_source, provider_definition[&#39;name&#39;], job_name, instance_group_name<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_provider_definitions calls 'provider_definition['name']' 5 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L153" class="js-smell-location">0</a>                  <a href="links_parser.html#L155" class="js-smell-location">1</a>                  <a href="links_parser.html#L160" class="js-smell-location">2</a>                  <a href="links_parser.html#L161" class="js-smell-location">3</a>                  <a href="links_parser.html#L164" class="js-smell-location">4</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_provider_definitions refers to 'provider_definition' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L153" class="js-smell-location">0</a>                  <a href="links_parser.html#L154" class="js-smell-location">1</a>                  <a href="links_parser.html#L155" class="js-smell-location">2</a>                  <a href="links_parser.html#L160" class="js-smell-location">3</a>                  <a href="links_parser.html#L161" class="js-smell-location">4</a>                  <a href="links_parser.html#L164" class="js-smell-location">5</a>                  <a href="links_parser.html#L173" class="js-smell-location">6</a>                  </div>  </li></ol>
            )
            errors.concat(validation_errors)
            next unless validation_errors.empty?

            provider_intent_params = @link_helper.generate_provider_intent_params(manifest_source, provider_intent_params)
          end

          mapped_properties, properties_errors = @link_helper.process_link_properties(
            job_properties, provider_definition[&#39;properties&#39;], release_properties, job_name<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_provider_definitions refers to 'provider_definition' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L153" class="js-smell-location">0</a>                  <a href="links_parser.html#L154" class="js-smell-location">1</a>                  <a href="links_parser.html#L155" class="js-smell-location">2</a>                  <a href="links_parser.html#L160" class="js-smell-location">3</a>                  <a href="links_parser.html#L161" class="js-smell-location">4</a>                  <a href="links_parser.html#L164" class="js-smell-location">5</a>                  <a href="links_parser.html#L173" class="js-smell-location">6</a>                  </div>  </li></ol>
          )
          errors.concat(properties_errors)

          next unless properties_errors.empty?

          create_provider_intent(are_custom_definitions, mapped_properties, provider, provider_intent_params)
        end
        errors
      end

      def create_provider_intent(are_custom_definitions, mapped_properties, provider, provider_intent_params)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#create_provider_intent has 4 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#create_provider_intent has approx 7 statements</span>          </div>  </li></ol>
        provider_intent = @links_manager.find_or_create_provider_intent(
          link_provider: provider,
          link_original_name: provider_intent_params[:original_name],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#create_provider_intent refers to 'provider_intent_params' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L187" class="js-smell-location">0</a>                  <a href="links_parser.html#L188" class="js-smell-location">1</a>                  <a href="links_parser.html#L191" class="js-smell-location">2</a>                  <a href="links_parser.html#L192" class="js-smell-location">3</a>                  <a href="links_parser.html#L195" class="js-smell-location">4</a>                  </div>  </li></ol>
          link_type: provider_intent_params[:type],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#create_provider_intent refers to 'provider_intent_params' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L187" class="js-smell-location">0</a>                  <a href="links_parser.html#L188" class="js-smell-location">1</a>                  <a href="links_parser.html#L191" class="js-smell-location">2</a>                  <a href="links_parser.html#L192" class="js-smell-location">3</a>                  <a href="links_parser.html#L195" class="js-smell-location">4</a>                  </div>  </li></ol>
        )

        provider_intent.name = provider_intent_params[:alias]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#create_provider_intent refers to 'provider_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L191" class="js-smell-location">0</a>                  <a href="links_parser.html#L192" class="js-smell-location">1</a>                  <a href="links_parser.html#L194" class="js-smell-location">2</a>                  <a href="links_parser.html#L195" class="js-smell-location">3</a>                  <a href="links_parser.html#L196" class="js-smell-location">4</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#create_provider_intent refers to 'provider_intent_params' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L187" class="js-smell-location">0</a>                  <a href="links_parser.html#L188" class="js-smell-location">1</a>                  <a href="links_parser.html#L191" class="js-smell-location">2</a>                  <a href="links_parser.html#L192" class="js-smell-location">3</a>                  <a href="links_parser.html#L195" class="js-smell-location">4</a>                  </div>  </li></ol>
        provider_intent.shared = provider_intent_params[:shared]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#create_provider_intent refers to 'provider_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L191" class="js-smell-location">0</a>                  <a href="links_parser.html#L192" class="js-smell-location">1</a>                  <a href="links_parser.html#L194" class="js-smell-location">2</a>                  <a href="links_parser.html#L195" class="js-smell-location">3</a>                  <a href="links_parser.html#L196" class="js-smell-location">4</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#create_provider_intent refers to 'provider_intent_params' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L187" class="js-smell-location">0</a>                  <a href="links_parser.html#L188" class="js-smell-location">1</a>                  <a href="links_parser.html#L191" class="js-smell-location">2</a>                  <a href="links_parser.html#L192" class="js-smell-location">3</a>                  <a href="links_parser.html#L195" class="js-smell-location">4</a>                  </div>  </li></ol>
        is_custom = are_custom_definitions || false<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Control-Parameter.md" target="_blank"><b>ControlParameter</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#create_provider_intent is controlled by argument 'are_custom_definitions'</span>          </div>  </li></ol>
        provider_intent.metadata = { mapped_properties: mapped_properties, custom: is_custom }.to_json<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#create_provider_intent refers to 'provider_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L191" class="js-smell-location">0</a>                  <a href="links_parser.html#L192" class="js-smell-location">1</a>                  <a href="links_parser.html#L194" class="js-smell-location">2</a>                  <a href="links_parser.html#L195" class="js-smell-location">3</a>                  <a href="links_parser.html#L196" class="js-smell-location">4</a>                  </div>  </li></ol>
        provider_intent.consumable = provider_intent_params[:consumable]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#create_provider_intent refers to 'provider_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L191" class="js-smell-location">0</a>                  <a href="links_parser.html#L192" class="js-smell-location">1</a>                  <a href="links_parser.html#L194" class="js-smell-location">2</a>                  <a href="links_parser.html#L195" class="js-smell-location">3</a>                  <a href="links_parser.html#L196" class="js-smell-location">4</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#create_provider_intent refers to 'provider_intent_params' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L187" class="js-smell-location">0</a>                  <a href="links_parser.html#L188" class="js-smell-location">1</a>                  <a href="links_parser.html#L191" class="js-smell-location">2</a>                  <a href="links_parser.html#L192" class="js-smell-location">3</a>                  <a href="links_parser.html#L195" class="js-smell-location">4</a>                  </div>  </li></ol>
        provider_intent.save<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#create_provider_intent refers to 'provider_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L191" class="js-smell-location">0</a>                  <a href="links_parser.html#L192" class="js-smell-location">1</a>                  <a href="links_parser.html#L194" class="js-smell-location">2</a>                  <a href="links_parser.html#L195" class="js-smell-location">3</a>                  <a href="links_parser.html#L196" class="js-smell-location">4</a>                  </div>  </li></ol>
      end

      def process_custom_providers(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_custom_providers has 5 parameters</span>          </div>  </li></ol>
        current_release_template_model,
        custom_manifest_providers,
        manifest_provides_links,
        deployment_model,
        manifest_details = {}
      )
        job_properties = manifest_details.fetch(:job_properties, {})<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_custom_providers refers to 'manifest_details' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L206" class="js-smell-location">0</a>                  <a href="links_parser.html#L207" class="js-smell-location">1</a>                  </div>  </li></ol>
        instance_group_name = manifest_details.fetch(:instance_group_name, nil)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_custom_providers refers to 'manifest_details' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L206" class="js-smell-location">0</a>                  <a href="links_parser.html#L207" class="js-smell-location">1</a>                  </div>  </li></ol>
        return [] if custom_manifest_providers.empty?

        process_providers(
          current_release_template_model.properties,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_custom_providers refers to 'current_release_template_model' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L211" class="js-smell-location">0</a>                  <a href="links_parser.html#L217" class="js-smell-location">1</a>                  </div>  </li></ol>
          custom_manifest_providers,
          manifest_provides_links,
          deployment_model,
          job_properties: job_properties,
          instance_group_name: instance_group_name,
          job_name: current_release_template_model.name,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_custom_providers refers to 'current_release_template_model' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L211" class="js-smell-location">0</a>                  <a href="links_parser.html#L217" class="js-smell-location">1</a>                  </div>  </li></ol>
          are_custom_definitions: true,
        )
      end

      def process_release_providers(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_release_providers has 5 parameters</span>          </div>  </li></ol>
        current_release_template_model,
        manifest_provides_links,
        deployment_model,
        instance_group_name,
        job_properties
      )
        job_name = current_release_template_model.name<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_release_providers refers to 'current_release_template_model' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L229" class="js-smell-location">0</a>                  <a href="links_parser.html#L231" class="js-smell-location">1</a>                  <a href="links_parser.html#L234" class="js-smell-location">2</a>                  <a href="links_parser.html#L235" class="js-smell-location">3</a>                  </div>  </li></ol>

        return [] if current_release_template_model.provides.empty?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_release_providers calls 'current_release_template_model.provides' 2 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L231" class="js-smell-location">0</a>                  <a href="links_parser.html#L235" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_release_providers refers to 'current_release_template_model' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L229" class="js-smell-location">0</a>                  <a href="links_parser.html#L231" class="js-smell-location">1</a>                  <a href="links_parser.html#L234" class="js-smell-location">2</a>                  <a href="links_parser.html#L235" class="js-smell-location">3</a>                  </div>  </li></ol>

        process_providers(
          current_release_template_model.properties,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_release_providers refers to 'current_release_template_model' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L229" class="js-smell-location">0</a>                  <a href="links_parser.html#L231" class="js-smell-location">1</a>                  <a href="links_parser.html#L234" class="js-smell-location">2</a>                  <a href="links_parser.html#L235" class="js-smell-location">3</a>                  </div>  </li></ol>
          current_release_template_model.provides,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_release_providers calls 'current_release_template_model.provides' 2 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L231" class="js-smell-location">0</a>                  <a href="links_parser.html#L235" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkProvidersParser#process_release_providers refers to 'current_release_template_model' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L229" class="js-smell-location">0</a>                  <a href="links_parser.html#L231" class="js-smell-location">1</a>                  <a href="links_parser.html#L234" class="js-smell-location">2</a>                  <a href="links_parser.html#L235" class="js-smell-location">3</a>                  </div>  </li></ol>
          manifest_provides_links,
          deployment_model,
          job_properties: job_properties,
          instance_group_name: instance_group_name,
          job_name: job_name,
          are_custom_definitions: false,
        )
      end
    end

    class LinkConsumersParser<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Instance-Variable-Assumption.md" target="_blank"><b>InstanceVariableAssumption</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser assumes too much for instance variable '@links_manager'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Irresponsible-Module.md" target="_blank"><b>IrresponsibleModule</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser has no descriptive comment</span>          </div>  </li></ol>
      include Bosh::Director::ValidationHelper
      def initialize
        @logger = Bosh::Director::Config.logger
        @link_helper = LinkHelpers.new
      end

      def parse_migrated_from_consumers_from_job(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Data-Clump.md" target="_blank"><b>DataClump</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser takes parameters ['current_release_template_model', 'deployment_model'] to 3 methods</span>              <span>Locations:</span>                  <a href="links_parser.html#L253" class="js-smell-location">0</a>                  <a href="links_parser.html#L280" class="js-smell-location">1</a>                  <a href="links_parser.html#L316" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#parse_migrated_from_consumers_from_job has 4 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#parse_migrated_from_consumers_from_job has approx 8 statements</span>          </div>  </li></ol>
        manifest_job_spec, deployment_model, current_release_template_model, instance_group_details = {}
      )
        instance_group_name = instance_group_details.fetch(:instance_group_name, nil)
        migrated_from = instance_group_details.fetch(:migrated_from, [])
        migrated_from.each do |migration_block|
          old_instance_group_name = migration_block[&#39;name&#39;]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#parse_migrated_from_consumers_from_job calls 'migration_block['name']' 2 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L259" class="js-smell-location">0</a>                  <a href="links_parser.html#L269" class="js-smell-location">1</a>                  </div>  </li></ol>
          job_name = safe_property(manifest_job_spec, &#39;name&#39;, class: String)

          consumers = Bosh::Director::Models::Links::LinkConsumer.find(
            deployment: deployment_model,
            instance_group: old_instance_group_name,
            name: job_name,
            type: &#39;job&#39;,
          )

          instance_group_name = migration_block[&#39;name&#39;] unless consumers.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#parse_migrated_from_consumers_from_job calls 'migration_block['name']' 2 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L259" class="js-smell-location">0</a>                  <a href="links_parser.html#L269" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#parse_migrated_from_consumers_from_job performs a nil-check</span>          </div>  </li></ol>
        end

        parse_consumers_from_job(
          manifest_job_spec,
          deployment_model,
          current_release_template_model,
          instance_group_name: instance_group_name,
        )
      end

      def parse_consumers_from_job(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Data-Clump.md" target="_blank"><b>DataClump</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser takes parameters ['current_release_template_model', 'deployment_model'] to 3 methods</span>              <span>Locations:</span>                  <a href="links_parser.html#L253" class="js-smell-location">0</a>                  <a href="links_parser.html#L280" class="js-smell-location">1</a>                  <a href="links_parser.html#L316" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#parse_consumers_from_job has 4 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#parse_consumers_from_job has approx 11 statements</span>          </div>  </li></ol>
        manifest_job_spec, deployment_model, current_release_template_model, instance_group_details = {}
      )
        instance_group_name = instance_group_details.fetch(:instance_group_name, nil)
        @links_manager = Bosh::Director::Links::LinksManager.new(deployment_model.links_serial_id)

        consumes_links = Bosh::Common::DeepCopy.copy(safe_property(manifest_job_spec, &#39;consumes&#39;,
                                                                   class: Hash, optional: true, default: {}))
        job_name = safe_property(manifest_job_spec, &#39;name&#39;, class: String)

        errors = []
        unless current_release_template_model.consumes.empty?
          errors.concat(
            process_release_template_consumes(
              consumes_links,
              current_release_template_model,
              deployment_model,
              instance_group_name,
              job_name,
            ),
          )
        end

        unless consumes_links.empty?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="links_parser.html#L73" class="js-smell-location">0</a>                  <a href="links_parser.html#L303" class="js-smell-location">1</a>                  </div>  </li></ol>
          warning = &#39;Manifest defines unknown consumers:&#39;
          consumes_links.each_key do |link_name|
            warning &lt;&lt; &quot;\n  - Job &#39;#{job_name}&#39; does not define link consumer &#39;#{link_name}&#39; in the release spec&quot;
          end
          @logger.warn(warning)
        end

        raise errors.join(&quot;\n&quot;) unless errors.empty?
      end

      private

      def process_release_template_consumes(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Data-Clump.md" target="_blank"><b>DataClump</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser takes parameters ['current_release_template_model', 'deployment_model'] to 3 methods</span>              <span>Locations:</span>                  <a href="links_parser.html#L253" class="js-smell-location">0</a>                  <a href="links_parser.html#L280" class="js-smell-location">1</a>                  <a href="links_parser.html#L316" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#process_release_template_consumes has 5 parameters</span>          </div>  </li></ol>
        consumes_links, current_release_template_model, deployment_model, instance_group_name, job_name
      )
        consumer = @links_manager.find_or_create_consumer(
          deployment_model: deployment_model,
          instance_group_name: instance_group_name,
          name: job_name,
          type: &#39;job&#39;,
        )

        errors = create_consumer_intent_from_template_model(
          consumer, consumes_links, current_release_template_model, instance_group_name, job_name
        )
        errors
      end

      def create_consumer_intent_from_template_model(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#create_consumer_intent_from_template_model has 5 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#create_consumer_intent_from_template_model has approx 10 statements</span>          </div>  </li></ol>
        consumer, consumes_links, current_release_template_model, instance_group_name, job_name
      )
        errors = []
        current_release_template_model.consumes.each do |consumes|
          metadata = {}
          consumer_intent_params = {
            original_name: consumes[&#39;name&#39;],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#create_consumer_intent_from_template_model calls 'consumes['name']' 4 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L339" class="js-smell-location">0</a>                  <a href="links_parser.html#L340" class="js-smell-location">1</a>                  <a href="links_parser.html#L345" class="js-smell-location">2</a>                  <a href="links_parser.html#L353" class="js-smell-location">3</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#create_consumer_intent_from_template_model refers to 'consumes' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L339" class="js-smell-location">0</a>                  <a href="links_parser.html#L340" class="js-smell-location">1</a>                  <a href="links_parser.html#L342" class="js-smell-location">2</a>                  <a href="links_parser.html#L345" class="js-smell-location">3</a>                  <a href="links_parser.html#L353" class="js-smell-location">4</a>                  </div>  </li></ol>
            alias: consumes[&#39;name&#39;],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#create_consumer_intent_from_template_model calls 'consumes['name']' 4 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L339" class="js-smell-location">0</a>                  <a href="links_parser.html#L340" class="js-smell-location">1</a>                  <a href="links_parser.html#L345" class="js-smell-location">2</a>                  <a href="links_parser.html#L353" class="js-smell-location">3</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#create_consumer_intent_from_template_model refers to 'consumes' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L339" class="js-smell-location">0</a>                  <a href="links_parser.html#L340" class="js-smell-location">1</a>                  <a href="links_parser.html#L342" class="js-smell-location">2</a>                  <a href="links_parser.html#L345" class="js-smell-location">3</a>                  <a href="links_parser.html#L353" class="js-smell-location">4</a>                  </div>  </li></ol>
            blocked: false,
            type: consumes[&#39;type&#39;],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#create_consumer_intent_from_template_model refers to 'consumes' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L339" class="js-smell-location">0</a>                  <a href="links_parser.html#L340" class="js-smell-location">1</a>                  <a href="links_parser.html#L342" class="js-smell-location">2</a>                  <a href="links_parser.html#L345" class="js-smell-location">3</a>                  <a href="links_parser.html#L353" class="js-smell-location">4</a>                  </div>  </li></ol>
          }

          if !consumes_links.key?(consumes[&#39;name&#39;])<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#create_consumer_intent_from_template_model calls 'consumes['name']' 4 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L339" class="js-smell-location">0</a>                  <a href="links_parser.html#L340" class="js-smell-location">1</a>                  <a href="links_parser.html#L345" class="js-smell-location">2</a>                  <a href="links_parser.html#L353" class="js-smell-location">3</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#create_consumer_intent_from_template_model refers to 'consumes' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L339" class="js-smell-location">0</a>                  <a href="links_parser.html#L340" class="js-smell-location">1</a>                  <a href="links_parser.html#L342" class="js-smell-location">2</a>                  <a href="links_parser.html#L345" class="js-smell-location">3</a>                  <a href="links_parser.html#L353" class="js-smell-location">4</a>                  </div>  </li></ol>
            metadata[:explicit_link] = false
          else
            consumer_intent_params, metadata, err = generate_explicit_link_metadata(
              consumer,
              consumer_intent_params,
              consumes_links,
              metadata,
              consumed_link_original_name: consumes[&#39;name&#39;],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#create_consumer_intent_from_template_model calls 'consumes['name']' 4 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L339" class="js-smell-location">0</a>                  <a href="links_parser.html#L340" class="js-smell-location">1</a>                  <a href="links_parser.html#L345" class="js-smell-location">2</a>                  <a href="links_parser.html#L353" class="js-smell-location">3</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#create_consumer_intent_from_template_model refers to 'consumes' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L339" class="js-smell-location">0</a>                  <a href="links_parser.html#L340" class="js-smell-location">1</a>                  <a href="links_parser.html#L342" class="js-smell-location">2</a>                  <a href="links_parser.html#L345" class="js-smell-location">3</a>                  <a href="links_parser.html#L353" class="js-smell-location">4</a>                  </div>  </li></ol>
              job_name: job_name,
              instance_group_name: instance_group_name,
            )
            unless err.empty?
              errors.concat(err)
              next
            end
          end

          create_consumer_intent(consumer, consumer_intent_params, consumes, metadata)
        end
        errors
      end

      def generate_explicit_link_metadata(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#generate_explicit_link_metadata has a flog score of 25</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Data-Clump.md" target="_blank"><b>DataClump</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser takes parameters ['consumer_intent_params', 'metadata'] to 3 methods</span>              <span>Locations:</span>                  <a href="links_parser.html#L368" class="js-smell-location">0</a>                  <a href="links_parser.html#L407" class="js-smell-location">1</a>                  <a href="links_parser.html#L421" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#generate_explicit_link_metadata has 5 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#generate_explicit_link_metadata has approx 17 statements</span>          </div>  </li></ol>
        consumer, consumer_intent_params, consumes_links, metadata, names = {}
      )
        consumed_link_original_name = names.fetch(:consumed_link_original_name, nil)
        job_name = names.fetch(:job_name, nil)
        instance_group_name = names.fetch(:instance_group_name, nil)

        errors = []
        manifest_source = consumes_links.delete(consumed_link_original_name)

        new_errors = @link_helper.validate_consume_link(
          manifest_source, consumed_link_original_name, job_name, instance_group_name
        )
        errors.concat(new_errors)
        return consumer_intent_params, metadata, errors unless new_errors.empty?

        metadata[:explicit_link] = true

        if manifest_source.eql? &#39;nil&#39;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#generate_explicit_link_metadata refers to 'manifest_source' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L386" class="js-smell-location">0</a>                  <a href="links_parser.html#L392" class="js-smell-location">1</a>                  <a href="links_parser.html#L393" class="js-smell-location">2</a>                  <a href="links_parser.html#L394" class="js-smell-location">3</a>                  </div>  </li></ol>
          consumer_intent_params[:blocked] = true
        elsif @link_helper.manual_link? manifest_source
          metadata[:manual_link] = true
          process_manual_link(consumer, consumer_intent_params, manifest_source)
        else
          consumer_intent_params[:alias] = manifest_source.fetch(&#39;from&#39;, consumer_intent_params[:alias])<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#generate_explicit_link_metadata refers to 'manifest_source' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L386" class="js-smell-location">0</a>                  <a href="links_parser.html#L392" class="js-smell-location">1</a>                  <a href="links_parser.html#L393" class="js-smell-location">2</a>                  <a href="links_parser.html#L394" class="js-smell-location">3</a>                  </div>  </li></ol>
          metadata[:ip_addresses] = manifest_source[&#39;ip_addresses&#39;] if manifest_source.key?(&#39;ip_addresses&#39;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#generate_explicit_link_metadata refers to 'manifest_source' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L386" class="js-smell-location">0</a>                  <a href="links_parser.html#L392" class="js-smell-location">1</a>                  <a href="links_parser.html#L393" class="js-smell-location">2</a>                  <a href="links_parser.html#L394" class="js-smell-location">3</a>                  </div>  </li></ol>
          metadata[:network] = manifest_source[&#39;network&#39;] if manifest_source.key?(&#39;network&#39;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#generate_explicit_link_metadata refers to 'manifest_source' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L386" class="js-smell-location">0</a>                  <a href="links_parser.html#L392" class="js-smell-location">1</a>                  <a href="links_parser.html#L393" class="js-smell-location">2</a>                  <a href="links_parser.html#L394" class="js-smell-location">3</a>                  </div>  </li></ol>
          validate_consumes_deployment(
            consumer_intent_params,
            errors,
            manifest_source,
            metadata,
            instance_group_name: instance_group_name,
            job_name: job_name,
          )
        end
        [consumer_intent_params, metadata, errors]
      end

      def validate_consumes_deployment(consumer_intent_params, errors, manifest_source, metadata, instance_group_details = {})<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Data-Clump.md" target="_blank"><b>DataClump</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser takes parameters ['consumer_intent_params', 'metadata'] to 3 methods</span>              <span>Locations:</span>                  <a href="links_parser.html#L368" class="js-smell-location">0</a>                  <a href="links_parser.html#L407" class="js-smell-location">1</a>                  <a href="links_parser.html#L421" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#validate_consumes_deployment has 5 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#validate_consumes_deployment has approx 7 statements</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#validate_consumes_deployment doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
        return unless manifest_source[&#39;deployment&#39;]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#validate_consumes_deployment calls 'manifest_source['deployment']' 4 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L408" class="js-smell-location">0</a>                  <a href="links_parser.html#L412" class="js-smell-location">1</a>                  <a href="links_parser.html#L413" class="js-smell-location">2</a>                  <a href="links_parser.html#L416" class="js-smell-location">3</a>                  </div>  </li></ol>
        instance_group_name = instance_group_details.fetch(:instance_group_name, nil)
        job_name = instance_group_details.fetch(:job_name, nil)

        from_deployment = Bosh::Director::Models::Deployment.find(name: manifest_source[&#39;deployment&#39;])<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#validate_consumes_deployment calls 'manifest_source['deployment']' 4 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L408" class="js-smell-location">0</a>                  <a href="links_parser.html#L412" class="js-smell-location">1</a>                  <a href="links_parser.html#L413" class="js-smell-location">2</a>                  <a href="links_parser.html#L416" class="js-smell-location">3</a>                  </div>  </li></ol>
        metadata[:from_deployment] = manifest_source[&#39;deployment&#39;]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#validate_consumes_deployment calls 'manifest_source['deployment']' 4 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L408" class="js-smell-location">0</a>                  <a href="links_parser.html#L412" class="js-smell-location">1</a>                  <a href="links_parser.html#L413" class="js-smell-location">2</a>                  <a href="links_parser.html#L416" class="js-smell-location">3</a>                  </div>  </li></ol>

        from_deployment_error_message = &quot;Link &#39;#{consumer_intent_params[:alias]}&#39; in job &#39;#{job_name}&#39; from instance group&quot;\
                  &quot; &#39;#{instance_group_name}&#39; consumes from deployment &#39;#{manifest_source[&#39;deployment&#39;]}&#39;,&quot;\<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#validate_consumes_deployment calls 'manifest_source['deployment']' 4 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L408" class="js-smell-location">0</a>                  <a href="links_parser.html#L412" class="js-smell-location">1</a>                  <a href="links_parser.html#L413" class="js-smell-location">2</a>                  <a href="links_parser.html#L416" class="js-smell-location">3</a>                  </div>  </li></ol>
                  &#39; but the deployment does not exist.&#39;
        errors.push(from_deployment_error_message) unless from_deployment
      end

      def create_consumer_intent(consumer, consumer_intent_params, consumes, metadata)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Data-Clump.md" target="_blank"><b>DataClump</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser takes parameters ['consumer_intent_params', 'metadata'] to 3 methods</span>              <span>Locations:</span>                  <a href="links_parser.html#L368" class="js-smell-location">0</a>                  <a href="links_parser.html#L407" class="js-smell-location">1</a>                  <a href="links_parser.html#L421" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#create_consumer_intent has 4 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#create_consumer_intent has approx 6 statements</span>          </div>  </li></ol>
        consumer_intent = @links_manager.find_or_create_consumer_intent(
          link_consumer: consumer,
          link_original_name: consumer_intent_params[:original_name],
          link_type: consumer_intent_params[:type],
          new_intent_metadata: nil,
        )

        consumer_intent.name = consumer_intent_params[:alias].split(&#39;.&#39;)[-1]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#create_consumer_intent refers to 'consumer_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L429" class="js-smell-location">0</a>                  <a href="links_parser.html#L430" class="js-smell-location">1</a>                  <a href="links_parser.html#L431" class="js-smell-location">2</a>                  <a href="links_parser.html#L432" class="js-smell-location">3</a>                  <a href="links_parser.html#L433" class="js-smell-location">4</a>                  </div>  </li></ol>
        consumer_intent.blocked = consumer_intent_params[:blocked]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#create_consumer_intent refers to 'consumer_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L429" class="js-smell-location">0</a>                  <a href="links_parser.html#L430" class="js-smell-location">1</a>                  <a href="links_parser.html#L431" class="js-smell-location">2</a>                  <a href="links_parser.html#L432" class="js-smell-location">3</a>                  <a href="links_parser.html#L433" class="js-smell-location">4</a>                  </div>  </li></ol>
        consumer_intent.optional = consumes[&#39;optional&#39;] || false<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#create_consumer_intent refers to 'consumer_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L429" class="js-smell-location">0</a>                  <a href="links_parser.html#L430" class="js-smell-location">1</a>                  <a href="links_parser.html#L431" class="js-smell-location">2</a>                  <a href="links_parser.html#L432" class="js-smell-location">3</a>                  <a href="links_parser.html#L433" class="js-smell-location">4</a>                  </div>  </li></ol>
        consumer_intent.metadata = metadata.to_json<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#create_consumer_intent refers to 'consumer_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L429" class="js-smell-location">0</a>                  <a href="links_parser.html#L430" class="js-smell-location">1</a>                  <a href="links_parser.html#L431" class="js-smell-location">2</a>                  <a href="links_parser.html#L432" class="js-smell-location">3</a>                  <a href="links_parser.html#L433" class="js-smell-location">4</a>                  </div>  </li></ol>
        consumer_intent.save<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#create_consumer_intent refers to 'consumer_intent' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L429" class="js-smell-location">0</a>                  <a href="links_parser.html#L430" class="js-smell-location">1</a>                  <a href="links_parser.html#L431" class="js-smell-location">2</a>                  <a href="links_parser.html#L432" class="js-smell-location">3</a>                  <a href="links_parser.html#L433" class="js-smell-location">4</a>                  </div>  </li></ol>
      end

      def process_manual_link(consumer, consumer_intent_params, manifest_source)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#process_manual_link has approx 9 statements</span>          </div>  </li></ol>
        manual_provider = @links_manager.find_or_create_provider(
          deployment_model: consumer.deployment,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#process_manual_link calls 'consumer.deployment' 2 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L438" class="js-smell-location">0</a>                  <a href="links_parser.html#L455" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#process_manual_link refers to 'consumer' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L438" class="js-smell-location">0</a>                  <a href="links_parser.html#L439" class="js-smell-location">1</a>                  <a href="links_parser.html#L440" class="js-smell-location">2</a>                  <a href="links_parser.html#L455" class="js-smell-location">3</a>                  </div>  </li></ol>
          instance_group_name: consumer.instance_group,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#process_manual_link refers to 'consumer' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L438" class="js-smell-location">0</a>                  <a href="links_parser.html#L439" class="js-smell-location">1</a>                  <a href="links_parser.html#L440" class="js-smell-location">2</a>                  <a href="links_parser.html#L455" class="js-smell-location">3</a>                  </div>  </li></ol>
          name: consumer.name,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#process_manual_link refers to 'consumer' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L438" class="js-smell-location">0</a>                  <a href="links_parser.html#L439" class="js-smell-location">1</a>                  <a href="links_parser.html#L440" class="js-smell-location">2</a>                  <a href="links_parser.html#L455" class="js-smell-location">3</a>                  </div>  </li></ol>
          type: &#39;manual&#39;,
        )

        manual_provider_intent = @links_manager.find_or_create_provider_intent(
          link_provider: manual_provider,
          link_original_name: consumer_intent_params[:original_name],<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#process_manual_link calls 'consumer_intent_params[:original_name]' 2 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L446" class="js-smell-location">0</a>                  <a href="links_parser.html#L457" class="js-smell-location">1</a>                  </div>  </li></ol>
          link_type: consumer_intent_params[:type],
        )

        content = {}
        MANUAL_LINK_KEYS.each do |key|
          content[key] = manifest_source[key]
        end

        content[&#39;deployment_name&#39;] = consumer.deployment.name<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#process_manual_link calls 'consumer.deployment' 2 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L438" class="js-smell-location">0</a>                  <a href="links_parser.html#L455" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#process_manual_link refers to 'consumer' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L438" class="js-smell-location">0</a>                  <a href="links_parser.html#L439" class="js-smell-location">1</a>                  <a href="links_parser.html#L440" class="js-smell-location">2</a>                  <a href="links_parser.html#L455" class="js-smell-location">3</a>                  </div>  </li></ol>

        manual_provider_intent.name = consumer_intent_params[:original_name]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkConsumersParser#process_manual_link calls 'consumer_intent_params[:original_name]' 2 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L446" class="js-smell-location">0</a>                  <a href="links_parser.html#L457" class="js-smell-location">1</a>                  </div>  </li></ol>
        manual_provider_intent.content = content.to_json
        manual_provider_intent.save
      end
    end

    class LinkHelpers<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Irresponsible-Module.md" target="_blank"><b>IrresponsibleModule</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers has no descriptive comment</span>          </div>  </li></ol>
      def process_link_properties(job_properties, link_property_list, release_properties, job_name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#process_link_properties has 4 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#process_link_properties has approx 12 statements</span>          </div>  </li></ol>
        errors = []
        link_property_list ||= []
        mapped_properties = {}
        default_properties = {
          &#39;properties&#39; =&gt; release_properties,
          &#39;template_name&#39; =&gt; job_name,
        }
        link_property_list.each do |link_property|
          property_path = link_property.split(&#39;.&#39;)
          result = find_property(property_path, job_properties)
          if !result[&#39;found&#39;]
            if (property = default_properties[&#39;properties&#39;][link_property])
              mapped_properties = if (default_value = property[&#39;default&#39;])
                                    update_mapped_properties(mapped_properties, property_path, default_value)
                                  else
                                    update_mapped_properties(mapped_properties, property_path, nil)
                                  end
            else
              errors.push(&quot;Link property #{link_property} in template #{default_properties[&#39;template_name&#39;]}&quot;\
                        &#39; is not defined in release spec&#39;)
            end
          else
            mapped_properties = update_mapped_properties(mapped_properties, property_path, result[&#39;value&#39;])
          end
        end
        [mapped_properties, errors]
      end

      def validate_custom_providers(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#validate_custom_providers has a flog score of 25</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#validate_custom_providers has 5 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#validate_custom_providers has approx 12 statements</span>          </div>  </li></ol>
        manifest_defined_providers,
        release_defined_providers,
        job_name,
        instance_group_name,
        release_name
      )
        errors = []
        providers_grouped_by_name = manifest_defined_providers.group_by do |provider|
          provider[&#39;name&#39;]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#validate_custom_providers calls 'provider['name']' 2 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L502" class="js-smell-location">0</a>                  <a href="links_parser.html#L511" class="js-smell-location">1</a>                  </div>  </li></ol>
        end

        duplicate_manifest_provider_names = providers_grouped_by_name.select do |_, val|
          val.size &gt; 1
        end

        manifest_defined_providers.each do |custom_provider|
          errors.concat(validate_custom_provider_definition(custom_provider, job_name, instance_group_name))<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#validate_custom_providers refers to 'errors' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L510" class="js-smell-location">0</a>                  <a href="links_parser.html#L512" class="js-smell-location">1</a>                  <a href="links_parser.html#L518" class="js-smell-location">2</a>                  <a href="links_parser.html#L521" class="js-smell-location">3</a>                  </div>  </li></ol>
          if release_defined_providers.detect { |provider| provider[&#39;name&#39;] == custom_provider[&#39;name&#39;] }<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#validate_custom_providers calls 'custom_provider['name']' 2 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L511" class="js-smell-location">0</a>                  <a href="links_parser.html#L512" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#validate_custom_providers calls 'provider['name']' 2 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L502" class="js-smell-location">0</a>                  <a href="links_parser.html#L511" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#validate_custom_providers contains iterators nested 2 deep</span>          </div>  </li></ol>
            errors.push(&quot;Custom provider &#39;#{custom_provider[&#39;name&#39;]}&#39; in job &#39;#{job_name}&#39; in instance group&quot;\<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#validate_custom_providers calls 'custom_provider['name']' 2 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L511" class="js-smell-location">0</a>                  <a href="links_parser.html#L512" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#validate_custom_providers refers to 'errors' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L510" class="js-smell-location">0</a>                  <a href="links_parser.html#L512" class="js-smell-location">1</a>                  <a href="links_parser.html#L518" class="js-smell-location">2</a>                  <a href="links_parser.html#L521" class="js-smell-location">3</a>                  </div>  </li></ol>
                      &quot; &#39;#{instance_group_name}&#39; is already defined in release &#39;#{release_name}&#39;&quot;)
          end
        end

        duplicate_manifest_provider_names.each_key do |duplicate_name|
          errors.push(&quot;Custom provider &#39;#{duplicate_name}&#39; in job &#39;#{job_name}&#39; in instance group&quot;\<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#validate_custom_providers refers to 'errors' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L510" class="js-smell-location">0</a>                  <a href="links_parser.html#L512" class="js-smell-location">1</a>                  <a href="links_parser.html#L518" class="js-smell-location">2</a>                  <a href="links_parser.html#L521" class="js-smell-location">3</a>                  </div>  </li></ol>
                    &quot; &#39;#{instance_group_name}&#39; is defined multiple times in manifest.&quot;)
        end
        raise errors.join(&quot;\n&quot;) unless errors.empty?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#validate_custom_providers refers to 'errors' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L510" class="js-smell-location">0</a>                  <a href="links_parser.html#L512" class="js-smell-location">1</a>                  <a href="links_parser.html#L518" class="js-smell-location">2</a>                  <a href="links_parser.html#L521" class="js-smell-location">3</a>                  </div>  </li></ol>
      end

      def validate_custom_provider_definition(provider, job_name, instance_group_name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#validate_custom_provider_definition doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
        errors = []
        if !provider[&#39;name&#39;].is_a?(String) || provider[&#39;name&#39;].empty?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#validate_custom_provider_definition calls 'provider['name']' 2 times</span>          </div>  </li></ol>
          errors.push(&quot;Name for custom link provider definition in manifest in job &#39;#{job_name}&#39; in instance group&quot;\<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="links_parser.html#L527" class="js-smell-location">0</a>                  <a href="links_parser.html#L532" class="js-smell-location">1</a>                  </div>  </li></ol>
                    &quot; &#39;#{instance_group_name}&#39; must be a valid non-empty string.&quot;)
        end

        if !provider[&#39;type&#39;].is_a?(String) || provider[&#39;type&#39;].empty?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#validate_custom_provider_definition calls 'provider['type']' 2 times</span>          </div>  </li></ol>
          errors.push(&quot;Type for custom link provider definition in manifest in job &#39;#{job_name}&#39; in instance group&quot;\<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="links_parser.html#L527" class="js-smell-location">0</a>                  <a href="links_parser.html#L532" class="js-smell-location">1</a>                  </div>  </li></ol>
                    &quot; &#39;#{instance_group_name}&#39; must be a valid non-empty string.&quot;)
        end
        errors
      end

      def generate_provider_intent_params(manifest_source, provider_intent_params)
        if manifest_source.eql? &#39;nil&#39;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#generate_provider_intent_params refers to 'manifest_source' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L539" class="js-smell-location">0</a>                  <a href="links_parser.html#L542" class="js-smell-location">1</a>                  <a href="links_parser.html#L543" class="js-smell-location">2</a>                  </div>  </li></ol>
          provider_intent_params[:consumable] = false
        else
          provider_intent_params[:alias] = manifest_source[&#39;as&#39;] if manifest_source.key?(&#39;as&#39;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#generate_provider_intent_params refers to 'manifest_source' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L539" class="js-smell-location">0</a>                  <a href="links_parser.html#L542" class="js-smell-location">1</a>                  <a href="links_parser.html#L543" class="js-smell-location">2</a>                  </div>  </li></ol>
          provider_intent_params[:shared] = double_negate_value(manifest_source[&#39;shared&#39;])<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#generate_provider_intent_params refers to 'manifest_source' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L539" class="js-smell-location">0</a>                  <a href="links_parser.html#L542" class="js-smell-location">1</a>                  <a href="links_parser.html#L543" class="js-smell-location">2</a>                  </div>  </li></ol>
        end
        provider_intent_params
      end

      def validate_provide_link(source, link_name, job_name, instance_group_name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Data-Clump.md" target="_blank"><b>DataClump</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers takes parameters ['instance_group_name', 'job_name', 'link_name'] to 5 methods</span>              <span>Locations:</span>                  <a href="links_parser.html#L548" class="js-smell-location">0</a>                  <a href="links_parser.html#L604" class="js-smell-location">1</a>                  <a href="links_parser.html#L628" class="js-smell-location">2</a>                  <a href="links_parser.html#L634" class="js-smell-location">3</a>                  <a href="links_parser.html#L644" class="js-smell-location">4</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#validate_provide_link has 4 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#validate_provide_link doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
        return [] if source.eql? &#39;nil&#39;

        unless source.is_a?(Hash)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="links_parser.html#L551" class="js-smell-location">0</a>                  <a href="links_parser.html#L607" class="js-smell-location">1</a>                  </div>  </li></ol>
          return [&quot;Provider &#39;#{link_name}&#39; in job &#39;#{job_name}&#39; in instance group &#39;#{instance_group_name}&#39;&quot;\
                &quot; specified in the manifest should only be a hash or string &#39;nil&#39;&quot;]
        end

        errors = []
        if source.key?(&#39;name&#39;) || source.key?(&#39;type&#39;)
          errors.push(&quot;Cannot specify &#39;name&#39; or &#39;type&#39; properties in the manifest for link &#39;#{link_name}&#39;&quot;\
                    &quot; in job &#39;#{job_name}&#39; in instance group &#39;#{instance_group_name}&#39;.&quot;\
                    &#39; Please provide these keys in the release only.&#39;)
        end

        errors
      end

      def manual_link?(consume_link_source)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#manual_link? doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
        MANUAL_LINK_KEYS.any? do |key|
          consume_link_source.key? key
        end
      end

      def find_property(property_path, job_properties)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#find_property doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
        current_node = job_properties
        property_path.each do |key|
          return { &#39;found&#39; =&gt; false, &#39;value&#39; =&gt; nil } if !current_node || !current_node.key?(key)

          current_node = current_node[key]
        end
        { &#39;found&#39; =&gt; true, &#39;value&#39; =&gt; current_node }
      end

      def update_mapped_properties(mapped_properties, property_path, value)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#update_mapped_properties has approx 6 statements</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#update_mapped_properties doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
        current_node = mapped_properties
        property_path.each_with_index do |key, index|
          if index == property_path.size - 1
            current_node[key] = value
          else
            current_node[key] = {} unless current_node.key?(key)
            current_node = current_node[key]
          end
        end

        mapped_properties
      end

      def extract_provider_definition_properties(manifest_details)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#extract_provider_definition_properties doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
        are_custom_definitions = manifest_details.fetch(:are_custom_definitions, nil)
        instance_group_name = manifest_details.fetch(:instance_group_name, nil)
        job_name = manifest_details.fetch(:job_name, nil)
        job_properties = manifest_details.fetch(:job_properties, {})
        [are_custom_definitions, instance_group_name, job_name, job_properties]
      end

      def validate_consume_link(manifest_source, link_name, job_name, instance_group_name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Data-Clump.md" target="_blank"><b>DataClump</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers takes parameters ['instance_group_name', 'job_name', 'link_name'] to 5 methods</span>              <span>Locations:</span>                  <a href="links_parser.html#L548" class="js-smell-location">0</a>                  <a href="links_parser.html#L604" class="js-smell-location">1</a>                  <a href="links_parser.html#L628" class="js-smell-location">2</a>                  <a href="links_parser.html#L634" class="js-smell-location">3</a>                  <a href="links_parser.html#L644" class="js-smell-location">4</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#validate_consume_link has 4 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#validate_consume_link has approx 11 statements</span>          </div>  </li></ol>
        return [] if manifest_source.eql? &#39;nil&#39;

        unless manifest_source.is_a?(Hash)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="links_parser.html#L551" class="js-smell-location">0</a>                  <a href="links_parser.html#L607" class="js-smell-location">1</a>                  </div>  </li></ol>
          return [&quot;Consumer &#39;#{link_name}&#39; in job &#39;#{job_name}&#39; in instance group &#39;#{instance_group_name}&#39;&quot;\
                &quot; specified in the manifest should only be a hash or string &#39;nil&#39;&quot;]
        end

        errors = []
        blacklist = [%w[instances from], %w[properties from]]
        blacklist.each do |invalid_props|
          if invalid_props.all? { |prop| manifest_source.key?(prop) }<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#validate_consume_link contains iterators nested 2 deep</span>          </div>  </li></ol>
            errors.push(&quot;Cannot specify both &#39;#{invalid_props[0]}&#39; and &#39;#{invalid_props[1]}&#39; keys for link&quot;\
                      &quot; &#39;#{link_name}&#39; in job &#39;#{job_name}&#39; in instance group &#39;#{instance_group_name}&#39;.&quot;)
          end
        end

        verify_consume_manifest_source_properties_instances(manifest_source, errors, link_name, job_name, instance_group_name)
        verify_consume_manifest_source_ip_addresses(manifest_source, errors, link_name, job_name, instance_group_name)
        verify_consume_manifest_source_name_type(manifest_source, errors, link_name, job_name, instance_group_name)

        errors
      end

      def verify_consume_manifest_source_properties_instances(source, errors, link_name, job_name, instance_group_name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Data-Clump.md" target="_blank"><b>DataClump</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers takes parameters ['errors', 'instance_group_name', 'job_name', 'link_name', 'source'] to 3 methods</span>              <span>Locations:</span>                  <a href="links_parser.html#L628" class="js-smell-location">0</a>                  <a href="links_parser.html#L634" class="js-smell-location">1</a>                  <a href="links_parser.html#L644" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Data-Clump.md" target="_blank"><b>DataClump</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers takes parameters ['instance_group_name', 'job_name', 'link_name'] to 5 methods</span>              <span>Locations:</span>                  <a href="links_parser.html#L548" class="js-smell-location">0</a>                  <a href="links_parser.html#L604" class="js-smell-location">1</a>                  <a href="links_parser.html#L628" class="js-smell-location">2</a>                  <a href="links_parser.html#L634" class="js-smell-location">3</a>                  <a href="links_parser.html#L644" class="js-smell-location">4</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#verify_consume_manifest_source_properties_instances has 5 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#verify_consume_manifest_source_properties_instances doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
        error_message = &quot;Cannot specify &#39;properties&#39; without &#39;instances&#39; for link &#39;#{link_name}&#39; in job &#39;#{job_name}&#39;&quot;\
                  &quot; in instance group &#39;#{instance_group_name}&#39;.&quot;
        errors.push(error_message) if source.key?(&#39;properties&#39;) &amp;&amp; !source.key?(&#39;instances&#39;)
      end

      def verify_consume_manifest_source_ip_addresses(source, errors, link_name, job_name, instance_group_name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Data-Clump.md" target="_blank"><b>DataClump</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers takes parameters ['errors', 'instance_group_name', 'job_name', 'link_name', 'source'] to 3 methods</span>              <span>Locations:</span>                  <a href="links_parser.html#L628" class="js-smell-location">0</a>                  <a href="links_parser.html#L634" class="js-smell-location">1</a>                  <a href="links_parser.html#L644" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Data-Clump.md" target="_blank"><b>DataClump</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers takes parameters ['instance_group_name', 'job_name', 'link_name'] to 5 methods</span>              <span>Locations:</span>                  <a href="links_parser.html#L548" class="js-smell-location">0</a>                  <a href="links_parser.html#L604" class="js-smell-location">1</a>                  <a href="links_parser.html#L628" class="js-smell-location">2</a>                  <a href="links_parser.html#L634" class="js-smell-location">3</a>                  <a href="links_parser.html#L644" class="js-smell-location">4</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#verify_consume_manifest_source_ip_addresses has 5 parameters</span>          </div>  </li></ol>
        # The first expression makes it TRUE or FALSE then if the second expression is neither TRUE or FALSE it will return FALSE
        ip_addresses_error_message = &quot;Cannot specify non boolean values for &#39;ip_addresses&#39; field for link &#39;#{link_name}&#39;&quot;\
                    &quot; in job &#39;#{job_name}&#39; in instance group &#39;#{instance_group_name}&#39;.&quot;
        valid_property = (double_negate_value(source[&#39;ip_addresses&#39;]) != source[&#39;ip_addresses&#39;])<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#verify_consume_manifest_source_ip_addresses calls 'source['ip_addresses']' 2 times</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#verify_consume_manifest_source_ip_addresses refers to 'source' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L638" class="js-smell-location">0</a>                  <a href="links_parser.html#L639" class="js-smell-location">1</a>                  </div>  </li></ol>
        not_true_false = source.key?(&#39;ip_addresses&#39;) &amp;&amp; valid_property<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#verify_consume_manifest_source_ip_addresses refers to 'source' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="links_parser.html#L638" class="js-smell-location">0</a>                  <a href="links_parser.html#L639" class="js-smell-location">1</a>                  </div>  </li></ol>

        errors.push(ip_addresses_error_message) if not_true_false
      end

      def verify_consume_manifest_source_name_type(source, errors, link_name, job_name, instance_group_name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Data-Clump.md" target="_blank"><b>DataClump</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers takes parameters ['errors', 'instance_group_name', 'job_name', 'link_name', 'source'] to 3 methods</span>              <span>Locations:</span>                  <a href="links_parser.html#L628" class="js-smell-location">0</a>                  <a href="links_parser.html#L634" class="js-smell-location">1</a>                  <a href="links_parser.html#L644" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Data-Clump.md" target="_blank"><b>DataClump</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers takes parameters ['instance_group_name', 'job_name', 'link_name'] to 5 methods</span>              <span>Locations:</span>                  <a href="links_parser.html#L548" class="js-smell-location">0</a>                  <a href="links_parser.html#L604" class="js-smell-location">1</a>                  <a href="links_parser.html#L628" class="js-smell-location">2</a>                  <a href="links_parser.html#L634" class="js-smell-location">3</a>                  <a href="links_parser.html#L644" class="js-smell-location">4</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#verify_consume_manifest_source_name_type has 5 parameters</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#verify_consume_manifest_source_name_type doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
        name_type_error_message = &quot;Cannot specify &#39;name&#39; or &#39;type&#39; properties in the manifest for link &#39;#{link_name}&#39;&quot;\
                  &quot; in job &#39;#{job_name}&#39; in instance group &#39;#{instance_group_name}&#39;.&quot;\
                  &#39; Please provide these keys in the release only.&#39;
        errors.push(name_type_error_message) if source.key?(&#39;name&#39;) || source.key?(&#39;type&#39;)
      end

      def double_negate_value(value)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser::LinkHelpers#double_negate_value doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
        (value &amp;&amp; [true, false].include?(value)) || false
      end
    end

    def initialize
      @link_providers_parser = LinkProvidersParser.new
      @link_consumers_parser = LinkConsumersParser.new
    end

    def parse_migrated_from_providers_from_job(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser#parse_migrated_from_providers_from_job has 4 parameters</span>          </div>  </li></ol>
      manifest_job_spec, deployment_model, current_template_model, manifest_details = {}
    )
      @link_providers_parser.parse_migrated_from_providers_from_job(
        manifest_job_spec, deployment_model, current_template_model, manifest_details
      )
    end

    def parse_providers_from_job(manifest_job_spec, deployment_model, current_release_template_model, manifest_details = {})<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser#parse_providers_from_job has 4 parameters</span>          </div>  </li></ol>
      @link_providers_parser.parse_providers_from_job(
        manifest_job_spec, deployment_model, current_release_template_model, manifest_details
      )
    end

    def parse_provider_from_disk(disk_spec, deployment_model, instance_group_name)
      @link_providers_parser.parse_provider_from_disk(
        disk_spec, deployment_model, instance_group_name
      )
    end

    def parse_migrated_from_consumers_from_job(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser#parse_migrated_from_consumers_from_job has 4 parameters</span>          </div>  </li></ol>
      manifest_job_spec, deployment_model, current_release_template_model, instance_group_details = {}
    )
      @link_consumers_parser.parse_migrated_from_consumers_from_job(
        manifest_job_spec, deployment_model, current_release_template_model, instance_group_details
      )
    end

    def parse_consumers_from_job(manifest_job_spec, deployment_model, current_release_template_model, instance_group_details = {})<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser#parse_consumers_from_job has 4 parameters</span>          </div>  </li></ol>
      @link_consumers_parser.parse_consumers_from_job(
        manifest_job_spec, deployment_model, current_release_template_model, instance_group_details
      )
    end

    def parse_consumers_from_variable(variable_spec, deployment_model)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser#parse_consumers_from_variable has a flog score of 37</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Statements.md" target="_blank"><b>TooManyStatements</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser#parse_consumers_from_variable has approx 19 statements</span>          </div>  </li></ol>
      return unless variable_spec.key? &#39;consumes&#39;

      @links_manager = Bosh::Director::Links::LinksManager.new(deployment_model.links_serial_id)

      variable_name = variable_spec[&#39;name&#39;]
      variable_type = variable_spec[&#39;type&#39;]

      errors = []

      variable_spec[&#39;consumes&#39;].each do |key, value|
        original_name = key

        local_error = validate_variable(variable_name, variable_type, original_name)

        unless local_error.nil?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser#parse_consumers_from_variable performs a nil-check</span>              <span>Locations:</span>                  <a href="links_parser.html#L710" class="js-smell-location">0</a>                  <a href="links_parser.html#L725" class="js-smell-location">1</a>                  </div>  </li></ol>
          errors &lt;&lt; local_error
          next
        end

        from_name = value[&#39;from&#39;] || original_name

        consumer = @links_manager.find_or_create_consumer(
          deployment_model: deployment_model,
          instance_group_name: &#39;&#39;,
          name: variable_name,
          type: &#39;variable&#39;,
        )

        metadata = { explicit_link: true }
        wildcard_needed = !value[&#39;properties&#39;].nil? &amp;&amp; value[&#39;properties&#39;][&#39;wildcard&#39;] == true<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser#parse_consumers_from_variable calls 'value['properties']' 3 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L725" class="js-smell-location">0</a>                  <a href="links_parser.html#L726" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser#parse_consumers_from_variable calls 'value['properties']['wildcard']' 2 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L725" class="js-smell-location">0</a>                  <a href="links_parser.html#L726" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser#parse_consumers_from_variable performs a nil-check</span>              <span>Locations:</span>                  <a href="links_parser.html#L710" class="js-smell-location">0</a>                  <a href="links_parser.html#L725" class="js-smell-location">1</a>                  </div>  </li></ol>
        metadata = metadata.merge(wildcard: value[&#39;properties&#39;][&#39;wildcard&#39;]) if wildcard_needed<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser#parse_consumers_from_variable calls 'value['properties']' 3 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L725" class="js-smell-location">0</a>                  <a href="links_parser.html#L726" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser#parse_consumers_from_variable calls 'value['properties']['wildcard']' 2 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L725" class="js-smell-location">0</a>                  <a href="links_parser.html#L726" class="js-smell-location">1</a>                  </div>  </li></ol>

        consumer_intent = @links_manager.find_or_create_consumer_intent(
          link_consumer: consumer,
          link_original_name: original_name,
          link_type: &#39;address&#39;,
          new_intent_metadata: metadata,
        )
        consumer_intent.name = from_name
        consumer_intent.save
      end

      raise errors.join(&quot;\n&quot;) unless errors.empty?
    end

    private

    def validate_variable(variable_name, variable_type, original_name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser#validate_variable doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
      acceptable_combinations = { &#39;certificate&#39; =&gt; %w[alternative_name common_name] }

      unless acceptable_combinations.key?(variable_type)
        return &quot;Variable &#39;#{variable_name}&#39; can not define &#39;consumes&#39; key for type &#39;#{variable_type}&#39;&quot;
      end

      unless acceptable_combinations[variable_type].include?(original_name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser#validate_variable calls 'acceptable_combinations[variable_type]' 2 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L750" class="js-smell-location">0</a>                  <a href="links_parser.html#L751" class="js-smell-location">1</a>                  </div>  </li></ol>
        acceptable_combination_string = acceptable_combinations[variable_type].join(&#39;, &#39;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::Links::LinksParser#validate_variable calls 'acceptable_combinations[variable_type]' 2 times</span>              <span>Locations:</span>                  <a href="links_parser.html#L750" class="js-smell-location">0</a>                  <a href="links_parser.html#L751" class="js-smell-location">1</a>                  </div>  </li></ol>
        return &quot;Consumer name &#39;#{original_name}&#39; is not a valid consumer for variable &#39;#{variable_name}&#39;.&quot;\
                    &quot; Acceptable consumer types are: #{acceptable_combination_string}&quot;
      end

      nil
    end
  end
end
</code>
  </div>
</div>

        </div>
      </div>
    </div>

    <!-- Javascripts -->
    <script src='../../../../assets/javascripts/jquery.min.js'></script>
    <script src='../../../../assets/javascripts/jquery.tablesorter.min.js'></script>
    <script src='../../../../assets/javascripts/jquery.scrollTo.min.js'></script>
    <script src='../../../../assets/javascripts/jquery.timeago.js'></script>
    <script src='../../../../assets/javascripts/highcharts.src-4.0.1.js'></script>
    <script src='../../../../assets/javascripts/prettify.js'></script>
    <script src='../../../../assets/javascripts/bootstrap.min.js'></script>
    <script src='../../../../assets/javascripts/application.js'></script>
    <script src='../../../../assets/javascripts/jquery.filtertable.min.js'></script>
  </body>
</html>
