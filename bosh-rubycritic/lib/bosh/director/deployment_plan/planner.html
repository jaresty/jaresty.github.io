<!DOCTYPE html>
<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ruby Critic - Home</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- StyleSheets -->
    <link href="../../../../assets/stylesheets/bootstrap.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../../assets/stylesheets/font-awesome.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../../assets/stylesheets/prettify.custom_theme.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../../assets/stylesheets/application.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  </head>

  <body>
    <header class="navbar navbar-default navbar-fixed-top">
      <a href="#menu-toggle" class="btn btn-default hidden-lg visible-sm-* hidden-md visible-xs-* pull-left" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a>
      <a href="../../../../overview.html"><img src="../../../../assets/images/logo.png" title="Ruby Critic Logo" width="55"><span class="logo">RUBYCRITIC</span></a>
    </header>
    <div id="wrapper">
      <!-- Sidebar -->
      <aside id="sidebar-wrapper">
        <ul class="sidebar-nav">
          <li class="sidebar-item">
            <a href="../../../../overview.html" class="project-nav-item overview-nav"><i class="fa fa-dashboard"></i>Overview</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../../code_index.html" class="project-nav-item code-index-nav"><i class="fa fa-code"></i>Code</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../../smells_index.html" class="project-nav-item smells-index-nav"><i class="fa fa-warning"></i>Smells</a>
          </li>
        </ul>
      </aside>
      <!-- /#sidebar-wrapper -->
      <div id="page-content-wrapper">
        <div class="container-fluid">
          <div class="row">
  <!--Page Title -->
  <div class="Page_Title">
    <div class="file-time">
      <span class="committed-at">
        
          Updated <time class='js-timeago' datetime='2018-05-11 15:46:24 -0400'>2018-05-11 15:46:24 -0400</time>
        
      </span>
    </div>
    <div>
      <h3><small>lib/bosh/director/deployment_plan /</small> planner.rb</h3>
    </div>
  </div>
  <!--End Page Title -->
  <div class="Content_Wrapper">
    <!-- code detail -->
    <div class="code-top-detail clearfix row">
      <div class="col-md-8">
        <div class="row">
          <div class="col-md-1">
            <div class="rating c big">
              C
            </div>
          </div>
          <div class="code-statistics col-md-11">
            <div class="col-md-3">
              <div><span class="metric">310</span><small> lines of codes</small></div>
              <div><span class="metric">30</span><small> methods</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">5.4</span><small> complexity/method</small></div>
              <div><span class="metric">193</span><small> churn</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">162.35</span><small> complexity</small></div>
              <div><span class="metric">0</span><small> duplications</small></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="code-tabs">
          <ul class="nav nav-pills right-to-left">
            <li><a href="#" id="toggle-code" class="toggle-button button">code</a></li>
            <li class="active">
              <a href="#" id="toggle-smells" class="toggle-button button">
                27
                smells
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <code class="prettyprint linenums lang-ruby file-code js-file-code">require &#39;bosh/director/deployment_plan/disk_type&#39;
require &#39;forwardable&#39;
require &#39;common/deep_copy&#39;

module Bosh::Director
  # Encapsulates essential director data structures retrieved
  # from the deployment manifest and the running environment.
  module DeploymentPlan
    class Planner<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Instance-Variable-Assumption.md" target="_blank"><b>InstanceVariableAssumption</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner assumes too much for instance variable '@cloud_planner'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Irresponsible-Module.md" target="_blank"><b>IrresponsibleModule</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner has no descriptive comment</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Instance-Variables.md" target="_blank"><b>TooManyInstanceVariables</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner has at least 26 instance variables</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Methods.md" target="_blank"><b>TooManyMethods</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner has at least 30 methods</span>          </div>  </li></ol>
      include LockHelper
      include ValidationHelper
      extend Forwardable

      # @return [String] Deployment name
      attr_reader :name

      # @return [String] Deployment canonical name (for DNS)
      attr_reader :canonical_name

      # @return [Models::Deployment] Deployment DB model
      attr_reader :model

      attr_accessor :properties<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Attribute.md" target="_blank"><b>Attribute</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#properties is a writable attribute</span>          </div>  </li></ol>

      # @return [Bosh::Director::DeploymentPlan::UpdateConfig]
      #   Default job update configuration
      attr_accessor :update<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Attribute.md" target="_blank"><b>Attribute</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#update is a writable attribute</span>          </div>  </li></ol>

      # @return [Array&lt;Bosh::Director::DeploymentPlan::Job&gt;]
      #   All instance_groups in the deployment
      attr_reader :instance_groups

      # Stemcells in deployment by alias
      attr_reader :stemcells

      # Tags in deployment by alias
      attr_reader :tags

      # Job instances from the old manifest that are not in the new manifest
      attr_reader :instance_plans_for_obsolete_instance_groups

      # @return [Boolean] Indicates whether VMs should be recreated
      attr_reader :recreate

      attr_writer :cloud_planner<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Attribute.md" target="_blank"><b>Attribute</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#cloud_planner is a writable attribute</span>          </div>  </li></ol>

      # @return [Boolean] Indicates whether VMs should be drained
      attr_reader :skip_drain

      # Hash with resolved aliases for stemcells, resource_pools and releases
      attr_reader :uninterpolated_manifest_hash

      # Text with raw manifest content
      attr_reader :raw_manifest_text

      # @return [DeploymentPlan::Variables] Returns the variables object of deployment
      attr_reader :variables

      # @return [DeploymentPlan::DeploymentFeatures] Returns the features object of deployment
      attr_reader :features

      attr_reader :template_blob_cache
      attr_reader :vm_resources_cache

      attr_accessor :addons<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Attribute.md" target="_blank"><b>Attribute</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#addons is a writable attribute</span>          </div>  </li></ol>

      attr_reader :cloud_configs
      attr_reader :runtime_configs

      attr_reader :links_manager

      def initialize(attrs,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#initialize has a flog score of 41</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Long-Parameter-List.md" target="_blank"><b>LongParameterList</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#initialize has 7 parameters</span>          </div>  </li></ol>
                     uninterpolated_manifest_hash,
                     raw_manifest_text,
                     cloud_configs,
                     runtime_configs,
                     deployment_model,
                     options = {})
        @name = attrs.fetch(:name)
        @properties = attrs.fetch(:properties)
        @releases = {}

        @uninterpolated_manifest_hash = Bosh::Common::DeepCopy.copy(uninterpolated_manifest_hash)
        @raw_manifest_text = raw_manifest_text
        @cloud_configs = cloud_configs
        @runtime_configs = runtime_configs
        @model = deployment_model

        @stemcells = {}
        @instance_groups = []
        @instance_groups_name_index = {}
        @instance_groups_canonical_name_index = Set.new
        @tags = options.fetch(&#39;tags&#39;, {})

        @unneeded_vms = []
        @instance_plans_for_obsolete_instance_groups = []

        @is_deploy_action = !!options[&#39;is_deploy_action&#39;]
        @recreate = !!options[&#39;recreate&#39;]
        @fix = !!options[&#39;fix&#39;]

        @skip_drain = SkipDrain.new(options[&#39;skip_drain&#39;])

        @variables = Variables.new([])
        @features = DeploymentFeatures.new

        @addons = []
        @logger = Config.logger

        @links_manager = Bosh::Director::Links::LinksManager.new(deployment_model.links_serial_id)

        @template_blob_cache = Bosh::Director::Core::Templates::TemplateBlobCache.new
        @vm_resources_cache = VmResourcesCache.new(AZCloudFactory.create_with_latest_configs(@model), @logger)
      end

      def_delegators :@cloud_planner,
                     :networks,
                     :network,
                     :deleted_network,
                     :availability_zone,
                     :availability_zones,
                     :resource_pools,
                     :resource_pool,
                     :vm_types,
                     :vm_type,
                     :vm_extensions,
                     :vm_extension,
                     :add_resource_pool,
                     :disk_types,
                     :disk_type,
                     :compilation,
                     :ip_provider

      def canonical_name
        Canonicalizer.canonicalize(@name)
      end

      def deployment_wide_options
        {
          fix: @fix,
          tags: @tags,
        }
      end

      # Returns a list of Instances in the deployment (according to DB)
      # @return [Array&lt;Models::Instance&gt;]
      def instance_models
        @model.instances
      end

      def existing_instances
        instance_models
      end

      def candidate_existing_instances<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#candidate_existing_instances has a flog score of 25</span>          </div>  </li></ol>
        desired_job_names = instance_groups.map(&amp;:name)
        migrating_job_names = instance_groups.map(&amp;:migrated_from).flatten.map(&amp;:name)

        existing_instances.select do |instance|
          desired_job_names.include?(instance.job) ||<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#candidate_existing_instances calls 'instance.job' 2 times</span>              <span>Locations:</span>                  <a href="planner.html#L160" class="js-smell-location">0</a>                  <a href="planner.html#L161" class="js-smell-location">1</a>                  </div>  </li></ol>
            migrating_job_names.include?(instance.job)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#candidate_existing_instances calls 'instance.job' 2 times</span>              <span>Locations:</span>                  <a href="planner.html#L160" class="js-smell-location">0</a>                  <a href="planner.html#L161" class="js-smell-location">1</a>                  </div>  </li></ol>
        end
      end

      def skip_drain_for_job?(name)
        @skip_drain.nil? ? false : @skip_drain.for_job(name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#skip_drain_for_job? performs a nil-check</span>          </div>  </li></ol>
      end

      def add_stemcell(stemcell)
        @stemcells[stemcell.alias] = stemcell
      end

      def stemcell(name)
        @stemcells[name]
      end

      # Adds a release by name
      # @param [Bosh::Director::DeploymentPlan::ReleaseVersion] release
      def add_release(release)
        if @releases.key?(release.name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#add_release calls 'release.name' 3 times</span>              <span>Locations:</span>                  <a href="planner.html#L180" class="js-smell-location">0</a>                  <a href="planner.html#L182" class="js-smell-location">1</a>                  <a href="planner.html#L184" class="js-smell-location">2</a>                  </div>  </li></ol>
          raise DeploymentDuplicateReleaseName,
                &quot;Duplicate release name &#39;#{release.name}&#39;&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#add_release calls 'release.name' 3 times</span>              <span>Locations:</span>                  <a href="planner.html#L180" class="js-smell-location">0</a>                  <a href="planner.html#L182" class="js-smell-location">1</a>                  <a href="planner.html#L184" class="js-smell-location">2</a>                  </div>  </li></ol>
        end
        @releases[release.name] = release<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#add_release calls 'release.name' 3 times</span>              <span>Locations:</span>                  <a href="planner.html#L180" class="js-smell-location">0</a>                  <a href="planner.html#L182" class="js-smell-location">1</a>                  <a href="planner.html#L184" class="js-smell-location">2</a>                  </div>  </li></ol>
      end

      # Adds variables and gives error if there is a duplicate variable already.
      # @param [Bosh::Director::DeploymentPlan::Variables] variables
      def add_variables(variables)
        variables.spec.each do |variable|
          if @variables.contains_variable?(variable[&#39;name&#39;])<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#add_variables calls 'variable['name']' 2 times</span>              <span>Locations:</span>                  <a href="planner.html#L191" class="js-smell-location">0</a>                  <a href="planner.html#L193" class="js-smell-location">1</a>                  </div>  </li></ol>
            raise DeploymentDuplicateVariableName,
                  &quot;Duplicate variable name &#39;#{variable[&#39;name&#39;]}&#39;&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#add_variables calls 'variable['name']' 2 times</span>              <span>Locations:</span>                  <a href="planner.html#L191" class="js-smell-location">0</a>                  <a href="planner.html#L193" class="js-smell-location">1</a>                  </div>  </li></ol>
          end
        end
        @variables.add(variables)
      end

      # Returns all releases in a deployment plan
      # @return [Array&lt;Bosh::Director::DeploymentPlan::ReleaseVersion&gt;]
      def releases
        @releases.values
      end

      # Returns a named release
      # @return [Bosh::Director::DeploymentPlan::ReleaseVersion]
      def release(name)
        @releases[name]
      end

      def instance_plans_with_missing_vms
        instance_groups_starting_on_deploy.collect_concat(&amp;:instance_plans_with_missing_vms)
      end

      def instance_plans_with_create_swap_delete_and_needs_duplicate_vm
        instance_groups_starting_on_deploy.collect_concat do |instance_group|
          return [] unless instance_group.should_create_swap_delete?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#instance_plans_with_create_swap_delete_and_needs_duplicate_vm refers to 'instance_group' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="planner.html#L217" class="js-smell-location">0</a>                  <a href="planner.html#L218" class="js-smell-location">1</a>                  </div>  </li></ol>
          instance_group.unignored_instance_plans_needing_duplicate_vm<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#instance_plans_with_create_swap_delete_and_needs_duplicate_vm refers to 'instance_group' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="planner.html#L217" class="js-smell-location">0</a>                  <a href="planner.html#L218" class="js-smell-location">1</a>                  </div>  </li></ol>
        end
      end

      def skipped_instance_plans_with_create_swap_delete_and_needs_duplicate_vm
        instance_groups_starting_on_deploy.collect_concat do |instance_group|
          return [] if instance_group.create_swap_delete? == instance_group.should_create_swap_delete?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#skipped_instance_plans_with_create_swap_delete_and_needs_duplicate_vm refers to 'instance_group' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="planner.html#L224" class="js-smell-location">0</a>                  <a href="planner.html#L226" class="js-smell-location">1</a>                  </div>  </li></ol>

          instance_group.unignored_instance_plans_needing_duplicate_vm<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#skipped_instance_plans_with_create_swap_delete_and_needs_duplicate_vm refers to 'instance_group' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="planner.html#L224" class="js-smell-location">0</a>                  <a href="planner.html#L226" class="js-smell-location">1</a>                  </div>  </li></ol>
        end
      end

      def mark_instance_plans_for_deletion(instance_plans)
        @instance_plans_for_obsolete_instance_groups = instance_plans
      end

      # Adds a instance_group by name
      # @param [Bosh::Director::DeploymentPlan::InstanceGroup] instance_group
      def add_instance_group(instance_group)
        if @instance_groups_canonical_name_index.include?(instance_group.canonical_name)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#add_instance_group calls 'instance_group.canonical_name' 2 times</span>              <span>Locations:</span>                  <a href="planner.html#L237" class="js-smell-location">0</a>                  <a href="planner.html#L244" class="js-smell-location">1</a>                  </div>  </li></ol>
          raise DeploymentCanonicalJobNameTaken,
                &quot;Invalid instance group name &#39;#{instance_group.name}&#39;, canonical name already taken&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#add_instance_group calls 'instance_group.name' 2 times</span>              <span>Locations:</span>                  <a href="planner.html#L239" class="js-smell-location">0</a>                  <a href="planner.html#L243" class="js-smell-location">1</a>                  </div>  </li></ol>
        end

        @instance_groups &lt;&lt; instance_group
        @instance_groups_name_index[instance_group.name] = instance_group<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#add_instance_group calls 'instance_group.name' 2 times</span>              <span>Locations:</span>                  <a href="planner.html#L239" class="js-smell-location">0</a>                  <a href="planner.html#L243" class="js-smell-location">1</a>                  </div>  </li></ol>
        @instance_groups_canonical_name_index &lt;&lt; instance_group.canonical_name<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#add_instance_group calls 'instance_group.canonical_name' 2 times</span>              <span>Locations:</span>                  <a href="planner.html#L237" class="js-smell-location">0</a>                  <a href="planner.html#L244" class="js-smell-location">1</a>                  </div>  </li></ol>
      end

      # Returns a named instance_group
      # @param [String] name Instance group name
      # @return [Bosh::Director::DeploymentPlan::InstanceGroup] Instance group
      def instance_group(name)
        @instance_groups_name_index[name]
      end

      def instance_groups_starting_on_deploy
        instance_groups = []

        @instance_groups.each do |instance_group|
          if instance_group.service?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#instance_groups_starting_on_deploy refers to 'instance_group' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="planner.html#L258" class="js-smell-location">0</a>                  <a href="planner.html#L260" class="js-smell-location">1</a>                  <a href="planner.html#L261" class="js-smell-location">2</a>                  </div>  </li></ol>
            instance_groups &lt;&lt; instance_group<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#instance_groups_starting_on_deploy calls 'instance_groups << instance_group' 2 times</span>              <span>Locations:</span>                  <a href="planner.html#L259" class="js-smell-location">0</a>                  <a href="planner.html#L261" class="js-smell-location">1</a>                  </div>  </li></ol>
          elsif instance_group.errand?<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#instance_groups_starting_on_deploy refers to 'instance_group' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="planner.html#L258" class="js-smell-location">0</a>                  <a href="planner.html#L260" class="js-smell-location">1</a>                  <a href="planner.html#L261" class="js-smell-location">2</a>                  </div>  </li></ol>
            instance_groups &lt;&lt; instance_group if instance_group.instances.any?(&amp;:vm_created?)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#instance_groups_starting_on_deploy calls 'instance_groups << instance_group' 2 times</span>              <span>Locations:</span>                  <a href="planner.html#L259" class="js-smell-location">0</a>                  <a href="planner.html#L261" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#instance_groups_starting_on_deploy refers to 'instance_group' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="planner.html#L258" class="js-smell-location">0</a>                  <a href="planner.html#L260" class="js-smell-location">1</a>                  <a href="planner.html#L261" class="js-smell-location">2</a>                  </div>  </li></ol>
          end
        end

        instance_groups
      end

      # @return [Array&lt;Bosh::Director::DeploymentPlan::InstanceGroup&gt;] InstanceGroups with errand lifecycle
      def errand_instance_groups
        @instance_groups.select(&amp;:errand?)
      end

      def using_global_networking?
        CloudConfig::CloudConfigsConsolidator.have_cloud_configs?(@cloud_configs)
      end

      def set_variables(variables_obj)
        @variables = variables_obj
      end

      def set_features(features_obj)
        @features = features_obj
      end

      def use_dns_addresses?
        @features.use_dns_addresses.nil? ? Config.local_dns_use_dns_addresses? : @features.use_dns_addresses<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#use_dns_addresses? calls '@features.use_dns_addresses' 2 times</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#use_dns_addresses? performs a nil-check</span>          </div>  </li></ol>
      end

      def use_short_dns_addresses?
        @features.use_short_dns_addresses.nil? ? false : @features.use_short_dns_addresses<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#use_short_dns_addresses? calls '@features.use_short_dns_addresses' 2 times</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#use_short_dns_addresses? performs a nil-check</span>          </div>  </li></ol>
      end

      def randomize_az_placement?
        @features.randomize_az_placement.nil? ? false : @features.randomize_az_placement<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#randomize_az_placement? calls '@features.randomize_az_placement' 2 times</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden"true"=""></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nil-Check.md" target="_blank"><b>NilCheck</b></a>        </span>      </div>      <span>Bosh::Director::DeploymentPlan::Planner#randomize_az_placement? performs a nil-check</span>          </div>  </li></ol>
      end

      def availability_zone_names
        @cloud_planner.availability_zone_names
      end

      def team_names
        @model.teams.map(&amp;:name)
      end

      def is_deploy?
        @is_deploy_action
      end
    end
  end
end
</code>
  </div>
</div>

        </div>
      </div>
    </div>

    <!-- Javascripts -->
    <script src='../../../../assets/javascripts/jquery.min.js'></script>
    <script src='../../../../assets/javascripts/jquery.tablesorter.min.js'></script>
    <script src='../../../../assets/javascripts/jquery.scrollTo.min.js'></script>
    <script src='../../../../assets/javascripts/jquery.timeago.js'></script>
    <script src='../../../../assets/javascripts/highcharts.src-4.0.1.js'></script>
    <script src='../../../../assets/javascripts/prettify.js'></script>
    <script src='../../../../assets/javascripts/bootstrap.min.js'></script>
    <script src='../../../../assets/javascripts/application.js'></script>
    <script src='../../../../assets/javascripts/jquery.filtertable.min.js'></script>
  </body>
</html>
